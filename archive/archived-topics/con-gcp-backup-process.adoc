:_mod-docs-content-type: CONCEPT

[id="con-gcp-backup-process"]

= The Backup Process

A backup enables you to backup your environment by saving the database and the shared file system.
A new environment is created during the restore using the saved shared file system.
When the new environment is in place, the process restores the database.

The backup and restore process must use the same version.
If you performed the backup with an earlier version, you must use the restore process of that version.
Then, if required, you can run an upgrade.

You must also make a backup before an upgrade.
For further information, read xref:assembly-gcp-upgrade[Upgrading your deployment]

The backup process involves taking a backup of the Cloud SQL database and filestore instances at a given point in time.
The backup playbook requires an active {AAPonGCP} foundation deployment to be running.

A bucket needs to be created in your project as restore information will be stored in that bucket.

The bucket can contain multiple backups from the same deployment or different ones. A backup will generate a directory named <prefix>-<deployment_name>-<timestamp> and a file named <prefix>-<deployment_name>-<timestamp>.json. The directory contains the awx and pulp databases backup, the deployment configuration and the secrets. The json file contains information for the restore procedure.

Playbooks are provided through the CLI to list and delete backups.

The following procedures describe how to backup the {AAPonGCP} deployment.

:context: backup
include::proc-gcp-backup-container-image.adoc[leveloffset=+1]
include::ref-gcp-iam-backup-minimum-permissions.adoc[leveloffset=+1]
include::proc-gcp-setup-environment.adoc[leveloffset=+1]
include::proc-gcp-backup-requirements.adoc[leveloffset=+1]
include::proc-gcp-create-data-file.adoc[leveloffset=+1]
include::ref-gcp-populate-backup-file.adoc[leveloffset=+1]
include::proc-gcp-run-backup-playbook.adoc[leveloffset=+1]
include::proc-gcp-listing-backups-playbook.adoc[leveloffset=+1]
include::proc-gcp-deleting-backups-playbook.adoc[leveloffset=+1]
include::proc-gcp-deleting-backups-troubleshooting-playbook.adoc[leveloffset=+1]
