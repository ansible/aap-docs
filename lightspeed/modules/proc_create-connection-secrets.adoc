:_content-type: PROCEDURE

[id="create-connection-secrets_{context}"]

= Creating connection secrets

You must create an authorization secret to connect to {PlatformName}, and a model secret to connect to {ibmwatsonxcodeassistant}. If you need to trust a custom Certificate Authority, you must create a bundle secret.

.Prerequisites
* You have installed the {PlatformNameShort} operator on the {OCP}. 
* You have created an OAuth application in the {ControllerName}.
* You have obtained an API key and a model ID from {ibmwatsonxcodeassistant}. 
+
For information about obtaining an API key and model ID from {ibmwatsonxcodeassistant}, see the link:https://cloud.ibm.com/docs/watsonx-code-assistant[{ibmwatsonxcodeassistant} documentation]. For information about installing {ibmwatsonxcodeassistant} for {LightspeedshortName} on Cloud Pak for Data, see the link:https://www.ibm.com/docs/en/software-hub/5.1.x?topic=services-watsonx-code-assistant-red-hat-ansible-lightspeed[ watsonx Code Assistant for {LightspeedshortName} on Cloud Pak for Data documentation].

.Procedure
. Go to the {OCP}. 
. Select menu:Workloads[Secrets].
. Click menu:Create[Key/value secret].
. From the *Projects* list, select the namespace that you created when you installed the {PlatformName} operator.
. Create an *authorization secret* to connect to the {PlatformName}:
.. Click menu:Create[Key/value secret].
.. In *Secret name*, enter a unique name for the secret. For example, `auth-aiconnect`.
.. Add the following keys and their associated values individually:
+
[cols="30%,70%",options="header"]
|===
|Key |Value

|`auth_api_url`
a|
Enter the API URL of the {ControllerName} in the following format based on the {PlatformNameShort} version you are using:

* For {PlatformNameShort} 2.4: `\https://<CONTROLLER_SERVER_NAME>/api`
* For {PlatformNameShort} 2.5: `\https://<GATEWAY_SERVER_NAME>`

|`auth_api_key`
|Enter the client ID of the OAuth application that you recorded earlier.

|`auth_api_secret`
|Enter the client secret of the OAuth application that you recorded earlier.

|`auth_allowed_hosts`
|Enter the list of strings representing the host/domain names used by the underlying Django framework to restrict which hosts can access the service. This is a security measure to prevent HTTP Host header attacks. For more information, see link:https://docs.djangoproject.com/en/5.0/ref/settings/#allowed-hosts[Allowed hosts in django documentation]. 

|`auth_verify_ssl`
|Enter the value as `true`.
|===
+
[IMPORTANT]
====
Ensure that you do not accidentally add any whitespace characters (extra line, space, and so on) to the value fields. If there are any extra or erroneous characters in the secret, the connection to {PlatformName} fails.
====

.. Click *Create*. 
+
The following image is an example of an authorization secret:
+
[.thumb]
image::aiconnect-auth-secret.png[{Example of an authorization secret]

. Similarly, create a *model secret* to connect to an {ibmwatsonxcodeassistant} model:
.. Click menu:Create[Key/value secret].
.. In *Secret name*, enter a unique name for the secret. For example, `model-aiconnect`.
.. Add the following keys and their associated values individually:
+
[cols="30%,70%",options="header"]
|===
|Key |Value

|`username`
|Enter the username you use to connect to your {ibmwatsonxcodeassistant} model.

|`model_type`
a|Enter one of the following values per your {ibmwatsonxcodeassistant} model:

* For on-premise deployment of {ibmwatsonxcodeassistant} model (IBM Cloud Pak for Data): `wca-onprem`

* For cloud deployment of {ibmwatsonxcodeassistant} model (IBM Cloud): `wca`

|`model_url`
|Enter the URL of the {ibmwatsonxcodeassistant} model.

|`model_api_key`
|Enter the API key of your {ibmwatsonxcodeassistant} model that was generated during the model installation. 

|`model_id`
|Enter the ID of your {ibmwatsonxcodeassistant} model.

|`model_verify_ssl`
d|_Optional, and supported on {PlatformName} {PlatformVers} only_

This key controls whether the SSL certificate of the {ibmwatsonxcodeassistant} model is verified. 
 
Default = `true`

|`model_enable_anonymization`
d|_Optional, and supported on {PlatformName} version 2.5.250702 and later_

This key controls whether the anonymization of Personally Identifiable Information (PII) is enabled. PII includes passwords, IP addresses, email addresses, and other sensitive data. When PII anonymization is enabled, the users' personal information is modified to some generic values to protect their data and reduce the risk of data leaks. 

You can turn off PII anonymization by specifying the value as `false` if you want to retain all original information as entered by users and improve the quality of the answers. If you set the value to `false` and the Ansible administrator is using {LightspeedShortName} in hybrid deployment mode (where the model is in {ibmwatsonxcodeassistant} in IBM Cloud), then their users' PII is sent to IBM Cloud.

Default = `true`
|===
+
[IMPORTANT]
====
Ensure that you do not accidentally add any whitespace characters (extra line, space, and so on) to the value fields. If there are any extra or erroneous characters in the secret, the connection to {ibmwatsonxcodeassistant} fails.
====

.. Click *Create*. 

After you create the authorization and model secrets, you must select the secrets when you  xref:create-lightspeed-instance_configuring-lightspeed-onpremise[create and deploy a {LightspeedShortName} instance].

== Creating a bundle secret to trust a custom Certificate Authority

If you encounter a scenario where you need to trust a custom Certificate Authority, you can customize a few variables for the {LightspeedShortName} instance. Trusting a custom Certificate Authority enables the {LightspeedShortName} instance to access network services configured with SSL certificates issued locally, such as cloning a project from an internal Git server via HTTPS. 

If you encounter the following error when syncing projects, it indicates that you need to customize the variables. 

----
fatal: unable to access 'https://private.repo./mine/ansible-rulebook.git': SSL certificate problem: unable to get local issuer certificate
----

.Procedure
Use one of the following methods to create a custom bundle secret using the CLI: 

* *Using a Certificate Authority secret*
+
Create a `bundle_cacert_secret` using  the following command:
+
----
# kubectl create secret generic <resourcename>-custom-certs \ 
    --from-file=bundle-ca.crt=<PATH/TO/YOUR/CA/PEM/FILE> <1>
----
.Where:
<1>: Path of the self-signed certificate. Modify the file path to point to where your self-signed certificates are stored. The {LightspeedShortName} instance looks for the data field `bundle-ca.crt` in the specified `bundle_cacert_secret` secret.
+
The following is an example of a bundle CA certificate:
+
----
spec:
  ...
  bundle_cacert_secret: <resourcename>-custom-certs
----

* *Using the `kustomization.yaml` configuration file*
+
Use the following command:
+
----
secretGenerator:
  - name: <resourcename>-custom-certs
    files:
      - bundle-ca.crt=<path+filename>
    options:
      disableNameSuffixHash: true
----

After you create the bundle secret, you must select the secret when you  xref:create-lightspeed-instance_configuring-lightspeed-onpremise[create and deploy a {LightspeedshortName} instance].

[role="_additional-resources"]
.Additional resources
* xref:ref-troubleshooting-lightspeed-onpremise-config_troubleshooting-lightspeed[Troubleshooting {LightspeedShortName} on-premise deployment errors]
