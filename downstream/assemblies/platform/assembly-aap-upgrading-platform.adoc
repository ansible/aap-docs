:_mod-docs-content-type: ASSEMBLY

ifdef::context[:parent-context: {context}]

[id="aap-upgrading-platform"]
= Upgrading to {PlatformName} {PlatformVers}

:context: aap-upgrading-platform

[role="_abstract"]

To upgrade your {PlatformName}, start by reviewing {LinkPlanningGuide} to ensure a successful upgrade.
You can then download the desired version of the {PlatformNameShort} installer, configure the inventory file in the installation bundle to reflect your environment, and then run the installer.

[IMPORTANT]
====
In {PlatformNameShort} {PlatformVers}, while the automation controller's API remains for backward compatibility, new installations must use the {Gateway} API for managing organizations, teams, and users. Using the legacy API will introduce a delay of up to 15 minutes before changes are synchronized to all components, including {EDAcontroller}.

====

include::platform/con-aap-upgrade-planning.adoc[leveloffset=+1]
include::platform/proc-choosing-obtaining-installer.adoc[leveloffset=+1]
include::platform/proc-choosing-obtaining-installer-no-internet.adoc[leveloffset=+2]
include::platform/proc-editing-inventory-file-for-updates.adoc[leveloffset=+1]
include::platform/con-backup-aap.adoc[leveloffset=+1]
include::platform/proc-running-setup-script-for-updates.adoc[leveloffset=+1]
include::platform/con-upgrade-controller-hub-eda-unified-ui.adoc[leveloffset=+1]
include::platform/proc-upgrade-controller-hub-eda-unified-ui.adoc[leveloffset=+2]
include::platform/proc-upgrade-controller-hub-eda-unified-services.adoc[leveloffset=+2]
// [ddacosta] - Moved to a new post upgrade section of the doc
//include::platform/proc-account-linking.adoc[leveloffset=+1]

ifdef::parent-context[:context: {parent-context}]
ifndef::parent-context[:!context:]




== OLD SECTIONS

== OLD Prerequisites

* Upgrades to {PlatformNameShort} {PlatformVers} include the link:{URLPlanningGuide}/ref-aap-components#con-about-platform-gateway_planning[{Gateway}]. Ensure you review the link:{URLPlanningGuide}/ref-network-ports-protocols_planning[2.5 Network ports and protocols] for architectural changes and {LinkTopologies} for information on opinionated deployment models. MOVED

* You have reviewed the link:{URLPlanningGuide}/ha-redis_planning#gw-centralized-redis_planning[centralized Redis] instance offered by {PlatformNameShort} for both standalone and clustered topologies. MOVED

* Prior to upgrading your {PlatformName}, ensure you have reviewed {LinkPlanningGuide} for a successful upgrade. You can then download the desired version of the {PlatformNameShort} installer, configure the inventory file in the installation bundle to reflect your environment, and then run the installer. MOVED

* Before upgrading your {PlatformName}, ensure that you have upgraded to {ControllerName} 4.5 or later. MOVED


== OLD {PlatformNameShort} upgrade planning
 
[role="_abstract"]
Before you begin the upgrade process, review the following considerations to plan and prepare your {PlatformNameShort} deployment:

* See link:{URLPlanningGuide}/platform-system-requirements[System requirements] in the {TitlePlanningGuide} guide to ensure you have the topologies that fit your use case. 
+
[NOTE]
====
2.4 to 2.5 upgrades now include link:{URLPlanningGuide}/ref-aap-components#con-about-platform-gateway_planning[{GatewayStart}]. Ensure you review the 2.5 link:{URLPlanningGuide}/ref-network-ports-protocols_planning[Network ports and protocols] for architectural changes. MOVED
====
+
[IMPORTANT]
====
When upgrading from {PlatformNameShort} 2.4 to 2.5, the API endpoints for the {ControllerName}, {HubName}, and {EDAcontroller} are all available for use. These APIs are being deprecated and will be disabled in an upcoming release. This grace period is to allow for migration to the new APIs put in place with the {Gateway}. MOVED
====
+
* Verify that you have a valid subscription before upgrading from a previous version of {PlatformNameShort}. Existing subscriptions are carried over during the upgrade process. MOVED
* Ensure you have a backup of an {PlatformNameShort} 2.4 environment before upgrading in case any issues occur. See link:{URLControllerAdminGuide}/controller-backup-and-restore[Backup and restore] and {LinkOperatorBackup} for the specific topology of the environment. MOVED
* Ensure you capture your inventory or instance group details before upgrading. MOVED
* Ensure you have upgraded to the latest version of {PlatformNameShort} 2.4 before upgrading your {PlatformName}. MOVED
* Upgrades of {EDAName} version 2.4 to 2.5 are not supported. Database migrations between {EDAName} 2.4 and {EDAName} 2.5 are not compatible. For more information, see xref:upgrade-controller-hub-eda-unified-ui_aap-upgrading-platform[{ControllerName} and {HubName} 2.4 and {EDAName} 2.5 with unified UI upgrades]. MOVED
+
If you are currently running {EDAcontroller} 2.5, it is recommended that you disable all {EDAName} activations before upgrading to ensure that only new activations run after the upgrade process is complete. MOVED
* {ControllerNameStart} OAuth applications on the platform UI are not supported for 2.4 to 2.5 migration. See this link:https://access.redhat.com/solutions/7091987[Knowledgebase article] for more information. To learn how to recreate your OAuth applications, see link:{URLCentralAuth}/gw-token-based-authentication#assembly-controller-applications[Applications] in the {TitleCentralAuth} guide. NOT NEEDED
* During the upgrade process, user accounts from the individual services are migrated. If there are accounts from multiple services, they must be linked to access the unified platform. See xref:account-linking_aap-post-upgrade[Account linking] for details. NOT NEEDED
* {PlatformNameShort} 2.5 offers a centralized Redis instance in both link:{URLPlanningGuide}/ha-redis_planning#gw-single-node-redis_planning[standalone] and link:{URLPlanningGuide}/ha-redis_planning#gw-clustered-redis_planning[clustered] topologies. For information on how to configure Redis, see link:{URLInstallationGuide}/assembly-platform-install-scenario#redis-config-enterprise-topology_platform-install-scenario[Configuring Redis] in the {TitleInstallationGuide} guide.
* When upgrading from {PlatformNameShort} 2.4 to {PlatformVers}, connections to the {Gateway} URL might fail on the {Gateway} UI if you are using the {ControllerName} behind a load balancer. The following error message is displayed: `Error connecting to Controller API`
+
To resolve this issue, for each controller host, add the {Gateway} URL as a trusted source in the `CSRF_TRUSTED_ORIGIN` setting in the *settings.py* file for each controller host. You must then restart each controller host so that the URL changes are implemented. For more information, see _Upgrading_ in {LinkTroubleshootingAAP}. 