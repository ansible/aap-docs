
[id="deploying-your-system-for-container-signing"]

= Deploying your system for container signing

{HubNameStart} implements image signing to offer better security for the {ExecEnvShort} container images.

.Prerequisites 
* You have already link:{URLHubManagingContent}/managing-containers-hub#populate-container-registry[created and synced a container registry] in the Remote Registry section of {PlatformNameShort}.

.Procedure

. Log in to {PlatformNameShort} and, from the navigation panel, select {MenuACAdminSignatureKeys}. If you followed the steps in [NEW CONTENT FROM CONTAINERIZED INSTALL GUIDE] during setup, you should see a key labeled `container-default`.
. From the navigation panel, select {MenuACExecEnvironments}.
. Click btn:[Create execution environment] and enter the relevant information in the fields that appear. 
.. The *Name* field displays the name of the {ExecEnvName} on your local registry. 
.. The *Upstream name* field is the name of the image on the remote server. For example, if the upstream name is set to "alpine" and the *Name* field is "local/alpine," the alpine image is downloaded from the remote and renamed "local/alpine."
.. Set a list of tags to include or exclude. Note that syncing an {ExecEnvNameSing} with a large number of tags is time consuming and uses a lot of disk space.
. Click btn:[Create execution environment]. You should see your new {ExecEnvNameSing} in the list that appears.
. Sync and sign your new {ExecEnvNameSing}.
.. Click the btn:[More Actions] icon *{MoreActionsIcon}* and select *Sync execution environment*.
.. Click the btn:[More Actions] icon *{MoreActionsIcon}* and select *Sign execution environment*. 
. Click on your new {ExecEnvNameSing}. On the Details page, find the *Signed* label to determine that your {ExecEnvNameSing} has been signed.  


////
To deploy your system so that it is ready for container signing, create a signing script.

[NOTE]
====
Installer looks for the script and key on the same server where installer is located.
====

.Procedure
. From a terminal, create a signing script, and pass the script path as an installer parameter.
+
*Example*:
+
-----
#!/usr/bin/env bash

# pulp_container SigningService will pass the next 4 variables to the script.
MANIFEST_PATH=$1
FINGERPRINT="$PULP_SIGNING_KEY_FINGERPRINT"
IMAGE_REFERENCE="$REFERENCE"
SIGNATURE_PATH="$SIG_PATH"

# Create container signature using skopeo
skopeo standalone-sign \
  $MANIFEST_PATH \
  $IMAGE_REFERENCE \
  $FINGERPRINT \
  --output $SIGNATURE_PATH

# Optionally pass the passphrase to the key if password protected.
# --passphrase-file /path/to/key_password.txt

# Check the exit status
STATUS=$?
if [ $STATUS -eq 0 ]; then
  echo {\"signature_path\": \"$SIGNATURE_PATH\"}
else
  exit $STATUS
fi
-----
+
. Review the {PlatformNameShort} installer inventory file for options for container signing that begin with `automationhub_*`.
+
-----
[all:vars]
.
.
.

automationhub_create_default_container_signing_service = True
automationhub_container_signing_service_key = /absolute/path/to/key/to/sign
automationhub_container_signing_service_script = /absolute/path/to/script/that/signs
-----
+

. Once installation is complete, log in to {PlatformNameShort} and navigate to {MenuACAdminSignatureKeys}.

. Ensure that you have a key titled *container-default*, or *container*-_anyname_.

[NOTE]
====
The `container-default` service is created by the {PlatformNameShort} installer.
====
////