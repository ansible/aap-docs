// Module included in the following assemblies:
// assembly-view-key-metrics.adoc
:_mod-docs-content-type: PROCEDURE

[id="proc-integrating-automation-dashboard"]

= Integrating {AutomationDashboardName} with your {PlatformNameShort}

[role="_abstract"]
Integrate your {PlatformNameShort} instances into the {AutomationDashboardName} configuration to collect and visualise data and gain insights into your automation.

.Prerequisites

* You have installed {AutomationDashboardName}.
* You have verified that {AutomationDashboardName} is running on HTTPS port 8447 on your Red Hat Enterprise Linux host.
+
[NOTE]
====
* This verification requires your {PlatformNameShort} login details.
* Port 8447 is enabled by default, but this is configurable.
====

.Procedure 

. Configure a personal access token. For more information, see link:https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/{PlatformVers}/html/access_management_and_authentication/gw-token-based-authentication[Configuring access to external applications with token-based authentication].
. Create or update the `clusters.yaml` file. You must include the `refresh_token`, `client_id`, and `client_secret` to enable persistent authentication and automatic token rotation.
+
[source,yaml]
----
clusters:
  - protocol: https
    address: <aap_controller_url>
    port: 443
    access_token: <access_token_string>
    refresh_token: <refresh_token_string>
    client_id: <client_id_string>
    client_secret: <client_secret_string>
    verify_ssl: false
    name: <unique_cluster_name>
----
+
**Configuring TLS verification**
+
When configuring the `verify_ssl` parameter, choose the setting that matches your {PlatformNameShort} certificate type:
+
* **Commercial certificates:** Set `verify_ssl: true`.
* **Self-signed certificates:** Set `verify_ssl: false`.
+
[NOTE]
====
The {AutomationDashboardName} cannot verify self-signed certificates against a custom Certificate Authority (CA).
====

. You can add one or more {PlatformNameShort} instances (of the same {PlatformNameShort} version) into the {AutomationDashboardName} configuration for pulling and combining data by using the following: 
+
[NOTE]
====
If you only have one {PlatformNameShort} instance, then remove the second entry.
====
+
[source,bash]
----
---
clusters:
  - protocol: https			<--- Normally https
    address: my-aap.example.com  <--- Can use IP or FQDN without http(s)://
    port: 443				<--- Normally 443
    access_token: sampleToken	<--- Your preconfigured Ansible Automation Platform read access token
  Platform read access token
    refresh_token: myRefreshToken 
    client_id: myClientID 
    client_secret: myClientSecret
    verify_ssl: false		<--- Can be used when using self signed certs
    sync_schedules:
      - name: Every 5 minutes sync
        rrule: DTSTART;TZID=Europe/Ljubljana:20250630T070000 FREQ=MINUTELY;INTERVAL=5
        enabled: true

  - protocol: https
    address: aap2.example.com
    port: 443
    access_token: WRn2swiqg5spEwUndDkrJoCeg4Qwuw
    verify_ssl: true
    sync_schedules:
      - name: Every 5 minutes sync
        rrule: DTSTART;TZID=Europe/Ljubljana:20250630T070000 FREQ=MINUTELY;INTERVAL=5
        enabled: true 

----
+
[NOTE]
====
The `access_token`, `refresh_token`, and `client_secret` are stored in the {AutomationDashboardName} database. 
These values are encrypted for security.
====

. Load and activate your {AutomationDashboardName} configuration:
+
[source,bash]
----
podman cp clusters.yaml automation-dashboard-web:/
podman exec -it automation-dashboard-web /venv/bin/python manage.py setclusters /clusters.yaml
----
+
[NOTE]
====
**Token Rotation:** The {AutomationDashboardName} rotates tokens internally for security but does not update your local `clusters.yaml` file. If you must re-run the `setclusters` command later, your defined tokens might be expired.

To retrieve the current valid tokens, run the following command and save the output to a new file:
[source,bash]
----
podman exec -it automation-dashboard-web /venv/bin/python manage.py getclusters --decrypt > clusters_current.yaml
----
====