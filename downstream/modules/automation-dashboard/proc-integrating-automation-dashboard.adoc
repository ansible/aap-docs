// Module included in the following assemblies:
// assembly-view-key-metrics.adoc
:_mod-docs-content-type: PROCEDURE

[id="proc-integrating-automation-dashboard"]

= Integrating {AutomationDashboardName} with your {PlatformNameShort}

[role="_abstract"]
Integrate your {PlatformNameShort} instances into the {AutomationDashboardName} configuration in order to collect and visualise data and gain insights into your automation.

.Procedure 

. Verify that {AutomationDashboardName} is running on https port 8447 on your RHEL host. This verification will require your {PlatformNameShort} login details.
+
[NOTE]
====
Port 8447 is enabled by default, but this is configurable.
====
. Your {PlatformNameShort} instances are added into `clusters.yml` using the following information:
* Your {PlatformNameShort} URLs/ports for front-end access
* A preconfigured {PlatformNameShort} OAuth access token and refresh for _read_ access
* OAuth2 client credentials
+
[NOTE]
====
If you donâ€™t have access to {PlatformNameShort}, consult your administrator.
====
. Configure a personal access token. For more information, see link:https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/{PlatformVers}/html/access_management_and_authentication/gw-token-based-authentication[Configuring access to external applications with token-based authentication].
. Once you have configured your access token, run the following command:
+
[source,bash]
----
cp clusters.example.yaml clusters.yaml
vi clusters.yaml
----

. You can add one or more {PlatformNameShort} instances (of the same {PlatformNameShort} version) into the {AutomationDashboardName} configuration for pulling and combining data by using the following: 
+
[NOTE]
====
If you only have one {PlatformNameShort} instance, then remove the second entry.
====
+
[source,bash]
----
---
clusters:
  - protocol: https			<--- Normally https
    address: my-aap.example.com  <--- Can use IP or FQDN without http(s)://
    port: 443				<--- Normally 443
    access_token: sampleToken	<--- Your preconfigured Ansible Automation Platform read access token
  Platform read access token
    refresh_token: myRefreshToken 
    client_id: myClientID 
    client_secret: myClientSecret
    verify_ssl: false		<--- Can be used when using self signed certs
    sync_schedules:
      - name: Every 5 minutes sync
        rrule: DTSTART;TZID=Europe/Ljubljana:20250630T070000 FREQ=MINUTELY;INTERVAL=5
        enabled: true

  - protocol: https
    address: aap2.example.com
    port: 443
    access_token: WRn2swiqg5spEwUndDkrJoCeg4Qwuw
    verify_ssl: true
    sync_schedules:
      - name: Every 5 minutes sync
        rrule: DTSTART;TZID=Europe/Ljubljana:20250630T070000 FREQ=MINUTELY;INTERVAL=5
        enabled: true 

----
+
[NOTE]
====
The `access_token`, `refresh_token`, and `client_secret` are stored in the {AutomationDashboardName} database. 
All three values are encrypted for security.
====

. Run the following commands to load and activate your {AutomationDashboardName} configuration:

+
[source,bash]
----
podman cp clusters.yaml automation-dashboard-web:/
podman exec automation-dashboard-web /venv/bin/python ./manage.py setclusters /clusters.yaml
----
+

[NOTE]
====
{AutomationDashboardName} uses `refresh_token`, `client_id`, and `client_secret` to automatically obtain a new `access_token` and `refresh_token` when the current token expires.
The utility uses the ping endpoint to detect the {PlatformNameShort} version and determine the correct token refresh endpoint.
====
*Example*
+
[source,bash]
----
podman exec automation-dashboard-web /venv/bin/python ./manage.py setclusters /clusters.yaml
Check if table exists.
Reading YML file.
Adding cluster: address=my-aap.example.com

INFO 2025-05-20 09:55:00,926 connector 187 140208297051968 Checking if is AAP 2.4 at https://my-aap.example.com:443
INFO 2025-05-20 09:55:00,926 connector 187 140208297051968 Pinging api https://my-aap.example.com:443/api/v2/ping/
INFO 2025-05-20 09:55:00,926 connector 187 140208297051968 Executing GET request to https://my-aap.example.com:443/api/v2/ping/

ERROR 2025-05-20 09:55:00,032 connector 301 140025281152832 GET request failed with status 404
Successfully set up AAP clusters
----
+
[NOTE]
====
{AutomationDashboardName} checks for {PlatformNameShort} 2.4, 2.5, and 2.6 instances. As shown in the example output, this can result in 404 errors. For more information on errors, see the Verification section of this chapter. 
====
. Use the following command to test your {AutomationDashboardName} configuration by manually fetching data: 

+
[source,bash]
----
podman exec -it automation-dashboard-web /venv/bin/python ./manage.py syncdata --since=2025-04-01 --until=2025-06-01
Successfully created Sync task for Cluster https://my-aap.example.com:443.
----
+

[NOTE]
====
Consider using a short date interval to reduce test time. The format is YYYY-MM-DD.
====
You can then use `journalctl` to monitor progress:
+
[source,bash]
----
sudo journalctl -fn10
----
+
. Refresh your browser to view retrieved data within your {AutomationDashboardName}.