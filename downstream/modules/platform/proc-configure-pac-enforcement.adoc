:_newdoc-version: 2.18.4
:_template-generated: 2025-05-08
:_mod-docs-content-type: PROCEDURE

[id="configure-enforcement-points_{context}"]
= Configuring enforcement points

After you have set up your {PlatformNameShort} instance to communicate with the OPA server, you can set up enforcement points where you want the policy to be applied. 

You can associate a policy with a job template, an inventory, or an organization. Enforcement then occurs in the following ways:

* *Organization*: Jobs launched from a template owned by an organization will fail if the policy is violated. This configuration provides broad control over automation within organizational boundaries.
* *Inventory*: Jobs using an inventory associated with a policy fail if the policy is violated. This configuration allows you to control access to specific infrastructure resources. 
* *Job template*: Jobs launched from a template associated with a policy fail if the job violates the associated policy. This configuration provides granular control over specific automation tasks. 

== Understanding OPA packages and rules

An OPA policy is organized in packages, which are namespaced collections of rules. The basic structure of an OPA policy looks like this: 

[source,rego]
----
package aap_policy_examples  # Package name

import rego.v1  # Import required for Rego v1 syntax

# Rules define the policy logic
allowed := {
    "allowed": true,
    "violations": []
}
----

The key components of the rule's structure are: 

* *Package declaration*: This defines the namespace for your policy.
* *Rules*: This defines the policy's logic and the decision that it returns.

These components together comprise the OPA policy name, which is formatted as {package}/{rule}. You will enter the OPA policy name when you configure enforcement points. 


== Associating a policy with an organization

To associate a policy with an organization, take the following steps.

.Procedure

. From the navigation panel, select {MenuAMOrganizations}.
. On the Organizations screen:
.. To edit an existing organization, find the organization you want to edit and click the pencil icon image:leftpencil.png[Edit,15,15] to go to the editing screen.
.. To create a new organization, click btn:[Create organization].
. In the field labeled *Policy enforcement*, enter the query path associated with the policy you want to implement. Note that the query path must be formatted as `package/rule`.
. Click btn:[Next] and then btn:[Finish] to save your settings.

== Associating a policy with an inventory

To associate a policy with an inventory, take the following steps: 

.Procedure

. From the navigation panel, select {MenuInfrastructureInventories}.
. On the Inventories screen:
.. To edit an existing inventory, find the inventory you want to edit and click the pencil icon image:leftpencil.png[Edit,15,15] to go to the editing screen.
.. To create a new inventory, click btn:[Create inventory].
. In the field titled *Policy enforcement*, enter the query path associated with the policy you want to implement. Note that the query path must be formatted as `package/rule`.
. Click btn:[Save inventory] if you are editing an existing inventory, or click btn:[Create inventory] if you are creating a new inventory.

== Associating a policy with a job template

To associate a policy with a job template, take the following steps: 

.Procedure

. From the navigation panel, select {MenuAETemplates}.
. On the Automation Templates screen:
.. To edit an existing job template, find the job template you want to edit and click the pencil icon image:leftpencil.png[Edit,15,15] to go to the editing screen.
.. To create a new job template, click btn:[Create template].
. In the field titled *Policy enforcement*, enter the query path associated with the policy you want to implement. Note that the query path must be formatted as `package/rule`.
. Click btn:[Save job template] if you are editing an existing job template, or click btn:[Create job template] if you are creating a new job template.

