[id="controller-importing-subscriptions"]

= Importing a subscription

After you have obtained an authorized {PlatformNameShort} subscription, you must import it into the {ControllerName} system before you can use {ControllerName}.

[NOTE]
====
You are opted in for {Analytics} by default when you activate the {ControllerName} on first time log in. This helps Red Hat improve the product by delivering you a much better user experience. You can opt out, by doing the following: 

. From the navigation panel, select menu:Settings[] and select the *Miscellaneous System settings* option.
. Click btn:[Edit].
. Toggle the *Gather data for Automation Analytics* switch to the off position.
. Click btn:[Save].

For opt-in of {Analytics} to be effective, your instance of {ControllerName} must be running on {RHEL}. 

For more information, see the link:{BaseURL}/red_hat_ansible_automation_platform/{PlatformVers}/html-single/automation_controller_administration_guide/index#ref-controller-automation-analytics[{Analytics}] section.
====

.Prerequisites

* If you plan to upload a subscription manifest, you must first obtain one. 
For more information, see link:{BaseURL}/red_hat_ansible_automation_platform/{PlatformVers}/html-single/automation_controller_user_guide/index#proc-controller-obtaining-subscriptions-manifest[Obtaining a subscriptions manifest].
* If you plan to find your subscription with credentials, you must create a service account with the Analytics Administrator viewer role in console.redhat.com.
For more information see, link:https://docs.redhat.com/en/documentation/red_hat_hybrid_cloud_console/1-latest/html/creating_and_managing_service_accounts/proc-ciam-svc-acct-overview-creating-service-acct#proc-ciam-svc-acct-create-creating-service-acct[Creating a service account].

.Procedure

. Launch {ControllerName} for the first time. 
The subscription wizard screen displays.
+
image::controller-gs-subscription-management.png[Subscription Management]
+
. Retrieve and import your subscription by completing either of the following steps:
.. If you have obtained a subscription manifest, upload it by navigating to the location where the file is saved.
The subscription manifest is the complete `.zip` file, and not only its component parts.
+
[NOTE]
====
If the *Browse* option in the *Subscription manifest* option is disabled, clear the *username* and *password* fields to enable it.
====
+
The subscription metadata is then retrieved from the RHSM/Satellite API, or from the manifest provided. 
If many subscription counts were applied in a single installation, {ControllerName} combines the counts but uses the earliest expiration date as the expiry (at which point you must refresh your subscription).
.. If you are using your Red Hat service account credentials to activate your subscription, enter your client ID and client secret in the fields labeled *Red Hat Client ID for Analytics* and *Red Hat Client Secret for Analytics* on the license page. 
Use your Satellite username or password if your {ControllerName} cluster nodes are registered to Satellite with Subscription Manager. 
After you enter your credentials, click btn:[Get Subscriptions].
+
{ControllerNameStart} retrieves your configured subscription service. 
Then, it prompts you to select the subscription that you want to run and applies that metadata to {ControllerName}. 
You can log in over time and retrieve new subscriptions if you have renewed.
+
. Click btn:[Next].
//[ddacosta - Removed for AAP-30863] to proceed to the *Tracking and Insights* page. 
+
//[ddacosta - Removed for AAP-30863]. After you have specified your tracking and Insights preferences, click btn:[Next] to proceed to the End User Agreement.
. Review and check the *I agree to the End User License Agreement* checkbox and click btn:[Submit].
+
After your subscription is accepted, {ControllerName} displays the subscription details and opens the Dashboard. 
To return to the Subscription settings screen from the Dashboard, select menu:Settings[Subscription settings] from the btn:[Subscription] option in the navigation panel.

. Optional: To return to the Subscription settings screen from the Dashboard, select menu:Settings[Subscription settings] option in the navigation panel.
+
image::controller-gs-licenseaccepted.png[Subscription Details]

.Troubleshooting your subscription

When your subscription expires (you can check this in the Subscription details of the Subscription settings window), you must renew it in {ControllerName}. 
You can do this by either importing a new subscription, or setting up a new subscription.

If you meet the "Error fetching licenses" message, check that you have the proper permissions required for the Satellite user. 
The {ControllerName} administrator requires this to apply a subscription.

The Satellite username and password is used to query the Satellite API for existing subscriptions. 
From the Satellite API, the {ControllerName} receives metadata about those subscriptions, then filters through to find valid subscriptions that you can apply. 
These are then displayed as valid subscription options in the UI.

The following Satellite roles grant proper access:

* Custom with `view_subscriptions` and `view_organizations` filter
* Viewer
* Administrator
* Organization Administrator
* Manager

Use the *Custom* role for your {ControllerName} integration, as it is the most restrictive. 
For more information, see the link:{BaseURL}/red_hat_satellite/{SatelliteVers}/html/administering_red_hat_satellite/managing_users_and_roles_admin#Creating_and_Managing_Roles_admin[Satellite documentation] on managing users and roles.

[NOTE]
====
The *System Administrator* role is not equal to the *Administrator* user checkbox, and does not offer enough permissions to access the subscriptions API page.
====
