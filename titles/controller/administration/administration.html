<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Administration guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Administration guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#ag_restart_tower">1. Starting, Stopping, and Restarting the Controller</a></li>
<li><a href="#ag_custom_inventory_script">2. Custom Inventory Scripts</a></li>
<li><a href="#ag_inv_import">3. Inventory File Importing</a>
<ul class="sectlevel2">
<li><a href="#_custom_dynamic_inventory_scripts">3.1. Custom Dynamic Inventory Scripts</a></li>
<li><a href="#_scm_inventory_source_fields">3.2. SCM Inventory Source Fields</a>
<ul class="sectlevel3">
<li><a href="#_supported_file_syntax">3.2.1. Supported File Syntax</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ag_multicred_assgn">4. Multi-Credential Assignment</a>
<ul class="sectlevel2">
<li><a href="#_background">4.1. Background</a></li>
<li><a href="#_important_changes">4.2. Important Changes</a></li>
<li><a href="#_launch_time_considerations">4.3. Launch Time Considerations</a></li>
<li><a href="#ag_multi_vault">4.4. Multi-Vault Credentials</a>
<ul class="sectlevel3">
<li><a href="#_prompted_vault_credentials">4.4.1. Prompted Vault Credentials</a></li>
<li><a href="#_linked_credentials">4.4.2. Linked credentials</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ag_management_jobs">5. Management Jobs</a>
<ul class="sectlevel2">
<li><a href="#_removing_old_activity_stream_data">5.1. Removing Old Activity Stream Data</a>
<ul class="sectlevel3">
<li><a href="#ag_mgmt_job_schedule">5.1.1. Scheduling</a></li>
<li><a href="#ag_mgmt_job_notify">5.1.2. Notifications</a></li>
</ul>
</li>
<li><a href="#_cleanup_expired_oauth2_tokens">5.2. Cleanup Expired OAuth2 Tokens</a></li>
<li><a href="#_cleanup_expired_sessions">5.3. Cleanup Expired Sessions</a></li>
<li><a href="#_removing_old_job_history">5.4. Removing Old Job History</a></li>
</ul>
</li>
<li><a href="#ag_clustering">6. Clustering</a>
<ul class="sectlevel2">
<li><a href="#_setup_considerations">6.1. Setup Considerations</a></li>
<li><a href="#_install_and_configure">6.2. Install and Configure</a></li>
<li><a href="#_status_and_monitoring_via_browser_api">6.3. Status and Monitoring via Browser API</a></li>
<li><a href="#_instance_services_and_failure_behavior">6.4. Instance Services and Failure Behavior</a></li>
<li><a href="#_job_runtime_behavior">6.5. Job Runtime Behavior</a>
<ul class="sectlevel3">
<li><a href="#_job_runs">6.5.1. Job Runs</a></li>
</ul>
</li>
<li><a href="#ag_cluster_deprovision">6.6. Deprovision Instances</a></li>
</ul>
</li>
<li><a href="#ag_ext_exe_env">7. Container and Instance Groups</a>
<ul class="sectlevel2">
<li><a href="#ag_instance_groups">7.1. Instance Groups</a>
<ul class="sectlevel3">
<li><a href="#ag_automationcontroller_group_policies">7.1.1. <code>automationcontroller</code> group policies</a></li>
<li><a href="#_configuring_instance_groups_from_the_api">7.1.2. Configuring Instance Groups from the API</a></li>
<li><a href="#ag_instance_group_policies">7.1.3. Instance group policies</a></li>
<li><a href="#_notable_policy_considerations">7.1.4. Notable policy considerations</a></li>
<li><a href="#_manually_pinning_instances_to_specific_groups">7.1.5. Manually pinning instances to specific groups</a></li>
<li><a href="#_job_runtime_behavior_2">7.1.6. Job Runtime Behavior</a></li>
<li><a href="#_control_where_a_job_runs">7.1.7. Control Where a Job Runs</a></li>
<li><a href="#ag_instancegrp_deprovision">7.1.8. Deprovision Instance Groups</a></li>
</ul>
</li>
<li><a href="#ag_container_groups">7.2. Container Groups</a>
<ul class="sectlevel3">
<li><a href="#_create_a_container_group">7.2.1. Create a container group</a></li>
<li><a href="#ag_customize_pod_spec">7.2.2. Customize the Pod spec</a></li>
<li><a href="#_verify_container_group_functions">7.2.3. Verify container group functions</a></li>
<li><a href="#_view_container_group_jobs">7.2.4. View container group jobs</a></li>
<li><a href="#_kubernetes_api_failure_conditions">7.2.5. Kubernetes API failure conditions</a></li>
<li><a href="#ag_container_capacity">7.2.6. Container capacity limits</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ag_topology_viewer">8. Topology Viewer</a></li>
<li><a href="#_controller_logfiles">9. Controller Logfiles</a></li>
<li><a href="#ag_logging">10. Logging and Aggregation</a>
<ul class="sectlevel2">
<li><a href="#_loggers">10.1. Loggers</a>
<ul class="sectlevel3">
<li><a href="#_log_message_schema">10.1.1. Log message schema</a></li>
<li><a href="#_activity_stream_schema">10.1.2. Activity stream schema</a></li>
<li><a href="#_job_event_schema">10.1.3. Job event schema</a></li>
<li><a href="#_scan_fact_system_tracking_data_schema">10.1.4. Scan / fact / system tracking data schema</a></li>
<li><a href="#_job_status_changes">10.1.5. Job status changes</a></li>
<li><a href="#_controller_logs">10.1.6. Controller logs</a></li>
<li><a href="#_logging_aggregator_services">10.1.7. Logging Aggregator Services</a></li>
</ul>
</li>
<li><a href="#ag_ctit_logging">10.2. Set Up Logging</a>
<ul class="sectlevel3">
<li><a href="#_log_aggregation">10.2.1. Log Aggregation</a></li>
<li><a href="#logging-api-400-error-config">10.2.2. API 4XX Error Configuration</a></li>
</ul>
</li>
<li><a href="#_troubleshoot_logging">10.3. Troubleshoot Logging</a>
<ul class="sectlevel3">
<li><a href="#_logging_aggregation">10.3.1. Logging Aggregation</a></li>
<li><a href="#_api_4xx_errors">10.3.2. API 4XX Errors</a></li>
<li><a href="#_ldap">10.3.3. LDAP</a></li>
<li><a href="#_saml">10.3.4. SAML</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ag_metrics">11. Metrics</a>
<ul class="sectlevel2">
<li><a href="#_set_up_prometheus">11.1. Set up Prometheus</a></li>
</ul>
</li>
<li><a href="#ag_secret_handling">12. Secret handling and connection security</a>
<ul class="sectlevel2">
<li><a href="#_secret_handling">12.1. Secret Handling</a>
<ul class="sectlevel3">
<li><a href="#_secret_handling_for_automation_use">12.1.1. Secret handling for automation use</a></li>
</ul>
</li>
<li><a href="#_connection_security">12.2. Connection Security</a>
<ul class="sectlevel3">
<li><a href="#_internal_services">12.2.1. Internal Services</a></li>
<li><a href="#_external_access">12.2.2. External Access</a></li>
<li><a href="#_managed_nodes">12.2.3. Managed Nodes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ag_security_best_practices">13. Security Best Practices</a>
<ul class="sectlevel2">
<li><a href="#_general_best_practices">13.1. General best practices</a></li>
<li><a href="#_understand_the_architecture_of_ansible_and_the_controller">13.2. Understand the architecture of Ansible and the controller</a></li>
<li><a href="#_granting_access">13.3. Granting access</a>
<ul class="sectlevel3">
<li><a href="#_minimize_administrative_accounts">13.3.1. Minimize administrative accounts</a></li>
<li><a href="#_minimize_local_system_access">13.3.2. Minimize local system access</a></li>
<li><a href="#_remove_access_to_credentials_from_users">13.3.3. Remove access to credentials from users</a></li>
<li><a href="#_enforce_separation_of_duties">13.3.4. Enforce separation of duties</a></li>
</ul>
</li>
<li><a href="#_available_resources">13.4. Available resources</a>
<ul class="sectlevel3">
<li><a href="#_audit_and_logging_functionality">13.4.1. Audit and logging functionality</a></li>
<li><a href="#_existing_security_functionality">13.4.2. Existing security functionality</a></li>
<li><a href="#_external_account_stores">13.4.3. External account stores</a></li>
<li><a href="#ag_security_django_password">13.4.4. Django password policies</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ag_manage_utility">14. The <em>awx-manage</em> Utility</a>
<ul class="sectlevel2">
<li><a href="#_inventory_import">14.1. Inventory Import</a></li>
<li><a href="#_cleanup_of_old_data">14.2. Cleanup of old data</a></li>
<li><a href="#_cluster_management">14.3. Cluster management</a></li>
<li><a href="#ag_token_utility">14.4. Token and session management</a>
<ul class="sectlevel3">
<li><a href="#_create_oauth2_token">14.4.1. <code>create_oauth2_token</code></a></li>
<li><a href="#ag_manage_utility_revoke_tokens">14.4.2. <code>revoke_oauth2_tokens</code></a></li>
<li><a href="#_cleartokens">14.4.3. <code>cleartokens</code></a></li>
<li><a href="#_expire_sessions">14.4.4. <code>expire_sessions</code></a></li>
<li><a href="#_clearsessions">14.4.5. <code>clearsessions</code></a></li>
</ul>
</li>
<li><a href="#_analytics_gathering">14.5. Analytics gathering</a></li>
</ul>
</li>
<li><a href="#ag_configure_tower">15. Controller Configuration</a></li>
<li><a href="#ag_isolation_variables">16. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">17. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">18. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">19. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">20. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">21. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">22. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">23. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">24. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">25. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">26. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">27. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">28. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">29. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">30. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">31. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">32. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">33. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">34. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">35. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">36. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">37. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">38. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">39. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">40. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">41. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">42. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">43. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">44. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">45. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">46. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">47. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">48. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">49. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">50. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">51. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">52. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">53. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">54. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">55. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">56. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">57. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">58. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">59. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">60. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">61. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">62. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">63. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">64. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">65. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">66. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">67. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">68. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">69. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">70. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">71. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">72. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">73. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">74. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">75. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">76. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">77. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">78. Isolation functionality and variables</a></li>
<li><a href="#ag_oauth2_token_auth">79. Token-Based Authentication</a>
<ul class="sectlevel2">
<li><a href="#_managing_oauth_2_applications_and_tokens">79.1. Managing OAuth 2 Applications and Tokens</a>
<ul class="sectlevel3">
<li><a href="#_access_rules_for_applications">79.1.1. Access Rules for Applications</a></li>
<li><a href="#_access_rules_for_tokens">79.1.2. Access rules for tokens</a></li>
</ul>
</li>
<li><a href="#ag_use_oauth_pat">79.2. Using OAuth 2 Token System for Personal Access Tokens (PAT)</a>
<ul class="sectlevel3">
<li><a href="#_token_scope_mask_over_rbac_system">79.2.1. Token scope mask over RBAC system</a></li>
</ul>
</li>
<li><a href="#ag_oauth2_token_auth_grant_types">79.3. Application Functions</a>
<ul class="sectlevel3">
<li><a href="#_application_using_authorization_code_grant_type">79.3.1. Application using <code>authorization code</code> grant type</a></li>
<li><a href="#_application_using_password_grant_type">79.3.2. Application using <code>password</code> grant type</a></li>
</ul>
</li>
<li><a href="#_application_token_functions">79.4. Application Token Functions</a>
<ul class="sectlevel3">
<li><a href="#_refresh_an_existing_access_token">79.4.1. Refresh an existing access token</a></li>
<li><a href="#ag_oauth2_token_revoke">79.4.2. Revoke an access token</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ag_social_auth">80. Setting up Social Authentication</a>
<ul class="sectlevel2">
<li><a href="#ag_auth_github">80.1. GitHub settings</a>
<ul class="sectlevel3">
<li><a href="#ag_auth_github_org">80.1.1. GitHub Organization settings</a></li>
<li><a href="#ag_auth_github_team">80.1.2. GitHub Team settings</a></li>
<li><a href="#_github_enterprise_settings">80.1.3. GitHub Enterprise settings</a></li>
<li><a href="#_github_enterprise_organization_settings">80.1.4. GitHub Enterprise Organization settings</a></li>
<li><a href="#_github_enterprise_team_settings">80.1.5. GitHub Enterprise Team settings</a></li>
</ul>
</li>
<li><a href="#ag_auth_google_oauth2">80.2. Google OAuth2 settings</a></li>
<li><a href="#ag_org_team_maps">80.3. Organization and Team Mapping</a>
<ul class="sectlevel3">
<li><a href="#_organization_mapping">80.3.1. Organization mapping</a></li>
<li><a href="#_team_mapping">80.3.2. Team mapping</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ag_ent_auth">81. Setting up Enterprise Authentication</a>
<ul class="sectlevel2">
<li><a href="#ag_auth_azure">81.1. Azure AD settings</a></li>
<li><a href="#_ldap_authentication">81.2. LDAP Authentication</a></li>
<li><a href="#ag_auth_radius">81.3. RADIUS settings</a></li>
<li><a href="#ag_auth_saml">81.4. SAML settings</a>
<ul class="sectlevel3">
<li><a href="#_transparent_saml_logins">81.4.1. Transparent SAML Logins</a></li>
<li><a href="#_enabling_logging_for_saml">81.4.2. Enabling Logging for SAML</a></li>
</ul>
</li>
<li><a href="#ag_auth_tacacs">81.5. TACACS+ settings</a></li>
</ul>
</li>
<li><a href="#ag_auth_ldap">82. Setting up LDAP Authentication</a>
<ul class="sectlevel2">
<li><a href="#_referrals">82.1. Referrals</a></li>
<li><a href="#ldap_logging">82.2. Enabling Logging for LDAP</a></li>
<li><a href="#ag_ldap_org_team_maps">82.3. LDAP Organization and Team Mapping</a></li>
</ul>
</li>
<li><a href="#_changing_the_default_timeout_for_authentication">83. Changing the Default Timeout for Authentication</a></li>
<li><a href="#_user_authentication_with_kerberos">84. User Authentication with Kerberos</a>
<ul class="sectlevel2">
<li><a href="#_ad_and_kerberos_credentials">84.1. AD and Kerberos Credentials</a></li>
<li><a href="#_working_with_kerberos_tickets">84.2. Working with Kerberos Tickets</a></li>
</ul>
</li>
<li><a href="#ag_session_limits">85. Working with Session Limits</a></li>
<li><a href="#ag_backup_restore">86. Backing Up and Restoring</a>
<ul class="sectlevel2">
<li><a href="#_backuprestore_playbooks">86.1. Backup/Restore Playbooks</a></li>
<li><a href="#_backup_and_restoration_considerations">86.2. Backup and Restoration Considerations</a></li>
<li><a href="#ag_clustering_backup_restore">86.3. Backup and Restore for Clustered Environments</a>
<ul class="sectlevel3">
<li><a href="#ag_clustering_backup_restore_diff_cluster">86.3.1. Restoring to a different cluster</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#user_data_insights">87. Automation Analytics</a>
<ul class="sectlevel2">
<li><a href="#_usage_by_organization">87.1. Usage by organization</a></li>
<li><a href="#_job_runs_by_organization">87.2. Job runs by organization</a></li>
<li><a href="#_organization_status">87.3. Organization status</a></li>
</ul>
</li>
<li><a href="#_details_of_data_collection">88. Details of data collection</a>
<ul class="sectlevel2">
<li><a href="#_manifest_json">88.1. manifest.json</a></li>
<li><a href="#_config_json">88.2. config.json</a></li>
<li><a href="#_instance_info_json">88.3. instance_info.json</a></li>
<li><a href="#_counts_json">88.4. counts.json</a></li>
<li><a href="#_org_counts_json">88.5. org_counts.json</a></li>
<li><a href="#_cred_type_counts_json">88.6. cred_type_counts.json</a></li>
<li><a href="#_inventory_counts_json">88.7. inventory_counts.json</a></li>
<li><a href="#_projects_by_scm_type_json">88.8. projects_by_scm_type.json</a></li>
<li><a href="#_query_info_json">88.9. query_info.json</a></li>
<li><a href="#_job_counts_json">88.10. job_counts.json</a></li>
<li><a href="#_job_instance_counts_json">88.11. job_instance_counts.json</a></li>
<li><a href="#_unified_job_template_table_csv">88.12. unified_job_template_table.csv</a></li>
<li><a href="#_unified_jobs_table_csv">88.13. unified_jobs_table.csv</a></li>
<li><a href="#_workflow_job_template_node_table_csv">88.14. workflow_job_template_node_table.csv</a></li>
<li><a href="#_workflow_job_node_table_csv">88.15. workflow_job_node_table.csv</a></li>
<li><a href="#_events_table_csv">88.16. events_table.csv</a></li>
</ul>
</li>
<li><a href="#admin_troubleshooting">89. Troubleshooting the controller</a>
<ul class="sectlevel2">
<li><a href="#_error_logs">89.1. Error logs</a></li>
<li><a href="#admin_troubleshooting_sosreport">89.2. sosreport</a></li>
<li><a href="#_problems_connecting_to_your_host">89.3. Problems connecting to your host</a></li>
<li><a href="#_unable_to_login_to_the_controller_via_http">89.4. Unable to login to the controller via HTTP</a></li>
<li><a href="#_websockets_port_for_live_events_not_working">89.5. WebSockets port for live events not working</a></li>
<li><a href="#_problems_running_a_playbook">89.6. Problems running a playbook</a></li>
<li><a href="#_problems_when_running_a_job">89.7. Problems when running a job</a></li>
<li><a href="#_playbooks_arent_showing_up_in_the_job_template_drop_down">89.8. Playbooks aren&#8217;t showing up in the "Job Template" drop-down</a></li>
<li><a href="#_playbook_stays_in_pending">89.9. Playbook stays in pending</a></li>
<li><a href="#_cancel_a_controller_job">89.10. Cancel a controller job</a></li>
<li><a href="#_reusing_an_external_database_causes_installations_to_fail">89.11. Reusing an external database causes installations to fail</a></li>
</ul>
</li>
<li><a href="#ag_isolation_variables">90. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">91. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">92. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">93. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">94. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">95. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">96. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">97. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">98. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">99. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">100. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">101. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">102. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">103. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">104. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">105. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">106. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">107. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">108. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">109. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">110. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">111. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">112. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">113. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">114. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">115. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">116. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">117. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">118. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">119. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">120. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">121. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">122. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">123. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">124. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">125. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">126. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">127. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">128. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">129. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">130. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">131. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">132. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">133. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">134. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">135. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">136. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">137. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">138. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">139. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">140. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">141. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">142. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">143. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">144. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">145. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">146. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">147. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">148. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">149. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">150. Isolation functionality and variables</a></li>
<li><a href="#ag_isolation_variables">151. Isolation functionality and variables</a>
<ul class="sectlevel2">
<li><a href="#_private_ec2_vpc_instances_in_the_controller_inventory">151.1. Private EC2 VPC Instances in the controller Inventory</a></li>
<li><a href="#_troubleshooting_error_provided_hosts_list_is_empty">151.2. Troubleshooting "Error: provided hosts list is empty"</a></li>
</ul>
</li>
<li><a href="#tips_and_tricks">152. Controller Tips and Tricks</a>
<ul class="sectlevel2">
<li><a href="#_using_the_controller_cli_tool">152.1. Using the Controller CLI Tool</a></li>
<li><a href="#tips_change_password">152.2. Changing the Controller Admin Password</a></li>
<li><a href="#_creating_a_controller_admin_from_the_commandline">152.3. Creating a controller Admin from the commandline</a></li>
<li><a href="#_setting_up_a_jump_host_to_use_with_the_controller">152.4. Setting up a jump host to use with the controller</a></li>
<li><a href="#_view_ansible_outputs_for_json_commands_when_using_the_controller">152.5. View Ansible outputs for JSON commands when using the controller</a></li>
<li><a href="#_locate_and_configure_the_ansible_configuration_file">152.6. Locate and configure the Ansible configuration file</a></li>
<li><a href="#_view_a_listing_of_all_ansible_variables">152.7. View a listing of all ansible_ variables</a></li>
<li><a href="#ag_tips_jinja_extravars">152.8. The ALLOW_JINJA_IN_EXTRA_VARS variable</a></li>
<li><a href="#_configuring_the_controllerhost_hostname_for_notifications">152.9. Configuring the <code>controllerhost</code> hostname for notifications</a></li>
<li><a href="#launch_jobs_curl">152.10. Launching Jobs with curl</a></li>
<li><a href="#_dynamic_inventory_and_private_ip_addresses">152.11. Dynamic Inventory and private IP addresses</a></li>
<li><a href="#_filtering_instances_returned_by_the_dynamic_inventory_sources_in_the_controller">152.12. Filtering instances returned by the dynamic inventory sources in the controller</a></li>
<li><a href="#_using_an_unreleased_module_from_ansible_source_with_the_controller">152.13. Using an unreleased module from Ansible source with the controller</a></li>
<li><a href="#_using_callback_plugins_with_the_controller">152.14. Using callback plugins with the controller</a></li>
<li><a href="#_connecting_to_windows_with_winrm">152.15. Connecting to Windows with winrm</a></li>
<li><a href="#_importing_existing_inventory_files_and_hostgroup_vars_into_the_controller">152.16. Importing existing inventory files and host/group vars into the controller</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Perform administrative tasks for Ansible Automation Platform Controller.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_restart_tower"><a class="anchor" href="#ag_restart_tower"></a>1. Starting, Stopping, and Restarting the Controller</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Automation controller ships with an <em>admin utility script</em>,
<code>automation-controller-service</code>, that can start, stop, and restart all
the controller services running on the current single controller node
(including the message queue components, and the database if it is an
integrated installation). External databases must be explicitly managed
by the administrator. The services script resides in
<code>/usr/bin/automation-controller-service</code> and can be invoked as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>root@localhost:~$ automation-controller-service restart</pre>
</div>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>In clustered installs, <code>automation-controller-service restart</code> does not
include PostgreSQL as part of the services that are restarted because it
exists external to the controller, and because PostgreSQL does not
always require a restart. Use <code>systemctl restart automation-controller</code>
to restart services on clustered environments instead. Also you must
restart each cluster node for certain changes to persist as opposed to a
single node for a localhost install. For more information on clustered
environments, see the <code>ag_clustering</code> section.</p>
</div>
<div class="paragraph">
<p>You can also invoke the services script via distribution-specific
service management commands. Distribution packages often provide a
similar script, sometimes as an init script, to manage services. Refer
to your distribution-specific service management system for more
information.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>When running the controller in a container, do not use the
<code>automation-controller-service</code> script. Restart the pod using the
container environment instead.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_custom_inventory_script"><a class="anchor" href="#ag_custom_inventory_script"></a>2. Custom Inventory Scripts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inventory scripts have been discontinued. For more information, see
<code>ug_customscripts</code> in the Automation Controller User Guide.</p>
</div>
<div class="paragraph">
<p>If you use custom inventory scripts, migrate to sourcing these scripts
from a project. See <code>ag_inv_import</code> in the subsequent chapter, and also
refer to <code>ug_inventory_sources</code> in the Automation Controller User Guide
for more detail.</p>
</div>
<div class="paragraph">
<p>If you are setting up an inventory file, refer to the
<a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.1/html/red_hat_ansible_automation_platform_installation_guide/single-machine-scenario">Red
Hat Ansible Automation Platform Installation Guide</a> on
<a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform">access.redhat.com</a>
and find examples specific to your setup.</p>
</div>
<div class="paragraph">
<p>If you are migrating to execution environments, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>upgrade_venv</code></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.1/html/red_hat_ansible_automation_platform_automation_mesh_guide/assembly-standalone-controller-non-inst-database">Designing
a mesh deployment in your environment</a></p>
</li>
<li>
<p><code>mesh_topology_ee</code> in the Ansible Automation Platform Upgrade and
Migration Guide to validate your topology</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To learn more about automation mesh, refer to the
<a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.1/html/red_hat_ansible_automation_platform_automation_mesh_guide/assembly-planning-mesh">Red
Hat Ansible Automation Mesh Guide</a> on
<a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform">access.redhat.com</a>.</p>
</div>
<div class="paragraph">
<p>If you already have a mesh topology set up and want to view node type,
node health, and specific details about each node, see
<code>ag_topology_viewer</code> later in this guide.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_inv_import"><a class="anchor" href="#ag_inv_import"></a>3. Inventory File Importing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The controller allows you to choose an inventory file from source
control, rather than creating one from scratch. This function is the
same as custom inventory scripts, except that the contents are obtained
from source control instead of editing their contents browser. This
means, the files are non-editable and as inventories are updated at the
source, the inventories within the projects are also updated
accordingly, including the <code>group_vars</code> and <code>host_vars</code> files or
directory associated with them. SCM types can consume both inventory
files and scripts, the overlap between inventory files and custom types
in that both do scripts.</p>
</div>
<div class="paragraph">
<p>Any imported hosts will have a description of "imported" by default.
This can be overridden by setting the <code>_awx_description</code> variable on a
given host. For example, if importing from a sourced .ini file, you
could add the following host variables:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[main]
127.0.0.1 _awx_description="my host 1"
127.0.0.2 _awx_description="my host 2"</pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, group descriptions also default to "imported", but can be
overridden by the <code>_awx_description</code> as well.</p>
</div>
<div class="paragraph">
<p>In order to use old inventory scripts in source control, see
<code>ug_customscripts</code> in the Automation Controller User Guide for detail.</p>
</div>
<div class="sect2">
<h3 id="_custom_dynamic_inventory_scripts"><a class="anchor" href="#_custom_dynamic_inventory_scripts"></a>3.1. Custom Dynamic Inventory Scripts</h3>
<div class="paragraph">
<p>A custom dynamic inventory script stored in version control can be
imported and run. This makes it much easier to make changes to an
inventory script — rather than having to copy and paste one into the
controller, it is pulled directly from source control and then executed.
The script must be written to handle any credentials needed for doing
its work and you are responsible for installing any Python libraries
needed by the script (which is the same requirement for custom dynamic
inventory scripts). And this applies to both user-defined inventory
source scripts and SCM sources as they are both exposed to Ansible
<em>virtualenv</em> requirements related to playbooks.</p>
</div>
<div class="paragraph">
<p>You can specify environment variables when you edit the SCM inventory
source itself. For some scripts, this will be sufficient, however, this
is not a secure way to store secret information that gives access to
cloud providers or inventory.</p>
</div>
<div class="paragraph">
<p>The better way is to create a new credential type for the inventory
script you are going to use. The credential type will need to specify
all the necessary types of inputs. Then, when you create a credential of
this type, the secrets will be stored in an encrypted form. If you apply
that credential to the inventory source, the script will have access to
those inputs like environment variables or files.</p>
</div>
<div class="paragraph">
<p>For more detail, refer to
<code>Credential types &lt;userguide:ug_credential_types&gt;</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scm_inventory_source_fields"><a class="anchor" href="#_scm_inventory_source_fields"></a>3.2. SCM Inventory Source Fields</h3>
<div class="paragraph">
<p>The source fields used are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>source_project</code>: project to use</p>
</li>
<li>
<p><code>source_path</code>: relative path inside the project indicating a directory
or a file. If left blank, "" is still a relative path indicating the
root directory of the project</p>
</li>
<li>
<p><code>source_vars</code>: if set on a "file" type inventory source then they will
be passed to the environment vars when running</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An update of the project automatically triggers an inventory update
where it is used. An update of the project is scheduled immediately
after creation of the inventory source. Neither inventory nor project
updates are blocked while a related job is running. In cases where you
have a big project (around 10 GB), disk space on <code>/tmp</code> may be an issue.</p>
</div>
<div class="paragraph">
<p>You can specify a location manually in the controller User Interface
from the Create Inventory Source page. Refer to the <code>ug_inventories</code>
section of the Automation Controller User Guide for instructions on
creating an inventory source.</p>
</div>
<div class="paragraph">
<p>This listing should be refreshed to latest SCM info on a project update.
If no inventory sources use a project as an SCM inventory source, then
the inventory listing may not be refreshed on update.</p>
</div>
<div class="paragraph">
<p>For inventories with SCM sources, the Job Details page for inventory
updates show a status indicator for the project update as well as the
name of the project. The status indicator links to the project update
job. The project name links to the project.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/jobs-details-scm-sourced-inventories.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>An inventory update can be performed while a related job is running.</p>
</div>
<div class="sect3">
<h4 id="_supported_file_syntax"><a class="anchor" href="#_supported_file_syntax"></a>3.2.1. Supported File Syntax</h4>
<div class="paragraph">
<p>automation controller uses the <code>ansible-inventory</code> module from Ansible
to process inventory files, and supports all valid inventory syntax that
the controller requires.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_multicred_assgn"><a class="anchor" href="#ag_multicred_assgn"></a>4. Multi-Credential Assignment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>automation controller provides support for assigning zero or more
credentials to a job template.</p>
</div>
<div class="sect2">
<h3 id="_background"><a class="anchor" href="#_background"></a>4.1. Background</h3>
<div class="paragraph">
<p>Prior to automation controller 3.3, job templates had a certain set of
requirements with respect to credentials:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All job templates (and jobs) were required to have exactly <em>one</em>
Machine/SSH or Vault credential (or one of both).</p>
</li>
<li>
<p>All job templates (and jobs) could have zero or more "extra"
credentials.</p>
</li>
<li>
<p>Extra credentials represented "Cloud" and "Network" credentials that
could be used to provide authentication to external services via
environment variables (e.g., <code>AWS_ACCESS_KEY_ID</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This model required a variety of disjoint interfaces for specifying
credentials on a job template and it lacked the ability associate
multiple Vault credentials with a playbook run, a use case supported by
Ansible core from Ansible 2.4 onwards.</p>
</div>
<div class="paragraph">
<p>This model also poses a stumbling block for certain playbook execution
workflows, such as having to attach a "dummy" Machine/SSH credential to
the job template simply to satisfy the requirement.</p>
</div>
</div>
<div class="sect2">
<h3 id="_important_changes"><a class="anchor" href="#_important_changes"></a>4.2. Important Changes</h3>
<div class="paragraph">
<p>Job templates now have a single interface for credential assignment.
From the API endpoint:</p>
</div>
<div class="paragraph">
<p><code>GET /api/v2/job_templates/N/credentials/</code></p>
</div>
<div class="paragraph">
<p>You can associate and disassociate credentials using <code>POST</code> requests,
similar to the behavior in the deprecated <code>extra_credentials</code> endpoint:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>POST /api/v2/job_templates/N/credentials/ {'associate': true, 'id': 'X'}
POST /api/v2/job_templates/N/credentials/ {'disassociate': true, 'id': 'Y'}</pre>
</div>
</div>
<div class="paragraph">
<p>Under this model, a job template is considered valid even when there are
<em>no</em> credentials assigned to it. This model also provides users the
ability to assign multiple Vault credentials to a job template.</p>
</div>
</div>
<div class="sect2">
<h3 id="_launch_time_considerations"><a class="anchor" href="#_launch_time_considerations"></a>4.3. Launch Time Considerations</h3>
<div class="paragraph">
<p>Prior to automation controller 3.3, job templates had a configurable
attribute, <code>ask_credential_on_launch</code>. This value was used at launch
time to determine which missing credential values were necessary for
launch - this was primarily used as a way to specify a Machine/SSH
credential to satisfy the minimum credential requirement.</p>
</div>
<div class="paragraph">
<p>Under the new unified credential list model, this attribute still
exists, but it is no longer "requiring" a credential. Now when
<code>ask_credential_on_launch</code> is <code>True</code>, it signifies that if desired, you
may specify a list of credentials at launch time to override those
defined on the job template. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>POST /api/v2/job_templates/N/launch/ {'credentials': [A, B, C]}`</pre>
</div>
</div>
<div class="paragraph">
<p>If <code>ask_credential_on_launch</code> is <code>False</code>, it signifies that custom
credentials provided in the <code>POST /api/v2/job_templates/N/launch/</code> will
be ignored.</p>
</div>
<div class="paragraph">
<p>Under this model, the only purpose for <code>ask_credential_on_launch</code> is to
signal API clients to prompt the user for (optional) changes at launch
time.</p>
</div>
</div>
<div class="sect2">
<h3 id="ag_multi_vault"><a class="anchor" href="#ag_multi_vault"></a>4.4. Multi-Vault Credentials</h3>
<div class="paragraph">
<p>As it possible to assign multiple credentials to a job, you can specify
multiple Vault credentials to decrypt when your job template runs. This
functionality mirrors the support for
<a href="http://docs.ansible.com/ansible/latest/vault.html#vault-ids-and-multiple-vault-passwords">multiple
vault passwords for a playbook run</a> in Ansible 2.4 and later.</p>
</div>
<div class="paragraph">
<p>Vault credentials now have an optional field, <code>vault_id</code>, which is
analogous to the <code>--vault-id</code> argument to <code>ansible-playbook</code>. To run a
playbook which makes use of multiple vault passwords:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Vault credential in the controller for each vault password;
specify the Vault ID as a field on the credential and input the password
(which will be encrypted and stored).</p>
</li>
<li>
<p>Assign multiple vault credentials to the job template via the new
credentials endpoint:</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>POST /api/v2/job_templates/N/credentials/

{
    'associate': true,
    'id': X
}</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can perform the same assignment in the controller
User Interface in the <em>Create Credential</em> page:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/credentials-create-multivault-credential.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>In the above example, the credential created specifies the secret to be
used by its Vault Identifier ("first") and password pair. When this
credential is used in a Job Template, as in the example below, it will
only decrypt the secret associated with the "first" Vault ID:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/job-template-include-multi-vault-credential.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>If you have a playbook that is setup the traditional way with all the
secrets in one big file without distinction, then leave the <strong>Vault
Identifier</strong> field blank when setting up the Vault credential:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/credentials-create-novaultid-credential.png" alt="image"></span></p>
</div>
<div class="sect3">
<h4 id="_prompted_vault_credentials"><a class="anchor" href="#_prompted_vault_credentials"></a>4.4.1. Prompted Vault Credentials</h4>
<div class="paragraph">
<p>Passwords for Vault credentials that are marked with "Prompt on launch",
the launch endpoint of any related Job Templates will communicate
necessary Vault passwords via the <code>passwords_needed_to_start</code> key:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/v2/job_templates/N/launch/
{
    'passwords_needed_to_start': [
        'vault_password.X',
        'vault_password.Y',
    ]
}</pre>
</div>
</div>
<div class="paragraph">
<p><code>X</code> and <code>Y</code> in the above example are primary keys of the associated
Vault credentials.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>POST /api/v2/job_templates/N/launch/
{
    'credential_passwords': {
        'vault_password.X': 'first-vault-password'
        'vault_password.Y': 'second-vault-password'
    }
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_linked_credentials"><a class="anchor" href="#_linked_credentials"></a>4.4.2. Linked credentials</h4>
<div class="paragraph">
<p>Instead of uploading sensitive credential information into the
controller, you can link credential fields to external systems and using
them to run your playbooks. Refer to the
<code>Secret Management System &lt;userguide:ug_credential_plugins&gt;</code> section of
the Automation Controller User Guide.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_management_jobs"><a class="anchor" href="#ag_management_jobs"></a>5. Management Jobs</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Management Jobs</strong> assist in the cleaning of old data from the
controller, including system tracking information, tokens, job
histories, and activity streams. You can use this if you have specific
retention policies or need to decrease the storage used by your
controller database. Click <strong>Management Jobs</strong> from the left navigation
bar.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ug-management-jobs.png" alt="management jobs"></span></p>
</div>
<div class="paragraph">
<p>Several job types are available for you to schedule and launch:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Cleanup Activity Stream</strong>: Remove activity stream history older than a
specified number of days</p>
</li>
<li>
<p><strong>Cleanup Expired OAuth 2 Tokens</strong>: Remove expired OAuth 2 access tokens
and refresh tokens</p>
</li>
<li>
<p><strong>Cleanup Expired Sessions</strong>: Remove expired browser sessions from the
database</p>
</li>
<li>
<p><strong>Cleanup Job Details</strong>: Remove job history older than a specified
number of days</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_removing_old_activity_stream_data"><a class="anchor" href="#_removing_old_activity_stream_data"></a>5.1. Removing Old Activity Stream Data</h3>
<div class="paragraph">
<p>To remove older activity stream data, click on the launch
(<span class="image"><img src="images/launch-button.png" alt="launch"></span>) button
beside <strong>Cleanup Activity Stream</strong>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ug-management-jobs-remove-activity-stream-launch.png" alt="activity stream launch - remove activity stream launch"></span></p>
</div>
<div class="paragraph">
<p>Enter the number of days of data you would like to save and click
<strong>Launch</strong>.</p>
</div>
<div class="sect3">
<h4 id="ag_mgmt_job_schedule"><a class="anchor" href="#ag_mgmt_job_schedule"></a>5.1.1. Scheduling</h4>
<div class="paragraph">
<p>To review or set a schedule for purging data marked for deletion, click
on the <span class="image"><img src="images/schedule-button.png" alt="schedule"></span>
button.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ug-management-jobs-remove-activity-stream-schedule.png" alt="activity stream launch - remove activity stream schedule"></span></p>
</div>
<div class="paragraph">
<p>Note that you can turn this scheduled management job on and off easily
using the <strong>ON/OFF</strong> toggle button to the left of the Job Name.</p>
</div>
<div class="paragraph">
<p>Click on the Job Name, in this example "Cleanup Activity Schedule", to
review or edit the schedule settings. You can also use the <strong>Add</strong> button
to create a new schedule for this management job.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ug-management-jobs-remove-activity-stream-schedule-details.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Enter the appropriate details into the following fields and click
<strong>Save</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name (required)</p>
</li>
<li>
<p>Start Date (required)</p>
</li>
<li>
<p>Start Time (required)</p>
</li>
<li>
<p>Local Time Zone (the entered Start Time should be in this timezone)</p>
</li>
<li>
<p>Repeat Frequency (the appropriate options display as the update
frequency is modified.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>Details</strong> tab displays a description of the schedule and a list of
the scheduled occurrences in the selected Local Time Zone.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Jobs are scheduled in UTC. Repeating jobs that runs at a specific time
of day may move relative to a local timezone when Daylight Saving Time
shifts occur.</p>
</div>
</div>
<div class="sect3">
<h4 id="ag_mgmt_job_notify"><a class="anchor" href="#ag_mgmt_job_notify"></a>5.1.2. Notifications</h4>
<div class="paragraph">
<p>To set or review notifications associated with this management job,
click the Notifications (
<span class="image"><img src="images/notify-button.png" alt="notify"></span> ) icon.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/management-job-add-notification.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>If none exist, click the <strong>Notifications</strong> link to create a new
notification. Notification types include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Email</p>
</li>
<li>
<p>Grafana</p>
</li>
<li>
<p>IRC</p>
</li>
<li>
<p>Mattermost</p>
</li>
<li>
<p>PagerDuty</p>
</li>
<li>
<p>Rocket.Chat</p>
</li>
<li>
<p>Slack</p>
</li>
<li>
<p>Twilio</p>
</li>
<li>
<p>Webhook</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/management-job-add-notification-details.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Refer to <code>ug_notifications</code> in the Automation Controller User Guide for
more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cleanup_expired_oauth2_tokens"><a class="anchor" href="#_cleanup_expired_oauth2_tokens"></a>5.2. Cleanup Expired OAuth2 Tokens</h3>
<div class="paragraph">
<p>To remove expired OAuth2 tokens, click on the launch
(<span class="image"><img src="images/launch-button.png" alt="launch"></span>) button
beside <strong>Cleanup Expired OAuth2 Tokens</strong>.</p>
</div>
<div class="paragraph">
<p>You can review or set a schedule for cleaning up expired OAuth2 tokens
by performing the same procedure described for activity stream
management jobs. See <code>ag_mgmt_job_schedule</code> for detail.</p>
</div>
<div class="paragraph">
<p>You can also set or review notifications associated with this management
job the same way as described in <code>ag_mgmt_job_notify</code> for activity
stream management jobs, and refer to <code>ug_notifications</code> in the
Automation Controller User Guide for more detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cleanup_expired_sessions"><a class="anchor" href="#_cleanup_expired_sessions"></a>5.3. Cleanup Expired Sessions</h3>
<div class="paragraph">
<p>To remove expired sessions, click on the launch
(<span class="image"><img src="images/launch-button.png" alt="launch"></span>) button
beside <strong>Cleanup Expired Sessions</strong>.</p>
</div>
<div class="paragraph">
<p>You can review or set a schedule for cleaning up expired sessions by
performing the same procedure described for activity stream management
jobs. See <code>ag_mgmt_job_schedule</code> for detail.</p>
</div>
<div class="paragraph">
<p>You can also set or review notifications associated with this management
job the same way as described in <code>ag_mgmt_job_notify</code> for activity
stream management jobs, and refer to <code>ug_notifications</code> in the
Automation Controller User Guide for more detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removing_old_job_history"><a class="anchor" href="#_removing_old_job_history"></a>5.4. Removing Old Job History</h3>
<div class="paragraph">
<p>To remove job history older than a specified number of days, click on
the launch (<span class="image"><img src="images/launch-button.png" alt="launch"></span>)
button beside <strong>Cleanup Job Details</strong>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ug-management-jobs-cleanup-job-launch.png" alt="management jobs - cleanup job launch"></span></p>
</div>
<div class="paragraph">
<p>Enter the number of days of data you would like to save and click
<strong>Launch</strong>.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The initial job run for a controller resource (e.g. Projects, Job
Templates) is excluded from <strong>Cleanup Job Details</strong>, regardless of
retention value.</p>
</div>
<div class="paragraph">
<p>You can review or set a schedule for cleaning up old job history by
performing the same procedure described for activity stream management
jobs. See <code>ag_mgmt_job_schedule</code> for detail.</p>
</div>
<div class="paragraph">
<p>You can also set or review notifications associated with this management
job the same way as described in <code>ag_mgmt_job_notify</code> for activity
stream management jobs, and refer to <code>ug_notifications</code> in the
Automation Controller User Guide for more detail.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_clustering"><a class="anchor" href="#ag_clustering"></a>6. Clustering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Clustering is sharing load between hosts. Each instance should be able
to act as an entry point for UI and API access. This should enable the
controller administrators to use load balancers in front of as many
instances as they wish and maintain good data visibility.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Load balancing is optional and is entirely possible to have ingress on
one or all instances as needed.</p>
</div>
<div class="paragraph">
<p>Each instance should be able to join the controller cluster and expand
its ability to execute jobs. This is a simple system where jobs can and
will run anywhere rather than be directed on where to run. Also,
clustered instances can be grouped into different pools/queues, called
<code>ag_instance_groups</code>.</p>
</div>
<div class="paragraph">
<p>Ansible Automation Platform supports container-based clusters using
Kubernetes, meaning new controller instances can be installed on this
platform without any variation or diversion in functionality. You can
create instance groups to point to a Kubernetes container. For more
detail, see the <code>ag_ext_exe_env</code> section.</p>
</div>
<div class="paragraph">
<p><strong>Supported Operating Systems</strong></p>
</div>
<div class="paragraph">
<p>The following operating systems are supported for establishing a
clustered environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat Enterprise Linux 7 or later (RHEL8 recommended, can be either
RHEL 7 or Centos 7 instances)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Isolated instances are not supported in conjunction with running
automation controller in OpenShift.</p>
</div>
<div class="sect2">
<h3 id="_setup_considerations"><a class="anchor" href="#_setup_considerations"></a>6.1. Setup Considerations</h3>
<div class="paragraph">
<p>This section covers initial setup of clusters only. For upgrading an
existing cluster, refer to
<code>Upgrade Planning &lt;upgrade-migration-guide:upgrade_planning&gt;</code> of the
Ansible Automation Platform Upgrade and Migration Guide.</p>
</div>
<div class="paragraph">
<p>Important considerations to note in the new clustering environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PostgreSQL is still a standalone instance and is not clustered. The
controller does not manage replica configuration or database failover
(if the user configures standby replicas).</p>
</li>
<li>
<p>When spinning up a cluster, the database node should be a standalone
server, and PostgreSQL should not be installed on one of the controller
nodes.</p>
</li>
<li>
<p>The maximum supported instances in a cluster is 20.</p>
</li>
<li>
<p>All instances should be reachable from all other instances and they
should be able to reach the database. It is also important for the hosts
to have a stable address and/or hostname (depending on how the
controller host is configured).</p>
</li>
<li>
<p>All instances must be geographically collocated, with reliable
low-latency connections between instances.</p>
</li>
<li>
<p>For purposes of upgrading to a clustered environment, your primary
instance must be part of the <code>default</code> group in the inventory <em>AND</em> it
needs to be the first host listed in the <code>default</code> group.</p>
</li>
<li>
<p>Manual projects must be manually synced to all instances by the
customer, and updated on all instances at once.</p>
</li>
<li>
<p>The <code>inventory</code> file for platform deployments should be
saved/persisted. If new instances are to be provisioned, the passwords
and configuration options, as well as host names, must be made available
to the installer.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_install_and_configure"><a class="anchor" href="#_install_and_configure"></a>6.2. Install and Configure</h3>
<div class="paragraph">
<p>Provisioning new instances involves updating the <code>inventory</code> file and
re-running the setup playbook. It is important that the <code>inventory</code> file
contains all passwords and information used when installing the cluster
or other instances may be reconfigured. The <code>inventory</code> file inventory
contains a single inventory group, <code>automationcontroller</code>.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>All instances are responsible for various housekeeping tasks related to
task scheduling, like determining where jobs are supposed to be launched
and processing playbook events, as well as periodic cleanup.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[automationcontroller]
hostA
hostB
hostC

[instance_group_east]
hostB
hostC

[instance_group_west]
hostC
hostD</pre>
</div>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>If no groups are selected for a resource then the <code>automationcontroller</code>
group is used, but if any other group is selected, then the
<code>automationcontroller</code> group will not be used in any way.</p>
</div>
<div class="paragraph">
<p>The <code>database</code> group remains for specifying an external PostgreSQL. If
the database host is provisioned separately, this group should be empty:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[automationcontroller]
hostA
hostB
hostC

[database]
hostDB</pre>
</div>
</div>
<div class="paragraph">
<p>When a playbook runs on an individual controller instance in a cluster,
the output of that playbook is broadcast to all of the other nodes as
part of the controller&#8217;s websocket-based streaming output functionality.
It is best to handle this data broadcast using internal addressing by
specifying a private routable address for each node in your inventory:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="literalblock">
<div class="content">
<pre>[automationcontroller]
hostA routable_hostname=10.1.0.2
hostB routable_hostname=10.1.0.3
hostC routable_hostname=10.1.0.4</pre>
</div>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Prior versions of automation controller used the variable name
<code>rabbitmq_host</code>. If you are upgrading from a previous version of the
platform, and you previously specified <code>rabbitmq_host</code> in your
inventory, simply rename <code>rabbitmq_host</code> to <code>routable_hostname</code> before
upgrading.</p>
</div>
<div class="paragraph">
<p>Instances and Ports Used by the Controller and Automation Hub
<sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup><sup>^</sup>^</p>
</div>
<div class="paragraph">
<p>Ports and instances used by the controller and also required by the
on-premise Automation Hub node are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>80, 443 (normal controller and Automation Hub ports)</p>
</li>
<li>
<p>22 (ssh - ingress only required)</p>
</li>
<li>
<p>5432 (database instance - if the database is installed on an external
instance, needs to be opened to the controller instances)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_status_and_monitoring_via_browser_api"><a class="anchor" href="#_status_and_monitoring_via_browser_api"></a>6.3. Status and Monitoring via Browser API</h3>
<div class="paragraph">
<p>The controller itself reports as much status as it can via the Browsable
API at <code>/api/v2/ping</code> in order to provide validation of the health of
the cluster, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The instance servicing the HTTP request</p>
</li>
<li>
<p>The timestamps of the last heartbeat of all other instances in the
cluster</p>
</li>
<li>
<p>Instance Groups and Instance membership in those groups</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>View more details about Instances and Instance Groups, including running
jobs and membership information at <code>/api/v2/instances/</code> and
<code>/api/v2/instance_groups/</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instance_services_and_failure_behavior"><a class="anchor" href="#_instance_services_and_failure_behavior"></a>6.4. Instance Services and Failure Behavior</h3>
<div class="paragraph">
<p>Each controller instance is made up of several different services
working collaboratively:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP Services - This includes the controller application itself as
well as external web services.</p>
</li>
<li>
<p>Callback Receiver - Receives job events from running Ansible jobs.</p>
</li>
<li>
<p>Dispatcher - The worker queue that processes and runs all jobs.</p>
</li>
<li>
<p>Redis - This key value store is used as a queue for event data
propagated from ansible-playbook to the application.</p>
</li>
<li>
<p>Rsyslog - log processing service used to deliver logs to various
external logging services.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The controller is configured in such a way that if any of these services
or their components fail, then all services are restarted. If these fail
sufficiently often in a short span of time, then the entire instance
will be placed offline in an automated fashion in order to allow
remediation without causing unexpected behavior.</p>
</div>
<div class="paragraph">
<p>For backing up and restoring a clustered environment, refer to
<code>ag_clustering_backup_restore</code> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_job_runtime_behavior"><a class="anchor" href="#_job_runtime_behavior"></a>6.5. Job Runtime Behavior</h3>
<div class="paragraph">
<p>The way jobs are run and reported to a 'normal' user of controller does
not change. On the system side, some differences are worth noting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a job is submitted from the API interface it gets pushed into the
dispatcher queue. Each controller instance will connect to and receive
jobs from that queue using a particular scheduling algorithm. Any
instance in the cluster is just as likely to receive the work and
execute the task. If a instance fails while executing jobs, then the
work is marked as permanently failed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/tower-clustering-visual.png" alt="Controller Cluster example"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Project updates run successfully on any instance that could
potentially run a job. Projects will sync themselves to the correct
version on the instance immediately prior to running the job. If the
needed revision is already locally checked out and Galaxy or Collections
updates are not needed, then a sync may not be performed.</p>
</li>
<li>
<p>When the sync happens, it is recorded in the database as a project
update with a <code>launch_type = sync</code> and <code>job_type =  run</code>. Project syncs
will not change the status or version of the project; instead, they will
update the source tree <em>only</em> on the instance where they run.</p>
</li>
<li>
<p>If updates are needed from Galaxy or Collections, a sync is performed
that downloads the required roles, consuming that much more space in
your /tmp file. In cases where you have a big project (around 10 GB),
disk space on <code>/tmp</code> may be an issue.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_job_runs"><a class="anchor" href="#_job_runs"></a>6.5.1. Job Runs</h4>
<div class="paragraph">
<p>By default, when a job is submitted to the controller queue, it can be
picked up by any of the workers. However, you can control where a
particular job runs, such as restricting the instances from which a job
runs on.</p>
</div>
<div class="paragraph">
<p>In order to support temporarily taking an instance offline, there is a
property enabled defined on each instance. When this property is
disabled, no jobs will be assigned to that instance. Existing jobs will
finish, but no new work will be assigned.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ag_cluster_deprovision"><a class="anchor" href="#ag_cluster_deprovision"></a>6.6. Deprovision Instances</h3>
<div class="paragraph">
<p>Re-running the setup playbook does not automatically deprovision
instances since clusters do not currently distinguish between an
instance that was taken offline intentionally or due to failure.
Instead, shut down all services on the controller instance and then run
the deprovisioning tool from any other instance:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Shut down the instance or stop the service with the command,
<code>automation-controller-service stop</code>.</p>
</li>
<li>
<p>Run the deprovision command
<code>$ awx-manage deprovision_instance --hostname=&lt;name used in inventory file&gt;</code>
from another instance to remove it from the controller cluster.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Example: <code>awx-manage deprovision_instance --hostname=hostB</code></p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Similarly, deprovisioning instance groups in the controller does not
automatically deprovision or remove instance groups. For more
information, refer to the <code>ag_instancegrp_deprovision</code> section.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_ext_exe_env"><a class="anchor" href="#ag_ext_exe_env"></a>7. Container and Instance Groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The controller allows you to execute jobs via ansible playbook runs
directly on a member of the cluster or in a namespace of an Openshift
cluster with the necessary service account provisioned called a
Container Group. You can execute jobs in a container group only
as-needed per playbook. For more information, see <code>ag_container_groups</code>
towards the end of this section.</p>
</div>
<div class="paragraph">
<p>For execution environments, see <code>ug_execution_environments</code> in the
Automation Controller User Guide.</p>
</div>
<div class="sect2">
<h3 id="ag_instance_groups"><a class="anchor" href="#ag_instance_groups"></a>7.1. Instance Groups</h3>
<div class="paragraph">
<p>Instances can be grouped into one or more Instance Groups. Instance
groups can be assigned to one or more of the resources listed below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Organizations</p>
</li>
<li>
<p>Inventories</p>
</li>
<li>
<p>Job Templates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a job associated with one of the resources executes, it will be
assigned to the instance group associated with the resource. During the
execution process, instance groups associated with Job Templates are
checked before those associated with Inventories. Similarly, instance
groups associated with Inventories are checked before those associated
with Organizations. Thus, Instance Group assignments for the three
resources form a hierarchy: Job Template <strong>&gt;</strong> Inventory <strong>&gt;</strong> Organization.</p>
</div>
<div class="paragraph">
<p>Here are some of the things to consider when working with instance
groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You may optionally define other groups and group instances in those
groups. These groups should be prefixed with <code>instance_group_</code>.
Instances are required to be in the <code>automationcontroller</code> or
<code>execution_nodes</code> group alongside other <code>instance_group_</code> groups. In a
clustered setup, at least one instance <strong>must</strong> be present in the
<code>automationcontroller</code> group, which will appear as <code>controlplane</code> in the
API instance groups. See <code>ag_automationcontroller_group_policies</code> for
example scenarios.</p>
</li>
<li>
<p>A <code>default</code> API instance group is automatically created with all nodes
capable of running jobs. Technically, it is like any other instance
group but if a specific instance group is not associated with a specific
resource, then job execution will always fall back to the <code>default</code>
instance group. The <code>default</code> instance group always exists (it cannot be
deleted nor renamed).</p>
</li>
<li>
<p>Do not create a group named <code>instance_group_default</code>.</p>
</li>
<li>
<p>Do not name any instance the same as a group name.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ag_automationcontroller_group_policies"><a class="anchor" href="#ag_automationcontroller_group_policies"></a>7.1.1. <code>automationcontroller</code> group policies</h4>
<div class="paragraph">
<p>Use the following criteria when defining nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>nodes in the <code>automationcontroller</code> group can define <code>node_type</code>
hostvar to be <code>hybrid</code> (default) or <code>control</code></p>
</li>
<li>
<p>nodes in the <code>execution_nodes</code> group can define <code>node_type</code> hostvar to
be <code>execution</code> (default) or <code>hop</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can define custom groups in the inventory file by naming groups with
<code>instance_group_*</code> where <code>*</code> becomes the name of the group in the API.
Or, you can create custom instance groups in the API after the install
has finished.</p>
</div>
<div class="paragraph">
<p>The current behavior expects a member of an <code>instance_group_*</code> be part
of <code>automationcontroller</code> or <code>execution_nodes</code> group. Consider this
example scenario:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[automationcontroller]
126-addr.tatu.home ansible_host=192.168.111.126  node_type=control

[automationcontroller:vars]
peers=execution_nodes

[execution_nodes]

[instance_group_test]
110-addr.tatu.home ansible_host=192.168.111.110 receptor_listener_port=8928</pre>
</div>
</div>
<div class="paragraph">
<p>As a result of running the installer, you will get the error below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TASK [ansible.automation_platform_installer.check_config_static : Validate mesh topology] ***
fatal: [126-addr.tatu.home -&gt; localhost]: FAILED! =&gt; {"msg": "The host '110-addr.tatu.home' is not present in either [automationcontroller] or [execution_nodes]"}</pre>
</div>
</div>
<div class="paragraph">
<p>To fix this, you could move the box <code>110-addr.tatu.home</code> to an
<code>execution_node</code> group.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[automationcontroller]
126-addr.tatu.home ansible_host=192.168.111.126  node_type=control

[automationcontroller:vars]
peers=execution_nodes

[execution_nodes]
110-addr.tatu.home ansible_host=192.168.111.110 receptor_listener_port=8928

[instance_group_test]
110-addr.tatu.home</pre>
</div>
</div>
<div class="paragraph">
<p>This results in:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TASK [ansible.automation_platform_installer.check_config_static : Validate mesh topology] ***
ok: [126-addr.tatu.home -&gt; localhost] =&gt; {"changed": false, "mesh": {"110-addr.tatu.home": {"node_type": "execution", "peers": [], "receptor_control_filename": "receptor.sock", "receptor_control_service_name": "control", "receptor_listener": true, "receptor_listener_port": 8928, "receptor_listener_protocol": "tcp", "receptor_log_level": "info"}, "126-addr.tatu.home": {"node_type": "control", "peers": ["110-addr.tatu.home"], "receptor_control_filename": "receptor.sock", "receptor_control_service_name": "control", "receptor_listener": false, "receptor_listener_port": 27199, "receptor_listener_protocol": "tcp", "receptor_log_level": "info"}}}</pre>
</div>
</div>
<div class="paragraph">
<p>Upon upgrading from controller 4.0 or earlier, the legacy
<code>instance_group_</code> member will most likely have the awx code installed,
which would cause that node to be placed in the <code>automationcontroller</code>
group.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_instance_groups_from_the_api"><a class="anchor" href="#_configuring_instance_groups_from_the_api"></a>7.1.2. Configuring Instance Groups from the API</h4>
<div class="paragraph">
<p>Instance groups can be created by POSTing to <code>/api/v2/instance_groups</code>
as a system administrator.</p>
</div>
<div class="paragraph">
<p>Once created, instances can be associated with an instance group with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP POST /api/v2/instance_groups/x/instances/ {'id': y}`</pre>
</div>
</div>
<div class="paragraph">
<p>An instance that is added to an instance group will automatically
reconfigure itself to listen on the group&#8217;s work queue. See the
following section, <code>ag_instance_group_policies</code>, for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="ag_instance_group_policies"><a class="anchor" href="#ag_instance_group_policies"></a>7.1.3. Instance group policies</h4>
<div class="paragraph">
<p>You can configure controller instances to automatically join Instance
Groups when they come online by defining a <code>policy</code>. These policies are
evaluated for every new instance that comes online.</p>
</div>
<div class="paragraph">
<p>Instance Group Policies are controlled by three optional fields on an
<code>Instance Group</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>policy_instance_percentage</code>: This is a number between 0 - 100. It
guarantees that this percentage of active controller instances will be
added to this Instance Group. As new instances come online, if the
number of Instances in this group relative to the total number of
instances is less than the given percentage, then new ones will be added
until the percentage condition is satisfied.</p>
</li>
<li>
<p><code>policy_instance_minimum</code>: This policy attempts to keep at least this
many instances in the Instance Group. If the number of available
instances is lower than this minimum, then all instances will be placed
in this Instance Group.</p>
</li>
<li>
<p><code>policy_instance_list</code>: This is a fixed list of instance names to
always include in this Instance Group.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Instance Groups list view from the automation controller User
Interface provides a summary of the capacity levels for each instance
group according to instance group policies:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/instance-groups_list_view.png" alt="Instance Group policy example"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_notable_policy_considerations"><a class="anchor" href="#_notable_policy_considerations"></a>7.1.4. Notable policy considerations</h4>
<div class="ulist">
<ul>
<li>
<p><code>policy_instance_percentage</code> and <code>policy_instance_minimum</code> both set
minimum allocations. The rule that results in more instances assigned to
the group will take effect. For example, if you have a
<code>policy_instance_percentage</code> of 50% and a <code>policy_instance_minimum</code> of 2
and you start 6 instances, 3 of them would be assigned to the Instance
Group. If you reduce the number of total instances in the cluster to 2,
then both of them would be assigned to the Instance Group to satisfy
<code>policy_instance_minimum</code>. This way, you can set a lower bound on the
amount of available resources.</p>
</li>
<li>
<p>Policies do not actively prevent instances from being associated with
multiple Instance Groups, but this can effectively be achieved by making
the percentages add up to 100. If you have 4 instance groups, assign
each a percentage value of 25 and the instances will be distributed
among them with no overlap.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_manually_pinning_instances_to_specific_groups"><a class="anchor" href="#_manually_pinning_instances_to_specific_groups"></a>7.1.5. Manually pinning instances to specific groups</h4>
<div class="paragraph">
<p>If you have a special instance which needs to be exclusively assigned to
a specific Instance Group but don&#8217;t want it to automatically join other
groups via "percentage" or "minimum" policies:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the instance to one or more Instance Groups'
<code>policy_instance_list</code></p>
</li>
<li>
<p>Update the instance&#8217;s <code>managed_by_policy</code> property to be <code>False</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This will prevent the Instance from being automatically added to other
groups based on percentage and minimum policy; it will only belong to
the groups you&#8217;ve manually assigned it to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP PATCH /api/v2/instance_groups/N/
{
    "policy_instance_list": ["special-instance"]
}

HTTP PATCH /api/v2/instances/X/
{
    "managed_by_policy": False
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_job_runtime_behavior_2"><a class="anchor" href="#_job_runtime_behavior_2"></a>7.1.6. Job Runtime Behavior</h4>
<div class="paragraph">
<p>When you run a job associated with a instance group, some behaviors
worth noting are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a cluster is divided into separate instance groups, then the
behavior is similar to the cluster as a whole. If two instances are
assigned to a group then either one is just as likely to receive a job
as any other in the same group.</p>
</li>
<li>
<p>As controller instances are brought online, it effectively expands the
work capacity of the system. If those instances are also placed into
instance groups, then they also expand that group&#8217;s capacity. If an
instance is performing work and it is a member of multiple groups, then
capacity will be reduced from all groups for which it is a member.
De-provisioning an instance will remove capacity from the cluster
wherever that instance was assigned. See the <code>ag_cluster_deprovision</code>
section for more detail.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Not all instances are required to be provisioned with an equal capacity.</p>
</div>
</div>
<div class="sect3">
<h4 id="_control_where_a_job_runs"><a class="anchor" href="#_control_where_a_job_runs"></a>7.1.7. Control Where a Job Runs</h4>
<div class="paragraph">
<p>If any of the job template, inventory, or organization has instance
groups associated with them, a job ran from that job template will not
be eligible for the default behavior. That means that if all of the
instances inside of the instance groups associated with these 3
resources are out of capacity, the job will remain in the pending state
until capacity becomes available.</p>
</div>
<div class="paragraph">
<p>The order of preference in determining which instance group to submit
the job to is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>job template</p>
</li>
<li>
<p>inventory</p>
</li>
<li>
<p>organization (by way of project)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If instance groups are associated with the job template, and all of
these are at capacity, then the job will be submitted to instance groups
specified on inventory, and then organization. Jobs should execute in
those groups in preferential order as resources are available.</p>
</div>
<div class="paragraph">
<p>The global <code>default</code> group can still be associated with a resource, just
like any of the custom instance groups defined in the playbook. This can
be used to specify a preferred instance group on the job template or
inventory, but still allow the job to be submitted to any instance if
those are out of capacity.</p>
</div>
<div class="paragraph">
<p>As an example, by associating <code>group_a</code> with a Job Template and also
associating the <code>default</code> group with its inventory, you allow the
<code>default</code> group to be used as a fallback in case <code>group_a</code> gets out of
capacity.</p>
</div>
<div class="paragraph">
<p>In addition, it is possible to not associate an instance group with one
resource but designate another resource as the fallback. For example,
not associating an instance group with a job template and have it fall
back to the inventory and/or the organization&#8217;s instance group.</p>
</div>
<div class="paragraph">
<p>This presents two other great use cases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Associating instance groups with an inventory (omitting assigning the
job template to an instance group) will allow the user to ensure that
any playbook run against a specific inventory will run only on the group
associated with it. This can be super useful in the situation where only
those instances have a direct link to the managed nodes.</p>
</li>
<li>
<p>An administrator can assign instance groups to organizations. This
effectively allows the administrator to segment out the entire
infrastructure and guarantee that each organization has capacity to run
jobs without interfering with any other organization&#8217;s ability to run
jobs.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Likewise, an administrator could assign multiple groups to each
organization as desired, as in the following scenario:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p>There are three instance groups: A, B, and C. There are two
organizations: Org1 and Org2.</p>
</li>
<li>
<p>The administrator assigns group A to Org1, group B to Org2 and then
assign group C to both Org1 and Org2 as an overflow for any extra
capacity that may be needed.</p>
</li>
<li>
<p>The organization administrators are then free to assign inventory or
job templates to whichever group they want (or just let them inherit the
default order from the organization).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/instance-groups-scenarios.png" alt="Instance Group example"></span></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Arranging resources in this way offers a lot of flexibility. Also, you
can create instance groups with only one instance, thus allowing you to
direct work towards a very specific Host in the controller cluster.</p>
</div>
</div>
<div class="sect3">
<h4 id="ag_instancegrp_deprovision"><a class="anchor" href="#ag_instancegrp_deprovision"></a>7.1.8. Deprovision Instance Groups</h4>
<div class="paragraph">
<p>Re-running the setup playbook does not automatically deprovision
instances since clusters do not currently distinguish between an
instance that was taken offline intentionally or due to failure.
Instead, shut down all services on the controller instance and then run
the deprovisioning tool from any other instance:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Shut down the instance or stop the service with the command,
<code>automation-controller-service stop</code>.</p>
</li>
<li>
<p>Run the deprovision command
<code>$ awx-manage deprovision_instance --hostname=&lt;name used in inventory file&gt;</code>
from another instance to remove it from the controller cluster registry.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Example: <code>awx-manage deprovision_instance --hostname=hostB</code></p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Similarly, deprovisioning instance groups in the controller does not
automatically deprovision or remove instance groups, even though
re-provisioning will often cause these to be unused. They may still show
up in API endpoints and stats monitoring. These groups can be removed
with the following command:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Example: <code>awx-manage unregister_queue --queuename=&lt;name&gt;</code></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Removing an instance&#8217;s membership from an instance group in the
inventory file and re-running the setup playbook does not ensure the
instance won&#8217;t be added back to a group. To be sure that an instance
will not be added back to a group, remove via the API and also remove it
in your inventory file, or you can stop defining instance groups in the
inventory file altogether. You can also manage instance group topology
through the automation controller User Interface. For more information
on managing instance groups in the UI, refer to
<code>Instance Groups &lt;userguide:ug_instance_groups&gt;</code> in the Automation
Controller User Guide.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>If you have isolated instance groups created in older versions of the
controller (3.8.x and earlier) and want to migrate them to execution
nodes to make them compatible for use with the automation mesh
architecture, see <code>migrate_iso_to_exe</code> in the Ansible Automation
Platform Upgrade and Migration Guide.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ag_container_groups"><a class="anchor" href="#ag_container_groups"></a>7.2. Container Groups</h3>
<div class="paragraph">
<p>Ansible Automation Platform supports <code>Container Groups</code>, which allow you
to execute jobs in the controller regardless of whether the controller
is installed as a standalone, in a virtual environment, or in a
container. Container groups act as a pool of resources within a virtual
environment. You can create instance groups to point to an OpenShift
container, which are job environments that are provisioned on-demand as
a Pod that exists only for the duration of the playbook run. This is
known as the ephemeral execution model and ensures a clean environment
for every job run.</p>
</div>
<div class="paragraph">
<p>In some cases, it is desirable to have container groups be "always-on",
which is configured through the creation of an instance.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Container Groups upgraded from versions prior to automation controller
4.0 will revert back to default and completely remove the old pod
definition, clearing out all custom pod definitions in the migration.</p>
</div>
<div class="paragraph">
<p>Container groups are different from execution environments in that
execution environments are container images and do not use a virtual
environment. See <code>ug_execution_environments</code> in the Automation
Controller User Guide for further detail.</p>
</div>
<div class="sect3">
<h4 id="_create_a_container_group"><a class="anchor" href="#_create_a_container_group"></a>7.2.1. Create a container group</h4>
<div class="paragraph">
<p>Unresolved directive in administration/containers_instance_groups.adoc - include::get-creds-from-service-account.adoc[]</p>
</div>
<div class="paragraph">
<p>To create a container group:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the controller user interface to create an
<code>ug_credentials_ocp_k8s</code> credential that will be used with your
container group, see <code>ug_credentials_add</code> in the Automation Controller
User Guide for detail.</p>
</li>
<li>
<p>Create a new container group by navigating to the Instance Groups
configuration window by clicking <strong>Instance Groups</strong> from the left
navigation bar.</p>
</li>
<li>
<p>Click the <strong>Add</strong> button and select <strong>Create Container Group</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/instance-group-create-new-cg.png" alt="IG - create new CG"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Enter a name for your new container group and select the credential
previously created to associate it to the container group.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ag_customize_pod_spec"><a class="anchor" href="#ag_customize_pod_spec"></a>7.2.2. Customize the Pod spec</h4>
<div class="paragraph">
<p>Ansible Automation Platform provides a simple default Pod specification,
however, you can provide a custom YAML (or JSON) document that overrides
the default Pod spec. This field uses any custom fields (i.e.
<code>ImagePullSecrets</code>) that can be "serialized" as valid Pod JSON or YAML.
A full list of options can be found in the
<a href="https://docs.openshift.com/online/pro/architecture/core_concepts/pods_and_services.html">OpenShift
documentation</a>.</p>
</div>
<div class="paragraph">
<p>To customize the Pod spec, specify the namespace in the <strong>Pod Spec
Override</strong> field by using the toggle to enable and expand the <strong>Pod Spec
Override</strong> field and click <strong>Save</strong> when done.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/instance-group-customize-cg-pod.png" alt="IG - CG customize pod"></span></p>
</div>
<div class="paragraph">
<p>You may provide additional customizations, if needed. Click <strong>Expand</strong> to
view the entire customization window.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/instance-group-customize-cg-pod-expanded.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The image used at job launch time is determined by which execution
environment is associated with the job. If a Container Registry
credential is associated with the execution environment, then the
controller will attempt to make a <code>ImagePullSecret</code> to pull the image.
If you prefer not to give the service account permission to manage
secrets, you must pre-create the <code>ImagePullSecret</code> and specify it on the
pod spec, and omit any credential from the execution environment used.</p>
</div>
<div class="paragraph">
<p>Refer to the <em>Allowing Pods to Reference Images from Other Secured
Registries</em> section of the
<a href="https://access.redhat.com/RegistryAuthentication">Red Hat Container
Registry Authentication article</a> for more information on how to create
image pull secrets.</p>
</div>
<div class="paragraph">
<p>Once the container group is successfully created, the <strong>Details</strong> tab of
the newly created container group remains, which allows you to review
and edit your container group information. This is the same menu that is
opened if the Edit
(<span class="image"><img src="images/edit-button.png" alt="edit-button"></span>) button
is clicked from the <strong>Instance Group</strong> link. You can also edit <strong>Instances</strong>
and review <strong>Jobs</strong> associated with this instance group.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/instance-group-example-cg-successfully-created.png" alt="IG - example CG successfully created"></span></p>
</div>
<div class="paragraph">
<p>Container groups and instance groups are labeled accordingly.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Despite the fact that customers have custom Pod specs, upgrades may be
difficult if the default <code>pod_spec</code> changes. Most any manifest can be
applied to any namespace, with the namespace specified separately, most
likely you will only need to override the namespace. Similarly, pinning
a default image for different releases of the platform to different
versions of the default job runner container is tricky. If the default
image is specified in the Pod spec, then upgrades do not pick up the new
default changes are made to the default Pod spec.</p>
</div>
</div>
<div class="sect3">
<h4 id="_verify_container_group_functions"><a class="anchor" href="#_verify_container_group_functions"></a>7.2.3. Verify container group functions</h4>
<div class="paragraph">
<p>To verify the deployment and termination of your container:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a mock inventory and associate the container group to it by
populating the name of the container group in the <strong>Instance Group</strong>
field. See <code>ug_inventories_add</code> in the Automation Controller User Guide
for detail.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/inventories-create-new-cg-test-inventory.png" alt="Dummy inventory"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create "localhost" host in inventory with variables:</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>{'ansible_host': '127.0.0.1', 'ansible_connection': 'local'}</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/inventories-create-new-cg-test-localhost.png" alt="Inventory with localhost"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Launch an ad hoc job against the localhost using the <em>ping</em> or <em>setup</em>
module. Even though the <strong>Machine Credential</strong> field is required, it does
not matter which one is selected for this simple test.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/inventories-launch-adhoc-cg-test-localhost.png" alt="Launch inventory with localhost"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/inventories-launch-adhoc-cg-test-localhost2.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>You can see in the jobs detail view the container was reached
successfully using one of ad hoc jobs.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/inventories-launch-adhoc-cg-test-localhost-success.png" alt="Inventory with localhost ping success"></span></p>
</div>
<div class="paragraph">
<p>If you have an OpenShift UI, you can see Pods appear and disappear as
they deploy and terminate. Alternatively, you can use the CLI to perform
a <code>get pod</code> operation on your namespace to watch these same events
occurring in real-time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_view_container_group_jobs"><a class="anchor" href="#_view_container_group_jobs"></a>7.2.4. View container group jobs</h4>
<div class="paragraph">
<p>When you run a job associated with a container group, you can see the
details of that job in the <strong>Details</strong> view and its associated container
group and the execution environment that spun up.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/instance-group-job-details-with-cgs.png" alt="IG - instances jobs"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_kubernetes_api_failure_conditions"><a class="anchor" href="#_kubernetes_api_failure_conditions"></a>7.2.5. Kubernetes API failure conditions</h4>
<div class="paragraph">
<p>When running a container group and the Kubernetes API responds that the
resource quota has been exceeded, the controller keeps the job in
pending state. Other failures result in the traceback of the <strong>Error
Details</strong> field showing the failure reason, similar to the example here:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/instance-group-cg-job-details-error.png" alt="image"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="ag_container_capacity"><a class="anchor" href="#ag_container_capacity"></a>7.2.6. Container capacity limits</h4>
<div class="paragraph">
<p>Capacity limits and quotas for containers are defined via objects in the
Kubernetes API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To set limits on all pods within a given namespace, use the
<code>LimitRange</code> object. Refer to the OpenShift documentation for
<a href="https://docs.openshift.com/online/pro/dev_guide/compute_resources.html#overview">Quotas
and Limit Ranges</a>.</p>
</li>
<li>
<p>To set limits directly on the pod definition launched by the
controller, see <a href="#customize-the-pod-spec">Customize the Pod spec</a> and
refer to the OpenShift documentation to set the options to
<a href="https://docs.openshift.com/online/pro/dev_guide/compute_resources.html#dev-compute-resources">compute
resources</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Container groups do not use the capacity algorithm that normal nodes
use. You would need to explicitly set the number of forks at the job
template level, for instance. If forks are configured in the controller,
that setting will be passed along to the container.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_topology_viewer"><a class="anchor" href="#ag_topology_viewer"></a>8. Topology Viewer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The topology viewer is in tech preview and is subject to change in a
future release.</p>
</div>
<div class="paragraph">
<p>The topology viewer allows you to view node type, node health, and
specific details about each node if you already have a mesh topology
deployed. To learn more about automation mesh, refer to the
<a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.1/html/red_hat_ansible_automation_platform_automation_mesh_guide/assembly-planning-mesh">Red
Hat Ansible Automation Mesh Guide</a> on
<a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform">access.redhat.com</a>.</p>
</div>
<div class="paragraph">
<p>To access the topology viewer from the controller user interface:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration menu from left navigation bar, click <strong>Topology
View</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Topology View opens and displays a graphic representation of how
each receptor node links together.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/topology-viewer-initial-view.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>To adjust the zoom levels, or manipulate the graphic views, use the
control buttons on the upper right-hand corner of the window.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/topology-viewer-view-controls.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>You can also click and drag to pan around; and use the scroll wheel on
your mouse or trackpad to zoom. The fit-to-screen feature automatically
scales the graphic to fit on the screen and repositions it in the
center. It is particularly useful when you want to see a large mesh in
its entirety.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/topology-viewer-zoomed-view.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>To reset the view to its default view, click <strong>Reset zoom</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Refer to the Legend to the left of the graphic to identify the type of
nodes that are represented. See
<a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.1/html/red_hat_ansible_automation_platform_automation_mesh_guide/assembly-planning-mesh#con-automation-mesh-node-types">Control
and execution planes</a> for more information on each type of node.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>If the Legend is not present, use the toggle on the upper right part of
the window to enable it.</p>
</div>
<div class="paragraph">
<p>Also in the Legend, you can see how the color corresponds to its status,
which is indicative of the health of the node. Node health is currently
being statically rendered at certain points in time dictated by the API,
and therefore, live polling of the node status is not available at this
time. The status updates provided by the API is also not configurable.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Hover over a node and the connectors highlight to show its immediate
connected nodes or click on the node to retrieve details about it, such
as its hostname, node type, and status.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/topology-viewer-node-view.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Click on the link for instance hostname from the details displayed, and
you will be redirected to its Details page to provide more information
about that node, most notably the reason for an <code>Error</code> status.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/topology-viewer-instance-details.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>At the bottom of the Details view, you can run a health check on the
instance on an as-needed basis, or unassign jobs from the instance. By
default, jobs can be assigned to each node. However, you can disable it
to exclude the node from having any jobs running on it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_controller_logfiles"><a class="anchor" href="#_controller_logfiles"></a>9. Controller Logfiles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The controller logfiles have been consolidated and can be easily
accessed from two centralized locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/var/log/tower/</code></p>
</li>
<li>
<p><code>/var/log/supervisor/</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the <code>/var/log/tower/</code> directory, you can view logfiles related to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>callback_receiver.log:</strong> captures callback receiver logs that handles
callback events when running ansible jobs.</p>
</li>
<li>
<p><strong>dispatcher.log:</strong> captures log messages for the controller dispatcher
worker service.</p>
</li>
<li>
<p><strong>job_lifecycle.log:</strong> captures details of the job run, whether it is
blocked, and what condition is blocking it.</p>
</li>
<li>
<p><strong>management_playbooks.log:</strong> captures the logs of management playbook
runs, the isolated job runs like copying the metadata, etc.</p>
</li>
<li>
<p><strong>rsyslog.err:</strong> captures rsyslog errors authenticating with external
logging services when sending logs to them.</p>
</li>
<li>
<p><strong>task_system.log:</strong> - captures the logs of tasks that the controller is
running in the background, such as adding cluster instances and logs
related to information gathering/processing for analytics, etc.</p>
</li>
<li>
<p><strong>tower.log:</strong> captures the log messages such as runtime errors that
occur when the job is executed.</p>
</li>
<li>
<p><strong>tower_rbac_migrations.log:</strong> captures the logs for rbac database
migration or upgrade.</p>
</li>
<li>
<p><strong>tower_system_tracking_migrations.log:</strong> captures the logs the
controller system tracking migration or upgrade.</p>
</li>
<li>
<p><strong>wsbroadcast.log:</strong> captures the logs of websocket connections in the
controller nodes.</p>
</li>
<li>
<p><strong>isolated_manager.log:</strong> captures logs associated with isolated nodes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the <code>/var/log/supervisor/</code> directory, you can view logfiles related
to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>awx-callback-receiver.log:</strong> captures the log of callback receiver
that handles callback events when running ansible jobs, managed by
supervisord.</p>
</li>
<li>
<p><strong>awx-daphne.log:</strong> captures the logs of Websocket communication of
WebUI.</p>
</li>
<li>
<p><strong>awx-dispatcher.log:</strong> captures the logs that occur when dispatching a
task to a controller instance, such as when running a job.</p>
</li>
<li>
<p><strong>awx-rsyslog.log:</strong> captures the logs for rsyslog service.</p>
</li>
<li>
<p><strong>awx-uwsgi.log:</strong> captures the logs related to uWSGI, which is an
application server.</p>
</li>
<li>
<p><strong>awx-wsbroadcast.log:</strong> captures the logs of websocket service that is
used by the controller.</p>
</li>
<li>
<p><strong>failure-event-handler.stderr.log:</strong> captures the standard errors for
/usr/bin/failure-event-handler supervisord&#8217;s subprocess.</p>
</li>
<li>
<p><strong>supervisord.log:</strong> captures the logs related to supervisord itself.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>/var/log/supervisor/</code> directory includes <code>stdout</code> files for all
services as well.</p>
</div>
<div class="paragraph">
<p>You can expect the following log paths to be generated by services used
by Tower (and the Ansible Automation Platform):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>/var/log/nginx/</strong></p>
</li>
<li>
<p><strong>/var/opt/rh/rh-postgresql10/</strong></p>
</li>
<li>
<p><strong>/var/opt/rh/rh-redis5/log/redis/</strong></p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>"Mooving around: Consolidated logfiles for easier access!"
    \
     \   ^__^
      \  (oo)\_______
         (__)\       )\/\
             ||----w |
             ||     ||</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_logging"><a class="anchor" href="#ag_logging"></a>10. Logging and Aggregation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Logging is a feature that provides the capability to send detailed logs
to several kinds of 3rd party external log aggregation services.
Services connected to this data feed serve as a useful means in gaining
insight into the controller usage or technical trends. The data can be
used to analyze events in the infrastructure, monitor for anomalies, and
correlate events from one service with events in another. The types of
data that are most useful to the controller are job fact data, job
events/job runs, activity stream data, and log messages. The data is
sent in JSON format over a HTTP connection using minimal
service-specific tweaks engineered in a custom handler or via an
imported library.</p>
</div>
<div class="paragraph">
<p>Installing automation controller will install a newer version of
rsyslog, which will replace the version that comes with the RHEL base.
The version of rsyslog that is installed by automation controller does
not include the following rsyslog modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rsyslog-udpspoof.x86_64</p>
</li>
<li>
<p>rsyslog-libdbi.x86_64</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After installing automation controller, use only the controller provided
rsyslog package for any logging outside of the controller that may have
previously been done with the RHEL provided rsyslog package. If you
already use rsyslog for logging system logs on the controller instances,
you can continue to use rsyslog to handle logs from outside of the
controller by running a separate rsyslog process (using the same version
of rsyslog that the controller is), and pointing it to a separate
/etc/rsyslog.conf.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>For systems that use rsyslog outside of the controller (on the
controller VM/machine), consider any conflict that may arise with also
using new version of rsyslog that comes with the controller.</p>
</div>
<div class="paragraph">
<p>You can configure from the <code>/api/v2/settings/logging/</code> endpoint how the
controller rsyslog process handles messages that have not yet been sent
in the event that your external logger goes offline:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LOG_AGGREGATOR_MAX_DISK_USAGE_GB</code>: specifies the amount of data to
store (in gigabytes) during an outage of the external log aggregator
(defaults to 1). Equivalent to the <code>rsyslogd queue.maxdiskspace</code>
setting.</p>
</li>
<li>
<p><code>LOG_AGGREGATOR_MAX_DISK_USAGE_PATH</code>: specifies the location to
persist logs that should be retried after an outage of the external log
aggregator (defaults to <code>/var/lib/awx</code>). Equivalent to the
<code>rsyslogd queue.spoolDirectory</code> setting.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if Splunk goes offline, rsyslogd stores a queue on the disk
until Splunk comes back online. By default, it will store up to 1GB of
events (while Splunk is offline) but you can make that more than 1GB if
necessary, or change the path where you save the queue.</p>
</div>
<div class="sect2">
<h3 id="_loggers"><a class="anchor" href="#_loggers"></a>10.1. Loggers</h3>
<div class="paragraph">
<p>Below are special loggers (except for <code>awx</code>, which constitutes generic
server logs) that provide large amount of information in a predictable
structured or semi-structured format, following the same structure as
one would expect if obtaining the data from the API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>job_events</code>: Provides data returned from the Ansible callback module</p>
</li>
<li>
<p><code>activity_stream</code>: Displays the record of changes to the objects
within the automation controller application</p>
</li>
<li>
<p><code>system_tracking</code>: Provides fact data gathered by Ansible <code>setup</code>
module (i.e. <code>gather_facts: True</code>) when job templates are ran with
<strong>Enable Fact Cache</strong> selected</p>
</li>
<li>
<p><code>awx</code>: Provides generic server logs, which include logs that would
normally be written to a file. It contains the standard metadata that
all logs have, except it only has the message from the log statement.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These loggers only use log-level of INFO, except for the <code>awx</code> logger,
which may be any given level.</p>
</div>
<div class="paragraph">
<p>Additionally, the standard controller logs are be deliverable through
this same mechanism. It is apparent how to enable or disable each of
these five sources of data without manipulating a complex dictionary in
your local settings file, as well as adjust the log-level consumed from
the standard controller logs.</p>
</div>
<div class="paragraph">
<p>To configure various logging components in automation controller, click
<strong>Settings</strong> from the left navigation bar then select <strong>Logging settings</strong>
from the list of System options.</p>
</div>
<div class="sect3">
<h4 id="_log_message_schema"><a class="anchor" href="#_log_message_schema"></a>10.1.1. Log message schema</h4>
<div class="paragraph">
<p>Common schema for all loggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cluster_host_id</code>: Unique identifier of the host within the controller
cluster</p>
</li>
<li>
<p><code>level</code>: Standard python log level, roughly reflecting the
significance of the event All of the data loggers as a part of this
feature use INFO level, but the other controller logs will use different
levels as appropriate</p>
</li>
<li>
<p><code>logger_name</code>: Name of the logger we use in the settings, for example,
"activity_stream"</p>
</li>
<li>
<p><code>@timestamp</code>: Time of log</p>
</li>
<li>
<p><code>path</code>: File path in code where the log was generated</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_activity_stream_schema"><a class="anchor" href="#_activity_stream_schema"></a>10.1.2. Activity stream schema</h4>
<div class="ulist">
<ul>
<li>
<p>(common): This uses all the fields common to all loggers listed above</p>
</li>
<li>
<p><code>actor</code>: Username of the user who took the action documented in the
log</p>
</li>
<li>
<p><code>changes</code>: JSON summary of what fields changed, and their old/new
values.</p>
</li>
<li>
<p><code>operation</code>: The basic category of the changed logged in the activity
stream, for instance, "associate".</p>
</li>
<li>
<p><code>object1</code>: Information about the primary object being operated on,
consistent with what we show in the activity stream</p>
</li>
<li>
<p><code>object2</code>: If applicable, the second object involved in the action</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_job_event_schema"><a class="anchor" href="#_job_event_schema"></a>10.1.3. Job event schema</h4>
<div class="paragraph">
<p>This logger reflects the data being saved into job events, except when
they would otherwise conflict with expected standard fields from the
logger, in which case the fields are nested. Notably, the field host on
the <code>job_event</code> model is given as <code>event_host</code>. There is also a
sub-dictionary field, <code>event_data</code> within the payload, which contains
different fields depending on the specifics of the Ansible event.</p>
</div>
<div class="paragraph">
<p>This logger also includes the common fields.</p>
</div>
</div>
<div class="sect3">
<h4 id="_scan_fact_system_tracking_data_schema"><a class="anchor" href="#_scan_fact_system_tracking_data_schema"></a>10.1.4. Scan / fact / system tracking data schema</h4>
<div class="paragraph">
<p>These contain a detailed dictionary-type fields that are either
services, packages, or files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(common): This uses all the fields common to all loggers listed above</p>
</li>
<li>
<p><code>services</code>: For services scans, this field is included and has keys
based on the name of the service. <strong>NOTE</strong>: Periods are disallowed by
elastic search in names, and are replaced with "_" by our log formatter</p>
</li>
<li>
<p><code>package</code>: Included for log messages from package scans</p>
</li>
<li>
<p><code>files</code>: Included for log messages from file scans</p>
</li>
<li>
<p><code>host</code>: Name of host scan applies to</p>
</li>
<li>
<p><code>inventory_id</code>: Inventory id host is inside of</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_job_status_changes"><a class="anchor" href="#_job_status_changes"></a>10.1.5. Job status changes</h4>
<div class="paragraph">
<p>This is a intended to be a lower-volume source of information about
changes in job states compared to job events, and also intended to
capture changes to types of unified jobs other than job template based
jobs.</p>
</div>
<div class="paragraph">
<p>In addition to common fields, these logs include fields present on the
job model.</p>
</div>
</div>
<div class="sect3">
<h4 id="_controller_logs"><a class="anchor" href="#_controller_logs"></a>10.1.6. Controller logs</h4>
<div class="paragraph">
<p>In addition to the common fields, this contains a <code>msg</code> field with the
log message. Errors contain a separate <code>traceback</code> field. These logs can
be enabled or disabled with the <code>ENABLE EXTERNAL LOGGING</code> option from
the Logging settings page.</p>
</div>
</div>
<div class="sect3">
<h4 id="_logging_aggregator_services"><a class="anchor" href="#_logging_aggregator_services"></a>10.1.7. Logging Aggregator Services</h4>
<div class="paragraph">
<p>The logging aggregator service works with the following monitoring and
data analysis systems:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">local</dt>
<dd>
<p>===== Splunk</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Automation controller&#8217;s Splunk logging integration uses the Splunk HTTP
Collector. When configuring a SPLUNK logging aggregator, add the full
URL to the HTTP Event Collector host, like in the following example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>https://yourcontrollerfqdn.com/api/v2/settings/logging

{
    "LOG_AGGREGATOR_HOST": "https://yoursplunk:8088/services/collector/event",
    "LOG_AGGREGATOR_PORT": null,
    "LOG_AGGREGATOR_TYPE": "splunk",
    "LOG_AGGREGATOR_USERNAME": "",
    "LOG_AGGREGATOR_PASSWORD": "$encrypted$",
    "LOG_AGGREGATOR_LOGGERS": [
        "awx",
        "activity_stream",
        "job_events",
        "system_tracking"
    ],
    "LOG_AGGREGATOR_INDIVIDUAL_FACTS": false,
    "LOG_AGGREGATOR_ENABLED": true,
    "LOG_AGGREGATOR_CONTROLLER_UUID": ""
}</pre>
</div>
</div>
<div class="paragraph">
<p>Splunk HTTP Event Collector listens on 8088 by default so it is
necessary to provide the full HEC event URL (with port) in order for
incoming requests to be processed successfully. These values are entered
in the example below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/logging-splunk-tower-example.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>For further instructions on configuring the HTTP Event Collector, refer
to the <a href="">Splunk documentation</a>.</p>
</div>
<div class="sect4">
<h5 id="_loggly"><a class="anchor" href="#_loggly"></a>Loggly</h5>
<div class="paragraph">
<p>To set up the sending of logs through Loggly&#8217;s HTTP endpoint, refer to
<a href="https://www.loggly.com/docs/http-endpoint/" class="bare">https://www.loggly.com/docs/http-endpoint/</a>. Loggly uses the URL
convention described at
<a href="http://logs-01.loggly.com/inputs/TOKEN/tag/http/" class="bare">http://logs-01.loggly.com/inputs/TOKEN/tag/http/</a>, which is shown
inputted in the <strong>Logging Aggregator</strong> field in the example below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/logging-loggly-tower-example.png" alt="image"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_sumologic"><a class="anchor" href="#_sumologic"></a>Sumologic</h5>
<div class="paragraph">
<p>In Sumologic, create a search criteria containing the json files that
provide the parameters used to collect the data you need.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/logging_sumologic_main.png" alt="image"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_elastic_stack_formerly_elk_stack"><a class="anchor" href="#_elastic_stack_formerly_elk_stack"></a>Elastic stack (formerly ELK stack)</h5>
<div class="paragraph">
<p>If starting from scratch, standing up your own version the elastic
stack, the only change you required is to add the following lines to the
logstash <code>logstash.conf</code> file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>filter {
  json {
    source =&gt; "message"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Backward-incompatible changes were introduced with Elastic 5.0.0, and
different configurations may be required depending on what versions you
are using.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ag_ctit_logging"><a class="anchor" href="#ag_ctit_logging"></a>10.2. Set Up Logging</h3>
<div class="sect3">
<h4 id="_log_aggregation"><a class="anchor" href="#_log_aggregation"></a>10.2.1. Log Aggregation</h4>
<div class="paragraph">
<p>To set up logging to any of the aggregator types:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>Under the list of System options, click to select <strong>Logging settings</strong>.</p>
</li>
<li>
<p>At the bottom of the Logging settings screen, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Set the configurable options from the fields provided:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Enable External Logging</strong>: Click the toggle button to <strong>ON</strong> if you want
to send logs to an external log aggregator.</p>
</li>
<li>
<p><strong>Logging Aggregator</strong>: Enter the hostname or IP address you want to
send logs.</p>
</li>
<li>
<p><strong>Logging Aggregator Port</strong>: Specify the port for the aggregator if it
requires one.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>When the connection type is HTTPS, you can enter the hostname as a URL
with a port number and therefore, you are not required to enter the port
again. But TCP and UDP connections are determined by the hostname and
port number combination, rather than URL. So in the case of TCP/UDP
connection, supply the port in the specified field. If instead a URL is
entered in host field (<strong>Logging Aggregator</strong> field), its hostname portion
will be extracted as the actual hostname.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Logging Aggregator Type</strong>: Click to select the aggregator service from
the drop-down menu:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-system-logging-types.png" alt="image"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Logging Aggregator Username</strong>: Enter the username of the logging
aggregator if it requires it.</p>
</li>
<li>
<p><strong>Logging Aggregator Password/Token</strong>: Enter the password of the logging
aggregator if it requires it.</p>
</li>
<li>
<p><strong>Log System Tracking Facts Individually</strong>: Click the tooltip
<span class="image"><img src="images/tooltips-icon.png" alt="help"></span> icon for
additional information whether or not you want to turn it on, or leave
it off by default.</p>
</li>
<li>
<p><strong>Logging Aggregator Protocol</strong>: Click to select a connection type
(protocol) to communicate with the log aggregator. Subsequent options
vary depending on the selected protocol.</p>
</li>
<li>
<p><strong>Logging Aggregator Level Threshold</strong>: Select the level of severity you
want the log handler to report.</p>
</li>
<li>
<p><strong>TCP Connection Timeout</strong>: Specify the connection timeout in seconds.
This option is only applicable to HTTPS and TCP log aggregator
protocols.</p>
</li>
<li>
<p><strong>Enable/disable HTTPS certificate verification</strong>: Certificate
verification is enabled by default for HTTPS log protocol. Click the
toggle button to <strong>OFF</strong> if you do not want the log handler to verify the
HTTPS certificate sent by the external log aggregator before
establishing a connection.</p>
</li>
<li>
<p><strong>Loggers to Send Data to the Log Aggregator Form</strong>: All four types of
data are pre-populated by default. Click the tooltip
<span class="image"><img src="images/tooltips-icon.png" alt="help"></span> icon next to
the field for additional information on each data type. Delete the data
types you do not want.</p>
</li>
<li>
<p><strong>Log Format For API 4XX Errors</strong>: Configure a specific error message.
See <code>logging-api-400-error-config</code> for further detail.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Review your entries for your chosen logging aggregation. Below is an
example of one set up for Splunk:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-system-logging-splunk-example.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>When done, click <strong>Save</strong> to apply the settings or <strong>Cancel</strong> to abandon
the changes.</p>
</li>
<li>
<p>To verify if your configuration is set up correctly, click <strong>Save</strong>
first then click <strong>Test</strong>. This sends a test log message to the log
aggregator using the current logging configuration in automation
controller. You should check to make sure this test message was received
by your external log aggregator.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>If the <strong>Test</strong> button is disabled, it is an indication that the fields
are different than their initial values so save your changes first, and
make sure the <strong>Enable External Logging</strong> toggle is set to ON.</p>
</div>
</div>
<div class="sect3">
<h4 id="logging-api-400-error-config"><a class="anchor" href="#logging-api-400-error-config"></a>10.2.2. API 4XX Error Configuration</h4>
<div class="paragraph">
<p>When the API encounters an issue with a request, it will typically
return an HTTP error code in the 400 range along with an error. When
this happens, an error message will be generated in the log which
follows the pattern:</p>
</div>
<div class="paragraph">
<p><code>\</code> status {status_code} received by user {user_name} attempting to access {url_path} from {remote_addr}``</p>
</div>
<div class="paragraph">
<p>These messages can be configured as required. To modify the default API
4XX errors log message format, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>Under the list of System options, click to select <strong>Logging settings</strong>.</p>
</li>
<li>
<p>At the bottom of the Logging settings screen, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Modify the field <strong>Log Format For API 4XX Errors</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Items surrounded by <code>{}</code> will be substituted when the log error is
generated. The following variables can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>status_code</strong>: The HTTP status code the API is returning</p>
</li>
<li>
<p><strong>user_name</strong>: The name of the user that was authenticated when making
the API request</p>
</li>
<li>
<p><strong>url_path</strong>: The path portion of the URL being called (aka the API
endpoint)</p>
</li>
<li>
<p><strong>remote_addr</strong>: The remote address received by Controller</p>
</li>
<li>
<p><strong>error</strong>: The error message returned by the API or, if no error is
specified, the HTTP status as text</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshoot_logging"><a class="anchor" href="#_troubleshoot_logging"></a>10.3. Troubleshoot Logging</h3>
<div class="sect3">
<h4 id="_logging_aggregation"><a class="anchor" href="#_logging_aggregation"></a>10.3.1. Logging Aggregation</h4>
<div class="paragraph">
<p>If you have sent a message with the test button to your configured
logging service via http/https, but did not receive the message, check
the <code>/var/log/tower/rsyslog.err</code> log file. This is where errors are
stored if they occurred when authenticating rsyslog with an http/https
external logging service. Note that if there are no errors, this file
will not exist.</p>
</div>
</div>
<div class="sect3">
<h4 id="_api_4xx_errors"><a class="anchor" href="#_api_4xx_errors"></a>10.3.2. API 4XX Errors</h4>
<div class="paragraph">
<p>You can include the API error message for 4XX errors by modifying the
log format for those messages. Refer to the
<code>logging-api-400-error-config</code> section for more detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ldap"><a class="anchor" href="#_ldap"></a>10.3.3. LDAP</h4>
<div class="paragraph">
<p>You can enable logging messages for the LDAP adapter. Refer to the
<code>ldap_logging</code> section for more detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="_saml"><a class="anchor" href="#_saml"></a>10.3.4. SAML</h4>
<div class="paragraph">
<p>You can enable logging messages for the SAML adapter the same way you
can enable logging for LDAP. Refer to the <code>ldap_logging</code> section for
more detail.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_metrics"><a class="anchor" href="#ag_metrics"></a>11. Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A metrics endpoint is available in the API: <code>/api/v2/metrics/</code> that
surfaces instantaneous metrics about the controller, which can be
consumed by system monitoring software like the open source project
Prometheus.</p>
</div>
<div class="paragraph">
<p>The type of data shown at the <code>metrics/</code> endpoint is
<code>Content-type: text/plain</code> and <code>application/json</code> as well. This endpoint
contains useful information, such as counts of how many active user
sessions there are, or how many jobs are actively running on each
controller node. Prometheus can be configured to scrape these metrics
from the controller by hitting the controller metrics endpoint and
storing this data in a time-series database. Clients can later use
Prometheus in conjunction with other software like Grafana or
Metricsbeat to visualize that data and set up alerts.</p>
</div>
<div class="sect2">
<h3 id="_set_up_prometheus"><a class="anchor" href="#_set_up_prometheus"></a>11.1. Set up Prometheus</h3>
<div class="paragraph">
<p>To set up and use Prometheus, you will need to install Prometheus on a
virtual machine or container. Refer to the
<a href="https://prometheus.io/docs/introduction/first_steps/">Prometheus
documentation</a> for further detail.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Prometheus config file (typically <code>prometheus.yml</code>), specify a
<code>&lt;token_value&gt;</code>, a valid user/password for a controller user you have
created, and a <code>&lt;controller_host&gt;</code>.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Alternatively, you can provide an OAuth2 token (which can be generated
at <code>/api/v2/users/N/personal_tokens/</code>). By default, the config assumes a
user with username=admin and password=password.</p>
</div>
</blockquote>
</div>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Using an OAuth2 Token, created at the <code>/api/v2/tokens</code> endpoint to
authenticate prometheus with the controller, the following example
provides a valid scrape config if the URL for your controller&#8217;s metrics
endpoint was <code><a href="https://controller_host:443/metrics" class="bare">https://controller_host:443/metrics</a></code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>scrape_configs

  - job_name: 'controller'
    tls_config:
        insecure_skip_verify: True
    metrics_path: /api/v2/metrics
    scrape_interval: 5s
    scheme: https
    bearer_token: &lt;token_value&gt;
    # basic_auth:
    #   username: admin
    #   password: password
    static_configs:
        - targets:
            - &lt;controller_host&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For help configuring other aspects of Prometheus, such as alerts and
service discovery configurations, refer to the <a href="">Prometheus
configuration docs</a>.</p>
</div>
<div class="paragraph">
<p>If Prometheus is already running, you must restart it in order to apply
the configuration changes by making a <strong>POST</strong> to the reload endpoint, or
by killing the Prometheus process or service.</p>
</div>
</div>
</div>
</blockquote>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Use a browser to navigate to your graph in the Prometheus UI at
<code><a href="http://your_prometheus:9090/graph" class="bare">http://your_prometheus:9090/graph</a></code> and test out some queries. For
example, you can query the current number of active controller user
sessions by executing: <code>awx_sessions_total{type="user"}</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/metrics-prometheus-ui-query-example.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Refer to the metrics endpoint in the controller API for your instance
(<code>api/v2/metrics</code>) for more ways to query.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_secret_handling"><a class="anchor" href="#ag_secret_handling"></a>12. Secret handling and connection security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document describes how Red Hat Ansible Automation Platform
controller handles secrets and connections in a secure fashion.</p>
</div>
<div class="sect2">
<h3 id="_secret_handling"><a class="anchor" href="#_secret_handling"></a>12.1. Secret Handling</h3>
<div class="paragraph">
<p>automation controller manages three sets of secrets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>user passwords for local automation controller users</p>
</li>
<li>
<p>secrets for automation controller operational use (database password,
message bus password, etc.)</p>
</li>
<li>
<p>secrets for automation use (SSH keys, cloud credentials, external
password vault credentials, etc.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>User passwords for local automation controller users
<sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub>~~</p>
</div>
<div class="paragraph">
<p>automation controller hashes local automation controller user passwords
with the PBKDF2 algorithm using a SHA256 hash. Users who authenticate
via external account mechanisms (LDAP, SAML, OAuth, and others) do not
have any password or secret stored.</p>
</div>
<div class="paragraph">
<p>Secret handling for automation controller operational use
<sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub>~</p>
</div>
<div class="paragraph">
<p>automation controller contains the following secrets used operationally:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/etc/tower/SECRET_KEY</p>
<div class="ulist">
<ul>
<li>
<p>A secret key used for encrypting automation secrets in the database
(see below). If the SECRET_KEY changes or is unknown, no encrypted
fields in the database will be accessible.</p>
</li>
</ul>
</div>
</li>
<li>
<p>/etc/tower/tower.\{cert,key}</p>
<div class="ulist">
<ul>
<li>
<p>SSL certificate and key for the automation controller web service. A
self-signed cert/key is installed by default; the customer can provide a
locally appropriate certificate and key.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Database password in /etc/tower/conf.d/postgres.py and message bus
password in /etc/tower/conf.d/channels.py</p>
<div class="ulist">
<ul>
<li>
<p>Passwords for connecting to automation controller component services</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These secrets are all stored unencrypted on the automation controller
server, as they are all needed to be read by the automation controller
service at startup in an automated fashion. All secrets are protected by
Unix permissions, and restricted to root and the automation controller
service user awx.</p>
</div>
<div class="paragraph">
<p>If hiding of these secrets is required, the files that these secrets are
read from are interpreted Python. These files can be adjusted to
retrieve these secrets via some other mechanism anytime a service
restarts. Doing so is a customer provided modification that may need to
be reapplied every upgrade. Red Hat Support and Red Hat Consulting has
examples of such modifications.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>If the secrets system is down, the controller will be unable to get the
information and may fail in a way that would be recoverable once the
service is restored. Using some redundancy on that system is highly
recommended.</p>
</div>
<div class="paragraph">
<p>If, for any reason you believe the <code>SECRET_KEY</code> the controller generated
for you has been compromised and needs to be regenerated, you can run a
tool from the installer that behaves much like the controller backup and
restore tool. To generate a new secret key:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Backup your controller database before you do anything else!</strong> Follow
the procedure described in the
<code>Backing Up and Restoring &lt;administration:ag_backup_restore&gt;</code> section of
this guide.</p>
</li>
<li>
<p>Using the inventory from your install (same inventory with which you
run backups/restores), run <code>setup.sh -k</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A backup copy of the prior key is saved in <code>/etc/tower/</code>.</p>
</div>
<div class="sect3">
<h4 id="_secret_handling_for_automation_use"><a class="anchor" href="#_secret_handling_for_automation_use"></a>12.1.1. Secret handling for automation use</h4>
<div class="paragraph">
<p>automation controller stores a variety of secrets in the database that
are either used for automation or are a result of automation. These
secrets include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>all secret fields of all credential types (passwords, secret keys,
authentication tokens, secret cloud credentials)</p>
</li>
<li>
<p>secret tokens and passwords for external services defined in
automation controller settings</p>
</li>
<li>
<p>“password” type survey fields entries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To encrypt secret fields, the controller uses AES in CBC mode with a
256-bit key for encryption, PKCS7 padding, and HMAC using SHA256 for
authentication. The encryption/decryption process derives the AES-256
bit encryption key from the SECRET_KEY (described above), the field name
of the model field and the database assigned auto-incremented record ID.
Thus, if any attribute used in the key generation process changes, the
controller fails to correctly decrypt the secret. automation controller
is designed such that the SECRET_KEY is never readable in playbooks
automation controller launches, that these secrets are never readable by
the controller users, and no secret field values are ever made available
via the automation controller REST API. If a secret value is used in a
playbook, we recommend using <span class="title-ref">no_log</span> on the task so that it
is not accidentally logged.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connection_security"><a class="anchor" href="#_connection_security"></a>12.2. Connection Security</h3>
<div class="sect3">
<h4 id="_internal_services"><a class="anchor" href="#_internal_services"></a>12.2.1. Internal Services</h4>
<div class="paragraph">
<p>automation controller connects to the following services as part of
internal operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PostgreSQL database</p>
</li>
<li>
<p>A Redis key/value store</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The connection to redis is over a local unix socket, restricted to the
awx service user.</p>
</div>
<div class="paragraph">
<p>The connection to the PostgreSQL database is done via password
authentication over TCP, either via localhost or remotely (external
database). This connection can use PostgreSQL’s built in support for
SSL/TLS, as natively configured by the installer support. SSL/TLS
protocols are configured by the default OpenSSL configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_access"><a class="anchor" href="#_external_access"></a>12.2.2. External Access</h4>
<div class="paragraph">
<p>automation controller is accessed via standard HTTP/HTTPS on standard
ports, provided by nginx. A self-signed cert/key is installed by
default; the customer can provide a locally appropriate certificate and
key. SSL/TLS algorithm support is configured in the
/etc/nginx/nginx.conf configuration file. An “intermediate” profile is
used by default, and can be configured by the customer. Customer changes
must be reapplied on each update.</p>
</div>
</div>
<div class="sect3">
<h4 id="_managed_nodes"><a class="anchor" href="#_managed_nodes"></a>12.2.3. Managed Nodes</h4>
<div class="paragraph">
<p>automation controller also connects to managed machines and services as
part of automation. All connections to managed machines are done via
standard secure mechanism as specified such as SSH, WinRM, SSL/TLS, and
so on -each of these inherits configuration from the system
configuration for the feature in question (such as the system OpenSSL
configuration).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_security_best_practices"><a class="anchor" href="#ag_security_best_practices"></a>13. Security Best Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>automation controller out-of-the-box is deployed in a secure fashion for
use to automate typical environments. However, managing certain
operating system environments, automation, and automation platforms, may
require some additional best practices to ensure security. This document
describes best practices for automation in a secure manner.</p>
</div>
<div class="sect2">
<h3 id="_general_best_practices"><a class="anchor" href="#_general_best_practices"></a>13.1. General best practices</h3>
<div class="paragraph">
<p>An application is only as secure as the underlying system. To secure Red
Hat Enterprise Linux, start with the release-appropriate security guide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Red Hat Enterprise Linux 7:
<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/" class="bare">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/</a></p>
</li>
<li>
<p>For Red Hat Enterprise Linux 8:
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/security_hardening/index" class="bare">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/security_hardening/index</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_understand_the_architecture_of_ansible_and_the_controller"><a class="anchor" href="#_understand_the_architecture_of_ansible_and_the_controller"></a>13.2. Understand the architecture of Ansible and the controller</h3>
<div class="paragraph">
<p>Ansible and automation controller comprise a general purpose,
declarative, automation platform. That means that once an Ansible
playbook is launched (via the controller, or directly on the command
line), the playbook, inventory, and credentials provided to Ansible are
considered to be the source of truth. If policies are desired around
external verification of specific playbook content, job definition, or
inventory contents, these processes must be undertaken before the
automation is launched (whether via the controller web UI, or the
controller API).</p>
</div>
<div class="paragraph">
<p>These can take many forms. The use of source control, branching, and
mandatory code review is best practice for Ansible automation. There are
many tools that can help create process flow around using source control
in this manner.</p>
</div>
<div class="paragraph">
<p>At a higher level, many tools exist that allow for creation of approvals
and policy-based actions around arbitrary workflows, including
automation; these tools can then use Ansible via the controller’s API to
perform automation.</p>
</div>
<div class="paragraph">
<p>We recommend all customers of automation controller select a secure
default administrator password at time of installation. See
<code>tips_change_password</code> for more information.</p>
</div>
<div class="paragraph">
<p>automation controller exposes services on certain well-known ports, such
as port 80 for HTTP traffic and port 443 for HTTPS traffic. We recommend
that you do not expose automation controller on the open internet,
significantly reducing the threat surface of your installation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_granting_access"><a class="anchor" href="#_granting_access"></a>13.3. Granting access</h3>
<div class="paragraph">
<p>Granting access to certain parts of the system exposes security risks.
Apply the following practices to help secure access:</p>
</div>
<div class="sect3">
<h4 id="_minimize_administrative_accounts"><a class="anchor" href="#_minimize_administrative_accounts"></a>13.3.1. Minimize administrative accounts</h4>
<div class="paragraph">
<p>Minimizing the access to system administrative accounts is crucial for
maintaining a secure system. A system administrator/root user can
access, edit, and disrupt any system application. Keep the number of
people/accounts with root access to as small of a group as possible. Do
not give out <span class="title-ref">sudo</span> to <span class="title-ref">root</span> or
<span class="title-ref">awx</span> (the controller user) to untrusted users. Know that
when restricting administrative access via mechanisms like
<span class="title-ref">sudo</span>, that restricting to a certain set of commands may
still give a wide range of access. Any command that allows for execution
of a shell or arbitrary shell commands, or any command that can change
files on the system, is fundamentally equivalent to full root access.</p>
</div>
<div class="paragraph">
<p>In a controller context, any controller ‘system administrator’ or
‘superuser’ account can edit, change, and update any inventory or
automation definition in the controller. Restrict this to the minimum
set of users possible for low-level controller configuration and
disaster recovery only.</p>
</div>
</div>
<div class="sect3">
<h4 id="_minimize_local_system_access"><a class="anchor" href="#_minimize_local_system_access"></a>13.3.2. Minimize local system access</h4>
<div class="paragraph">
<p>automation controller, when used with best practices, should not require
local user access except for administrative purposes. Non-administrator
users should not have access to the controller system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_remove_access_to_credentials_from_users"><a class="anchor" href="#_remove_access_to_credentials_from_users"></a>13.3.3. Remove access to credentials from users</h4>
<div class="paragraph">
<p>If an automation credential is only stored in the controller, it can be
further secured. Services such as OpenSSH can be configured to only
allow credentials on connections from specific addresses. Credentials
used by automation can be different than credentials used by system
administrators for disaster-recovery or other ad-hoc management,
allowing for easier auditing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_enforce_separation_of_duties"><a class="anchor" href="#_enforce_separation_of_duties"></a>13.3.4. Enforce separation of duties</h4>
<div class="paragraph">
<p>Different pieces of automation may need to access a system at different
levels. For example, you may have low-level system automation that
applies patches and performs security baseline checking, while a
higher-level piece of automation deploys applications. By using
different keys or credentials for each piece of automation, the effect
of any one key vulnerability is minimized, while also allowing for easy
baseline auditing.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_available_resources"><a class="anchor" href="#_available_resources"></a>13.4. Available resources</h3>
<div class="paragraph">
<p>Several resources exist in the controller and elsewhere to ensure a
secure platform. Consider utilizing the following functionality:</p>
</div>
<div class="sect3">
<h4 id="_audit_and_logging_functionality"><a class="anchor" href="#_audit_and_logging_functionality"></a>13.4.1. Audit and logging functionality</h4>
<div class="paragraph">
<p>For any administrative access, it is key to audit and watch for actions.
For the system overall, this can be done via the built in audit support
(<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/chap-system_auditing.html" class="bare">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/chap-system_auditing.html</a>)
and via the built-in logging support.</p>
</div>
<div class="paragraph">
<p>For automation controller, this is done via the built-in Activity Stream
support that logs all changes within the controller, as well as via the
automation logs.</p>
</div>
<div class="paragraph">
<p>Best practices dictate collecting logging and auditing centrally, rather
than reviewing it on the local system. It is recommended that automation
controller be configured to use whatever IDS and/or logging/auditing
(Splunk) is standard in your environment. automation controller includes
built-in logging integrations for Elastic Stack, Splunk, Sumologic,
Loggly, and more. See <code>ag_logging</code> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_existing_security_functionality"><a class="anchor" href="#_existing_security_functionality"></a>13.4.2. Existing security functionality</h4>
<div class="paragraph">
<p>Do not disable SELinux, and do not disable the controller’s existing
multi-tenant containment. Use the controller’s role-based access control
(RBAC) to delegate the minimum level of privileges required to run
automation. Use Teams in the controller to assign permissions to groups
of users rather than to users individually. See <code>rbac-ug</code> in the
Automation Controller User Guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_account_stores"><a class="anchor" href="#_external_account_stores"></a>13.4.3. External account stores</h4>
<div class="paragraph">
<p>Maintaining a full set of users just in the controller can be a
time-consuming task in a large organization, prone to error. Automation
controller supports connecting to external account sources via
<code>LDAP &lt;ag_auth_ldap&gt;</code>, <code>SAML 2.0 &lt;ag_auth_saml&gt;</code>, and certain
<code>OAuth providers &lt;ag_social_auth&gt;</code>. Using this eliminates a source of
error when working with permissions.</p>
</div>
</div>
<div class="sect3">
<h4 id="ag_security_django_password"><a class="anchor" href="#ag_security_django_password"></a>13.4.4. Django password policies</h4>
<div class="paragraph">
<p>Controller admins can leverage Django to set password policies at
creation time via <code>AUTH_PASSWORD_VALIDATORS</code> to validate controller user
passwords. In the <code>custom.py</code> file located at <code>/etc/tower/conf.d</code> of
your controller instance, add the following code block example:</p>
</div>
<div class="paragraph">
<p>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
        'OPTIONS': {
            'min_length': 9,
        }
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see
<a href="https://docs.djangoproject.com/en/3.2/topics/auth/passwords/#module-django.contrib.auth.password_validation">Password
management in Django</a> in addition to the example posted above.</p>
</div>
<div class="paragraph">
<p>Be sure to restart your controller instance for the change to take
effect. See <code>ag_restart_tower</code> for detail.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_manage_utility"><a class="anchor" href="#ag_manage_utility"></a>14. The <em>awx-manage</em> Utility</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>awx-manage</code> utility is used to access detailed internal information
of the controller. Commands for <code>awx-manage</code> should run as the <code>awx</code> or
<code>root</code> user.</p>
</div>
<div class="paragraph">
<p>Warning</p>
</div>
<div class="paragraph">
<p>Running awx-manage commands via playbook is not recommended or
supported.</p>
</div>
<div class="sect2">
<h3 id="_inventory_import"><a class="anchor" href="#_inventory_import"></a>14.1. Inventory Import</h3>
<div class="paragraph">
<p><code>awx-manage</code> is a mechanism by which a controller administrator can
import inventory directly into the controller, for those who cannot use
Custom Inventory Scripts.</p>
</div>
<div class="paragraph">
<p>To use <code>awx-manage</code> properly, you must first create an inventory in the
controller to use as the destination for the import.</p>
</div>
<div class="paragraph">
<p>For help with <code>awx-manage</code>, run the following command:
<code>awx-manage inventory_import [--help]</code></p>
</div>
<div class="paragraph">
<p>The <code>inventory_import</code> command synchronizes a controller inventory
object with a text-based inventory file, dynamic inventory script, or a
directory of one or more of the above as supported by core Ansible.</p>
</div>
<div class="paragraph">
<p>When running this command, specify either an <code>--inventory-id</code> or
<code>--inventory-name</code>, and the path to the Ansible inventory source
(<code>--source</code>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>awx-manage inventory_import --source=/ansible/inventory/ --inventory-id=1</pre>
</div>
</div>
<div class="paragraph">
<p>By default, inventory data already stored in the controller blends with
data from the external source. To use only the external data, specify
<code>--overwrite</code>. To specify that any existing hosts get variable data
exclusively from the <code>--source</code>, specify <code>--overwrite_vars</code>. The default
behavior adds any new variables from the external source, overwriting
keys that already exist, but preserves any variables that were not
sourced from the external data source.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>awx-manage inventory_import --source=/ansible/inventory/ --inventory-id=1 --overwrite</pre>
</div>
</div>
<div class="paragraph">
<p>Unresolved directive in administration/tower-manage.adoc - include::overwrite_var_note_2-4-0.adoc[]</p>
</div>
</div>
<div class="sect2">
<h3 id="_cleanup_of_old_data"><a class="anchor" href="#_cleanup_of_old_data"></a>14.2. Cleanup of old data</h3>
<div class="paragraph">
<p><code>awx-manage</code> has a variety of commands used to clean old data from the
controller. The controller administrators can use the controller
Management Jobs interface for access or use the command line.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>awx-manage cleanup_jobs [--help]</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This permanently deletes the job details and job output for jobs older
than a specified number of days.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>awx-manage cleanup_activitystream [--help]</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This permanently deletes any <a href="#activity-streams">activity stream</a>
data older than a specific number of days.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cluster_management"><a class="anchor" href="#_cluster_management"></a>14.3. Cluster management</h3>
<div class="paragraph">
<p>Refer to the <code>ag_clustering</code> section for details on the
<code>awx-manage provision_instance</code> and <code>awx-manage deprovision_instance</code>
commands.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Do not run other <code>awx-manage</code> commands unless instructed by Ansible
Support.</p>
</div>
</div>
<div class="sect2">
<h3 id="ag_token_utility"><a class="anchor" href="#ag_token_utility"></a>14.4. Token and session management</h3>
<div class="paragraph">
<p>automation controller supports the following commands for OAuth2 token
management:</p>
</div>
<div class="sect3">
<h4 id="_create_oauth2_token"><a class="anchor" href="#_create_oauth2_token"></a>14.4.1. <code>create_oauth2_token</code></h4>
<div class="paragraph">
<p>Use this command to create OAuth2 tokens (specify actual username for
<code>example_user</code> below):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ awx-manage create_oauth2_token --user example_user

New OAuth2 token for example_user: j89ia8OO79te6IAZ97L7E8bMgXCON2</pre>
</div>
</div>
<div class="paragraph">
<p>Make sure you provide a valid user when creating tokens. Otherwise, you
will get an error message that you tried to issue the command without
specifying a user, or supplying a username that does not exist.</p>
</div>
</div>
<div class="sect3">
<h4 id="ag_manage_utility_revoke_tokens"><a class="anchor" href="#ag_manage_utility_revoke_tokens"></a>14.4.2. <code>revoke_oauth2_tokens</code></h4>
<div class="paragraph">
<p>Use this command to revoke OAuth2 tokens (both application tokens and
personal access tokens (PAT)). By default, it revokes all application
tokens (but not their associated refresh tokens), and revokes all
personal access tokens. However, you can also specify a user for whom to
revoke all tokens.</p>
</div>
<div class="paragraph">
<p>To revoke all existing OAuth2 tokens:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ awx-manage revoke_oauth2_tokens</pre>
</div>
</div>
<div class="paragraph">
<p>To revoke all OAuth2 tokens &amp; their refresh tokens:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ awx-manage revoke_oauth2_tokens --revoke_refresh</pre>
</div>
</div>
<div class="paragraph">
<p>To revoke all OAuth2 tokens for the user with <code>id=example_user</code> (specify
actual username for <code>example_user</code> below):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ awx-manage revoke_oauth2_tokens --user example_user</pre>
</div>
</div>
<div class="paragraph">
<p>To revoke all OAuth2 tokens and refresh token for the user with
<code>id=example_user</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ awx-manage revoke_oauth2_tokens --user example_user --revoke_refresh</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cleartokens"><a class="anchor" href="#_cleartokens"></a>14.4.3. <code>cleartokens</code></h4>
<div class="paragraph">
<p>Use this command to clear tokens which have already been revoked. Refer
to <a href="">Django&#8217;s Oauth Toolkit documentation on cleartokens</a> for more
detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="_expire_sessions"><a class="anchor" href="#_expire_sessions"></a>14.4.4. <code>expire_sessions</code></h4>
<div class="paragraph">
<p>Use this command to terminate all sessions or all sessions for a
specific user. Consider using this command when a user changes role in
an organization, is removed from assorted groups in LDAP/AD, or the
administrator wants to ensure the user can no longer execute jobs due to
membership in these groups.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ awx-manage expire_sessions</pre>
</div>
</div>
<div class="paragraph">
<p>This command terminates all sessions by default. The users associated
with those sessions will be consequently logged out. To only expire the
sessions of a specific user, you can pass their username using the
<code>--user</code> flag (specify actual username for <code>example_user</code> below):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ awx-manage expire_sessions --user example_user</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clearsessions"><a class="anchor" href="#_clearsessions"></a>14.4.5. <code>clearsessions</code></h4>
<div class="paragraph">
<p>Use this command to delete all sessions that have expired. Refer to
<a href="">Django&#8217;s documentation on clearsessions</a> for more detail.</p>
</div>
<div class="paragraph">
<p>For more information on OAuth2 token management in the controller user
interface, see the <code>ug_applications_auth</code> section of the Automation
Controller User Guide.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_analytics_gathering"><a class="anchor" href="#_analytics_gathering"></a>14.5. Analytics gathering</h3>
<div class="paragraph">
<p>Use this command to gather analytics on-demand outside of the predefined
window (default is 4 hours):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ awx-manage gather_analytics --ship</pre>
</div>
</div>
<div class="paragraph">
<p>For customers with disconnected environments who want to collect usage
information about unique hosts automated across a time period, use this
command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>awx-manage host_metric --since YYYY-MM-DD --until YYYY-MM-DD --json</pre>
</div>
</div>
<div class="paragraph">
<p>The parameters <code>--since</code> and <code>--until</code> specify date ranges and are
optional, but one of them has to be present. The <code>--json</code> flag specifies
the output format and is optional.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_configure_tower"><a class="anchor" href="#ag_configure_tower"></a>15. Controller Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unresolved directive in administration/configure_tower_in_tower.adoc - include::configure_tower.adoc[]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>16. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>17. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>18. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>19. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>20. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>21. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>22. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>23. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>24. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>25. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>26. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>27. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>28. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>29. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>30. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>31. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>32. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>33. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>34. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>35. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>36. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>37. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>38. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>39. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>40. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>41. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>42. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>43. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>44. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>45. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>46. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>47. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>48. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>49. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>50. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>51. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>52. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>53. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>54. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>55. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>56. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>57. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>58. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>59. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>60. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>61. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>62. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>63. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>64. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>65. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>66. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>67. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>68. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>69. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>70. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>71. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>72. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>73. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>74. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>75. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>76. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>77. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>78. Isolation functionality and variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>include::isolation_variables.adoc[]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_oauth2_token_auth"><a class="anchor" href="#ag_oauth2_token_auth"></a>79. Token-Based Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OAuth 2 is used for token-based authentication. You can manage OAuth
tokens as well as applications, a server-side representation of API
clients used to generate tokens. By including an OAuth token as part of
the HTTP authentication header, you can authenticate yourself and adjust
the degree of restrictive permissions in addition to the base RBAC
permissions. Refer to <a href="">RFC 6749</a> for more details of OAuth 2
specification.</p>
</div>
<div class="paragraph">
<p>For details on using the <code>manage</code> utility to create tokens, refer to the
<code>ag_token_utility</code> section.</p>
</div>
<div class="sect2">
<h3 id="_managing_oauth_2_applications_and_tokens"><a class="anchor" href="#_managing_oauth_2_applications_and_tokens"></a>79.1. Managing OAuth 2 Applications and Tokens</h3>
<div class="paragraph">
<p>Applications and tokens can be managed as a top-level resource at
<code>/api/&lt;version&gt;/applications</code> and <code>/api/&lt;version&gt;/tokens</code>. These
resources can also be accessed respective to the user at
<code>/api/&lt;version&gt;/users/N/&lt;resource&gt;</code>. Applications can be created by
making a <strong>POST</strong> to either <code>api/&lt;version&gt;/applications</code> or
<code>/api/&lt;version&gt;/users/N/applications</code>.</p>
</div>
<div class="paragraph">
<p>Each OAuth 2 application represents a specific API client on the server
side. For an API client to use the API via an application token, it must
first have an application and issue an access token. Individual
applications are accessible via their primary keys:
<code>/api/&lt;version&gt;/applications/&lt;pk&gt;/</code>. Here is a typical application:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": 1,
    "type": "o_auth2_application",
    "url": "/api/v2/applications/2/",
    "related": {
        "tokens": "/api/v2/applications/2/tokens/"
    },
    "summary_fields": {
        "organization": {
            "id": 1,
            "name": "Default",
            "description": ""
        },
        "user_capabilities": {
            "edit": true,
            "delete": true
        },
        "tokens": {
            "count": 0,
            "results": []
        }
    },
    "created": "2018-07-02T21:16:45.824400Z",
    "modified": "2018-07-02T21:16:45.824514Z",
    "name": "My Application",
    "description": "",
    "client_id": "Ecmc6RjjhKUOWJzDYEP8TZ35P3dvsKt0AKdIjgHV",
    "client_secret": "7Ft7ym8MpE54yWGUNvxxg6KqGwPFsyhYn9QQfYHlgBxai74Qp1GE4zsvJduOfSFkTfWFnPzYpxqcRsy1KacD0HH0vOAQUDJDCidByMiUIH4YQKtGFM1zE1dACYbpN44E",
    "client_type": "confidential",
    "redirect_uris": "",
    "authorization_grant_type": "password",
    "skip_authorization": false,
    "organization": 1
}</pre>
</div>
</div>
<div class="paragraph">
<p>As shown in the example above, <code>name</code> is the human-readable identifier
of the application. The rest of the fields, like <code>client_id</code> and
<code>redirect_uris</code>, are mainly used for OAuth2 authorization, which is
covered later in <code>ag_use_oauth_pat</code>.</p>
</div>
<div class="paragraph">
<p>The values for the <code>client_id</code> and <code>client_secret</code> fields are generated
during creation and are non-editable identifiers of applications, while
<code>organization</code> and <code>authorization_grant_type</code> are required upon creation
and become non-editable.</p>
</div>
<div class="sect3">
<h4 id="_access_rules_for_applications"><a class="anchor" href="#_access_rules_for_applications"></a>79.1.1. Access Rules for Applications</h4>
<div class="paragraph">
<p>Access rules for applications are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>System administrators can view and manipulate all applications in the
system</p>
</li>
<li>
<p>Organization administrators can view and manipulate all applications
belonging to Organization members</p>
</li>
<li>
<p>Other users can only view, update, and delete their own applications,
but cannot create any new applications</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tokens, on the other hand, are resources used to actually authenticate
incoming requests and mask the permissions of the underlying user. There
are two ways to create a token:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POST to the <code>/api/v2/tokens/</code> endpoint with <code>application</code> and <code>scope</code>
fields to point to the related application and specify token scope</p>
</li>
<li>
<p>POST to the <code>/api/v2/applications/&lt;pk&gt;/tokens/</code> endpoint with the
<code>scope</code> field (the parent application will be automatically linked)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Individual tokens are accessible via their primary keys:
<code>/api/&lt;version&gt;/tokens/&lt;pk&gt;/</code>. Here is an example of a typical token:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": 4,
    "type": "o_auth2_access_token",
    "url": "/api/v2/tokens/4/",
    "related": {
        "user": "/api/v2/users/1/",
        "application": "/api/v2/applications/1/",
        "activity_stream": "/api/v2/tokens/4/activity_stream/"
},
    "summary_fields": {
        "application": {
            "id": 1,
            "name": "Default application for root",
            "client_id": "mcU5J5uGQcEQMgAZyr5JUnM3BqBJpgbgL9fLOVch"
        },
        "user": {
            "id": 1,
            "username": "root",
            "first_name": "",
            "last_name": ""
        }
    },
    "created": "2018-02-23T14:39:32.618932Z",
    "modified": "2018-02-23T14:39:32.643626Z",
    "description": "App Token Test",
    "user": 1,
    "token": "*************",
    "refresh_token": "*************",
    "application": 1,
    "expires": "2018-02-24T00:39:32.618279Z",
    "scope": "read"
},</pre>
</div>
</div>
<div class="paragraph">
<p>For an OAuth 2 token, the only fully editable fields are <code>scope</code> and
<code>description</code>. The <code>application</code> field is non-editable on update, and
all other fields are entirely non-editable, and are auto-populated
during creation, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>user</code> field corresponds to the user the token is created for, and in
this case, is also the user creating the token</p>
</li>
<li>
<p><code>expires</code> is generated according to the controller configuration
setting <code>OAUTH2_PROVIDER</code></p>
</li>
<li>
<p><code>token</code> and <code>refresh_token</code> are auto-generated to be non-clashing
random strings</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both application tokens and personal access tokens are shown at the
<code>/api/v2/tokens/</code> endpoint. The <code>application</code> field in the personal
access tokens is always <strong>null</strong>. This is a good way to differentiate the
two types of tokens.</p>
</div>
</div>
<div class="sect3">
<h4 id="_access_rules_for_tokens"><a class="anchor" href="#_access_rules_for_tokens"></a>79.1.2. Access rules for tokens</h4>
<div class="paragraph">
<p>Access rules for tokens are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Users can create a token if they are able to view the related
application; and are also able to create a personal token for themselves</p>
</li>
<li>
<p>System administrators are able to view and manipulate every token in
the system</p>
</li>
<li>
<p>Organization administrators are able to view and manipulate all tokens
belonging to Organization members</p>
</li>
<li>
<p>System Auditors can view all tokens and applications</p>
</li>
<li>
<p>Other normal users are only able to view and manipulate their own
tokens</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Users can only view the token or refresh the token value at the time of
creation only.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ag_use_oauth_pat"><a class="anchor" href="#ag_use_oauth_pat"></a>79.2. Using OAuth 2 Token System for Personal Access Tokens (PAT)</h3>
<div class="paragraph">
<p>The easiest and most common way to obtain an OAuth 2 token is to create
a personal access token at the <code>/api/v2/users/&lt;userid&gt;/personal_tokens/</code>
endpoint, as shown in this example below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -XPOST -k -H "Content-type: application/json" -d '{"description":"Personal controller CLI token", "application":null, "scope":"write"}' https://&lt;USERNAME&gt;:&lt;PASSWORD&gt;@&lt;CONTROLLER_SERVER&gt;/api/v2/users/&lt;USER_ID&gt;/personal_tokens/ | python -m json.tool</pre>
</div>
</div>
<div class="paragraph">
<p>You could also pipe the JSON output through <code>jq</code>, if installed.</p>
</div>
<div class="paragraph">
<p>Following is an example of using the personal token to access an API
endpoint using curl:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -k -H "Authorization: Bearer &lt;token&gt;" -H "Content-Type: application/json" -X POST  -d '{}' https://controller/api/v2/job_templates/5/launch/</pre>
</div>
</div>
<div class="paragraph">
<p>In automation controller, the OAuth 2 system is built on top of the
<a href="https://django-oauth-toolkit.readthedocs.io/en/latest/">Django Oauth
Toolkit</a>, which provides dedicated endpoints for authorizing, revoking,
and refreshing tokens. These endpoints can be found under the
<code>/api/v2/users/&lt;USER_ID&gt;/personal_tokens/</code> endpoint, which also provides
detailed examples on some typical usage of those endpoints. These
special OAuth 2 endpoints only support using the <code>x-www-form-urlencoded</code>
<strong>Content-type</strong>, so none of the <code>api/o/*</code> endpoints accept
<code>application/json</code>.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>You can also request tokens using the <code>/api/o/token</code> endpoint by
specifying <code>null</code> for the application type.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can <code>add tokens &lt;userguide:ug_tokens_auth_create&gt;</code>
for users through the controller user interface, as well as configure
the expiration of an access token and its associated refresh token (if
applicable).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-system-misc-sys-token-expire.png" alt="image"></span></p>
</div>
<div class="sect3">
<h4 id="_token_scope_mask_over_rbac_system"><a class="anchor" href="#_token_scope_mask_over_rbac_system"></a>79.2.1. Token scope mask over RBAC system</h4>
<div class="paragraph">
<p>The scope of an OAuth 2 token is a space-separated string composed of
valid scope keywords, 'read' and 'write'. These keywords are
configurable and used to specify permission level of the authenticated
API client. Read and write scopes provide a mask layer over the
Role-Based Access Control (RBAC) permission system of automation
controller. Specifically, a 'write' scope gives the authenticated user
the full permissions the RBAC system provides, while a 'read' scope
gives the authenticated user only read permissions the RBAC system
provides. Note that 'write' implies 'read' as well.</p>
</div>
<div class="paragraph">
<p>For example, if you have administrative permissions to a job template,
you can view, modify, launch, and delete the job template if
authenticated via session or basic authentication. In contrast, if you
are authenticated using OAuth 2 token, and the related token scope is
'read', you can only view, but not manipulate or launch the job
template, despite being an administrator. If the token scope is 'write'
or 'read write', you can take full advantage of the job template as its
administrator.</p>
</div>
<div class="paragraph">
<p>To acquire and use a token, first create an application token:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make an application with <code>authorization_grant_type</code> set to <code>password</code>.
HTTP POST the following to the <code>/api/v2/applications/</code> endpoint
(supplying your own organization ID):</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "name": "Admin Internal Application",
    "description": "For use by secure services &amp; clients. ",
    "client_type": "confidential",
    "redirect_uris": "",
    "authorization_grant_type": "password",
    "skip_authorization": false,
    "organization": &lt;organization-id&gt;
}</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Make a token and POST to the <code>/api/v2/tokens/</code> endpoint:</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "description": "My Access Token",
    "application": &lt;application-id&gt;,
    "scope": "write"
}</pre>
</div>
</div>
<div class="paragraph">
<p>This returns a &lt;token-value&gt; that you can use to authenticate with for
future requests (this will not be shown again).</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Use the token to access a resource. The following uses curl as an
example:</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -H "Authorization: Bearer &lt;token-value&gt;" -H "Content-Type: application/json" -X GET https://&lt;controller&gt;/api/v2/users/</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-k</code> flag may be needed if you have not set up a CA yet and are
using SSL.</p>
</div>
<div class="paragraph">
<p>To revoke a token, you can make a DELETE on the detail page for that
token, using that token&#8217;s ID. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -ku &lt;user&gt;:&lt;password&gt; -X DELETE https://&lt;controller&gt;/api/v2/tokens/&lt;pk&gt;/</pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, using a token:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -H "Authorization: Bearer &lt;token-value&gt;" -X DELETE https://&lt;controller&gt;/api/v2/tokens/&lt;pk&gt;/ -k</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ag_oauth2_token_auth_grant_types"><a class="anchor" href="#ag_oauth2_token_auth_grant_types"></a>79.3. Application Functions</h3>
<div class="paragraph">
<p>This page lists OAuth 2 utility endpoints used for authorization, token
refresh, and revoke. The <code>/api/o/</code> endpoints are not meant to be used in
browsers and do not support HTTP GET. The endpoints prescribed here
strictly follow RFC specifications for OAuth 2, so use that for detailed
reference. The following is an example of the typical usage of these
endpoints in the controller, in particular, when creating an application
using various grant types:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p>Authorization Code</p>
</li>
<li>
<p>Password</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>You can perform any of the application functions described here using
the controller user interface. Refer to the
<code>Applications &lt;userguide:ug_applications_auth&gt;</code> section of the
Automation Controller User Guide for more detail.</p>
</div>
<div class="sect3">
<h4 id="_application_using_authorization_code_grant_type"><a class="anchor" href="#_application_using_authorization_code_grant_type"></a>79.3.1. Application using <code>authorization code</code> grant type</h4>
<div class="paragraph">
<p>The application <code>authorization code</code> grant type should be used when
access tokens need to be issued directly to an external application or
service.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>You can only use the <code>authorization code</code> type to acquire an access
token when using an application. When integrating an external webapp
with automation controller, that webapp may need to create OAuth2 Tokens
on behalf of users in that other webapp. Creating an application in the
controller with the <code>authorization code</code> grant type is the preferred way
to do this because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>this allows an external application to obtain a token from the
controller for a user, using their credentials.</p>
</li>
<li>
<p>compartmentalized tokens issued for a particular application allows
those tokens to be easily managed (revoke all tokens associated with
that application without having to revoke <em>all</em> tokens in the system,
for example)</p>
</li>
</ul>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>To create an application named <em>AuthCodeApp</em> with the
<code>authorization-code</code> grant type, perform a POST to the
<code>/api/v2/applications/</code> endpoint:</p>
</div>
</blockquote>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "name": "AuthCodeApp",
    "user": 1,
    "client_type": "confidential",
    "redirect_uris": "http://&lt;controller&gt;/api/v2",
    "authorization_grant_type": "authorization-code",
    "skip_authorization": false
}


.. _`Django-oauth-toolkit simple test application`: http://django-oauth-toolkit.herokuapp.com/consumer/</pre>
</div>
</div>
<div class="paragraph">
<p>The workflow that occurs when you issue a <strong>GET</strong> to the <code>authorize</code>
endpoint from the client application with the <code>response_type</code>,
<code>client_id</code>, <code>redirect_uris</code>, and <code>scope</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The controller responds with the authorization code and status to the
<code>redirect_uri</code> specified in the application.</p>
</li>
<li>
<p>The client application then makes a <strong>POST</strong> to the <code>api/o/token/</code>
endpoint on the controller with the <code>code</code>, <code>client_id</code>,
<code>client_secret</code>, <code>grant_type</code>, and <code>redirect_uri</code>.</p>
</li>
<li>
<p>The controller responds with the <code>access_token</code>, <code>token_type</code>,
<code>refresh_token</code>, and <code>expires_in</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Refer to <a href="">Django&#8217;s Test Your Authorization Server</a> toolkit to test
this flow.</p>
</div>
<div class="paragraph">
<p>You may specify the number of seconds an authorization code remains
valid in the <strong>System settings</strong> screen:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-system-misc-sys-authcode-expire.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Requesting an access token after this duration will fail. The duration
defaults to 600 seconds (10 minutes), based on the
<a href="https://tools.ietf.org/html/rfc6749">RFC6749</a> recommendation.</p>
</div>
<div class="paragraph">
<p>The best way to set up app integrations with automation controller using
the Authorization Code grant type is to whitelist the origins for those
cross-site requests. More generally, you need to whitelist the service
or application you are integrating with the controller, for which you
want to provide access tokens. To do this, have your Administrator add
this whitelist to their local controller settings:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CORS_ALLOWED_ORIGIN_REGEXES = [
    r"http://django-oauth-toolkit.herokuapp.com*",
    r"http://www.example.com*"
]</pre>
</div>
</div>
<div class="paragraph">
<p>Where <code><a href="http://django-oauth-toolkit.herokuapp.com" class="bare">http://django-oauth-toolkit.herokuapp.com</a></code> and
<code><a href="http://www.example.com" class="bare">http://www.example.com</a></code> are applications needing tokens with which to
access the controller.</p>
</div>
</div>
<div class="sect3">
<h4 id="_application_using_password_grant_type"><a class="anchor" href="#_application_using_password_grant_type"></a>79.3.2. Application using <code>password</code> grant type</h4>
<div class="paragraph">
<p>The <code>password</code> grant type or <code>Resource owner password-based</code> grant type
is ideal for users who have native access to the web app and should be
used when the client is the Resource owner. The following supposes an
application, 'Default Application' with grant type <code>password</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": 6,
    "type": "application",
    ...
    "name": "Default Application",
    "user": 1,
    "client_id": "gwSPoasWSdNkMDtBN3Hu2WYQpPWCO9SwUEsKK22l",
    "client_secret": "fI6ZpfocHYBGfm1tP92r0yIgCyfRdDQt0Tos9L8a4fNsJjQQMwp9569eIaUBsaVDgt2eiwOGe0bg5m5vCSstClZmtdy359RVx2rQK5YlIWyPlrolpt2LEpVeKXWaiybo",
    "client_type": "confidential",
    "redirect_uris": "",
    "authorization_grant_type": "password",
    "skip_authorization": false
}</pre>
</div>
</div>
<div class="paragraph">
<p>Logging in is not required for <code>password</code> grant type, so you can simply
use curl to acquire a personal access token through the
<code>/api/v2/tokens/</code> endpoint:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -k --user &lt;user&gt;:&lt;password&gt; -H "Content-type: application/json" \
-X POST \
--data '{
    "description": "Token for Nagios Monitoring app",
    "application": 1,
    "scope": "write"
}' \
https://&lt;controller&gt;/api/v2/tokens/</pre>
</div>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The special OAuth 2 endpoints only support using the
<code>x-www-form-urlencoded</code> <strong>Content-type</strong>, so as a result, none of the
<code>api/o/*</code> endpoints accept <code>application/json</code>.</p>
</div>
<div class="paragraph">
<p>Upon success, a response displays in JSON format containing the access
token, refresh token and other information:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK
Server: nginx/1.12.2
Date: Tue, 05 Dec 2017 16:48:09 GMT
Content-Type: application/json
Content-Length: 163
Connection: keep-alive
Content-Language: en
Vary: Accept-Language, Cookie
Pragma: no-cache
Cache-Control: no-store
Strict-Transport-Security: max-age=15768000

{"access_token": "9epHOqHhnXUcgYK8QanOmUQPSgX92g", "token_type": "Bearer", "expires_in": 315360000000, "refresh_token": "jMRX6QvzOTf046KHee3TU5mT3nyXsz", "scope": "read"}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_application_token_functions"><a class="anchor" href="#_application_token_functions"></a>79.4. Application Token Functions</h3>
<div class="paragraph">
<p>This section describes the refresh and revoke functions associated with
tokens. Everything that follows (Refreshing and revoking tokens at the
<code>/api/o/</code> endpoints) can currently only be done with application tokens.</p>
</div>
<div class="sect3">
<h4 id="_refresh_an_existing_access_token"><a class="anchor" href="#_refresh_an_existing_access_token"></a>79.4.1. Refresh an existing access token</h4>
<div class="paragraph">
<p>The following example shows an existing access token with a refresh
token provided:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": 35,
    "type": "access_token",
    ...
    "user": 1,
    "token": "omMFLk7UKpB36WN2Qma9H3gbwEBSOc",
    "refresh_token": "AL0NK9TTpv0qp54dGbC4VUZtsZ9r8z",
    "application": 6,
    "expires": "2017-12-06T03:46:17.087022Z",
    "scope": "read write"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>/api/o/token/</code> endpoint is used for refreshing the access token:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST \
    -d "grant_type=refresh_token&amp;refresh_token=AL0NK9TTpv0qp54dGbC4VUZtsZ9r8z" \
    -u "gwSPoasWSdNkMDtBN3Hu2WYQpPWCO9SwUEsKK22l:fI6ZpfocHYBGfm1tP92r0yIgCyfRdDQt0Tos9L8a4fNsJjQQMwp9569eIaUBsaVDgt2eiwOGe0bg5m5vCSstClZmtdy359RVx2rQK5YlIWyPlrolpt2LEpVeKXWaiybo" \
    http://&lt;controller&gt;/api/o/token/ -i</pre>
</div>
</div>
<div class="paragraph">
<p>In the above POST request, <code>refresh_token</code> is provided by
<code>refresh_token</code> field of the access token above that. The authentication
information is of format <code>&lt;client_id&gt;:&lt;client_secret&gt;</code>, where
<code>client_id</code> and <code>client_secret</code> are the corresponding fields of the
underlying related application of the access token.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The special OAuth 2 endpoints only support using the
<code>x-www-form-urlencoded</code> <strong>Content-type</strong>, so as a result, none of the
<code>api/o/*</code> endpoints accept <code>application/json</code>.</p>
</div>
<div class="paragraph">
<p>Upon success, a response displays in JSON format containing the new
(refreshed) access token with the same scope information as the previous
one:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK
Server: nginx/1.12.2
Date: Tue, 05 Dec 2017 17:54:06 GMT
Content-Type: application/json
Content-Length: 169
Connection: keep-alive
Content-Language: en
Vary: Accept-Language, Cookie
Pragma: no-cache
Cache-Control: no-store
Strict-Transport-Security: max-age=15768000

{"access_token": "NDInWxGJI4iZgqpsreujjbvzCfJqgR", "token_type": "Bearer", "expires_in": 315360000000, "refresh_token": "DqOrmz8bx3srlHkZNKmDpqA86bnQkT", "scope": "read write"}</pre>
</div>
</div>
<div class="paragraph">
<p>Essentially, the refresh operation replaces the existing token by
deleting the original and then immediately creating a new token with the
same scope and related application as the original one. Verify that new
token is present and the old one is deleted in the <code>/api/v2/tokens/</code>
endpoint.</p>
</div>
</div>
<div class="sect3">
<h4 id="ag_oauth2_token_revoke"><a class="anchor" href="#ag_oauth2_token_revoke"></a>79.4.2. Revoke an access token</h4>
<div class="paragraph">
<p>Similarly, you can revoke an access token by using the
<code>/api/o/revoke-token/</code> endpoint.</p>
</div>
<div class="paragraph">
<p>Revoking an access token by this method is the same as deleting the
token resource object, but it allows you to delete a token by providing
its token value, and the associated <code>client_id</code> (and <code>client_secret</code> if
the application is <code>confidential</code>). For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST -d "token=rQONsve372fQwuc2pn76k3IHDCYpi7" \
-u "gwSPoasWSdNkMDtBN3Hu2WYQpPWCO9SwUEsKK22l:fI6ZpfocHYBGfm1tP92r0yIgCyfRdDQt0Tos9L8a4fNsJjQQMwp9569eIaUBsaVDgt2eiwOGe0bg5m5vCSstClZmtdy359RVx2rQK5YlIWyPlrolpt2LEpVeKXWaiybo" \
http://&lt;controller&gt;/api/o/revoke_token/ -i</pre>
</div>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The special OAuth 2 endpoints only support using the
<code>x-www-form-urlencoded</code> <strong>Content-type</strong>, so as a result, none of the
<code>api/o/*</code> endpoints accept <code>application/json</code>.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The <strong>Allow External Users to Create Oauth2 Tokens</strong>
(<code>ALLOW_OAUTH2_FOR_EXTERNAL_USERS</code> in the API) setting is disabled by
default. External users refer to users authenticated externally with a
service like LDAP, or any of the other SSO services. This setting
ensures external users cannot <em>create</em> their own tokens. If you enable
then disable it, any tokens created by external users in the meantime
will still exist, and are not automatically revoked.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <code>manage</code> utility,
<code>ag_manage_utility_revoke_tokens</code>, to revoke tokens as described in the
the <code>ag_token_utility</code> section.</p>
</div>
<div class="paragraph">
<p>This setting can be configured at the system-level in the automation
controller User Interface:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-system-oauth2-tokens-toggle.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Upon success, a response of <code>200 OK</code> displays. Verify the deletion by
checking whether the token is present in the <code>/api/v2/tokens/</code> endpoint.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_social_auth"><a class="anchor" href="#ag_social_auth"></a>80. Setting up Social Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authentication methods help simplify logins for end users&#8212;&#8203;offering
single sign-ons using existing login information to sign into a third
party website rather than creating a new login account specifically for
that website.</p>
</div>
<div class="paragraph">
<p>Account authentication can be configured in the automation controller
User Interface and saved to the PostgreSQL database. For instructions,
refer to the <code>ag_configure_tower</code> section.</p>
</div>
<div class="paragraph">
<p>Account authentication in automation controller can be configured to
centrally use OAuth2, while enterprise-level account authentication can
be configured for SAML, RADIUS, or even LDAP as a source for
authentication information. See <code>ag_ent_auth</code>.</p>
</div>
<div class="paragraph">
<p>For websites, such as Microsoft Azure, Google or GitHub, that provide
account information, account information is often implemented using the
OAuth standard. OAuth is a secure authorization protocol which is
commonly used in conjunction with account authentication to grant 3rd
party applications a "session token" allowing them to make API calls to
providers on the user’s behalf.</p>
</div>
<div class="paragraph">
<p>SAML (Security Assertion Markup Language) is an XML-based, open-standard
data format for exchanging account authentication and authorization data
between an identity provider and a service provider.</p>
</div>
<div class="paragraph">
<p>The RADIUS distributed client/server system allows you to secure
networks against unauthorized access and can be implemented in network
environments requiring high levels of security while maintaining network
access for remote users.</p>
</div>
<div class="sect2">
<h3 id="ag_auth_github"><a class="anchor" href="#ag_auth_github"></a>80.1. GitHub settings</h3>
<div class="paragraph">
<p>To set up social authentication for GitHub, you will need to obtain an
OAuth2 key and secret for a web application. To do this, you must first
register the new application with GitHub at
<a href="https://github.com/settings/developers" class="bare">https://github.com/settings/developers</a>. In order to register the
application, you must supply it with your homepage URL, which is the
<strong>Callback URL</strong> shown in the Details tab for the GitHub default settings
page. The OAuth2 key (Client ID) and secret (Client Secret) will be used
to supply the required fields in the automation controller User
Interface.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>GitHub settings</strong> from
the list of Authentication options.</p>
</li>
<li>
<p>Click the <strong>GitHub Default</strong> tab if not already selected.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>GitHub OAuth2 Callback URL</strong> field is already pre-populated and
non-editable. Once the application is registered, GitHub displays the
Client ID and Client Secret.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click <strong>Edit</strong> and copy and paste GitHub&#8217;s Client ID into the <strong>GitHub
OAuth2 Key</strong> field.</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s Client Secret into the <strong>GitHub OAuth2 Secret</strong>
field.</p>
</li>
<li>
<p>For details on completing the mapping fields, see <code>ag_org_team_maps</code>.</p>
</li>
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
<li>
<p>To verify that the authentication was configured correctly, logout of
automation controller and the login screen will now display the GitHub
logo to allow logging in with those credentials.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-github-logo.png" alt="image"></span></p>
</div>
<div class="sect3">
<h4 id="ag_auth_github_org"><a class="anchor" href="#ag_auth_github_org"></a>80.1.1. GitHub Organization settings</h4>
<div class="paragraph">
<p>When defining account authentication with either an organization or a
team within an organization, you should use the specific organization
and team settings. Account authentication can be limited by an
organization as well as by a team within an organization.</p>
</div>
<div class="paragraph">
<p>You can also choose to allow all by specifying non-organization or
non-team based settings (as shown above).</p>
</div>
<div class="paragraph">
<p>You can limit users who can login to the controller by limiting only
those in an organization or on a team within an organization.</p>
</div>
<div class="paragraph">
<p>To set up social authentication for a GitHub Organization, you will need
to obtain an OAuth2 key and secret for a web application. To do this,
you must first register your organization-owned application at
<code><a href="https://github.com/organizations/&lt;yourorg&gt;/settings/applications" class="bare">https://github.com/organizations/&lt;yourorg&gt;/settings/applications</a></code>. In
order to register the application, you must supply it with your
Authorization callback URL, which is the <strong>Callback URL</strong> shown in the
Details page. Each key and secret must belong to a unique application
and cannot be shared or reused between different authentication
backends. The OAuth2 key (Client ID) and secret (Client Secret) will be
used to supply the required fields in the automation controller User
Interface.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>GitHub settings</strong> from
the list of Authentication options.</p>
</li>
<li>
<p>Click the <strong>GitHub Organization</strong> tab.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>GitHub Organization OAuth2 Callback URL</strong> field is already
pre-populated and non-editable.</p>
</div>
<div class="paragraph">
<p>Once the application is registered, GitHub displays the Client ID and
Client Secret.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click <strong>Edit</strong> and copy and paste GitHub&#8217;s Client ID into the <strong>GitHub
Organization OAuth2 Key</strong> field.</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s Client Secret into the <strong>GitHub Organization
OAuth2 Secret</strong> field.</p>
</li>
<li>
<p>Enter the name of your GitHub organization, as used in your
organization&#8217;s URL (e.g., <a href="https://github.com/&lt;yourorg&gt;/" class="bare">https://github.com/&lt;yourorg&gt;/</a>) in the <strong>GitHub
Organization Name</strong> field.</p>
</li>
<li>
<p>For details on completing the mapping fields, see <code>ag_org_team_maps</code>.</p>
</li>
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
<li>
<p>To verify that the authentication was configured correctly, logout of
automation controller and the login screen will now display the GitHub
Organization logo to allow logging in with those credentials.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-github-orgs-logo.png" alt="image"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="ag_auth_github_team"><a class="anchor" href="#ag_auth_github_team"></a>80.1.2. GitHub Team settings</h4>
<div class="paragraph">
<p>To set up social authentication for a GitHub Team, you will need to
obtain an OAuth2 key and secret for a web application. To do this, you
must first register your team-owned application at
<code><a href="https://github.com/organizations/&lt;yourorg&gt;/settings/applications" class="bare">https://github.com/organizations/&lt;yourorg&gt;/settings/applications</a></code>. In
order to register the application, you must supply it with your
Authorization callback URL, which is the <strong>Callback URL</strong> shown in the
Details page. Each key and secret must belong to a unique application
and cannot be shared or reused between different authentication
backends. The OAuth2 key (Client ID) and secret (Client Secret) will be
used to supply the required fields in the automation controller User
Interface.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find the numeric team ID using the GitHub API:
<a href="http://fabian-kostadinov.github.io/2015/01/16/how-to-find-a-github-team-id/" class="bare">http://fabian-kostadinov.github.io/2015/01/16/how-to-find-a-github-team-id/</a>.
The Team ID will be used to supply a required field in the automation
controller User Interface.</p>
</li>
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>GitHub settings</strong> from
the list of Authentication options.</p>
</li>
<li>
<p>Click the <strong>GitHub Team</strong> tab.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>GitHub Team OAuth2 Callback URL</strong> field is already pre-populated and
non-editable. Once the application is registered, GitHub displays the
Client ID and Client Secret.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click <strong>Edit</strong> and copy and paste GitHub&#8217;s Client ID into the <strong>GitHub
Team OAuth2 Key</strong> field.</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s Client Secret into the <strong>GitHub Team OAuth2
Secret</strong> field.</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s team ID in the <strong>GitHub Team ID</strong> field.</p>
</li>
<li>
<p>For details on completing the mapping fields, see <code>ag_org_team_maps</code>.</p>
</li>
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
<li>
<p>To verify that the authentication was configured correctly, logout of
automation controller and the login screen will now display the GitHub
Team logo to allow logging in with those credentials.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-github-teams-logo.png" alt="image"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_github_enterprise_settings"><a class="anchor" href="#_github_enterprise_settings"></a>80.1.3. GitHub Enterprise settings</h4>
<div class="paragraph">
<p>To set up social authentication for a GitHub Enterprise, you will need
to obtain a GitHub Enterprise URL, an API URL, OAuth2 key and secret for
a web application. To obtain the URLs, refer to the GitHub documentation
on
<a href="https://docs.github.com/en/enterprise-server@3.1/rest/reference/enterprise-admin">GitHub
Enterprise administration</a> . To obtain the key and secret, you must
first register your enterprise-owned application at
<code><a href="https://github.com/organizations/&lt;yourorg&gt;/settings/applications" class="bare">https://github.com/organizations/&lt;yourorg&gt;/settings/applications</a></code>. In
order to register the application, you must supply it with your
Authorization callback URL, which is the <strong>Callback URL</strong> shown in the
Details page. Because its hosted on site and not github.com, you must
specify which auth adapter it will talk to.</p>
</div>
<div class="paragraph">
<p>Each key and secret must belong to a unique application and cannot be
shared or reused between different authentication backends. The OAuth2
key (Client ID) and secret (Client Secret) will be used to supply the
required fields in the automation controller User Interface.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>GitHub settings</strong> from
the list of Authentication options.</p>
</li>
<li>
<p>Click the <strong>GitHub Enterprise</strong> tab.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>GitHub Enterprise OAuth2 Callback URL</strong> field is already
pre-populated and non-editable. Once the application is registered,
GitHub displays the Client ID and Client Secret.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click <strong>Edit</strong> to configure GitHub Enterprise settings.</p>
</li>
<li>
<p>In the <strong>GitHub Enterprise URL</strong> field, enter the hostname of the GitHub
Enterprise instance (e.g., <a href="https://github.example.com" class="bare">https://github.example.com</a>).</p>
</li>
<li>
<p>In the <strong>GitHub Enterprise API URL</strong> field, enter the API URL of the
GitHub Enterprise instance (e.g., <a href="https://github.example.com/api/v3" class="bare">https://github.example.com/api/v3</a>)</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s Client ID into the <strong>GitHub Enterprise OAuth2
Key</strong> field.</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s Client Secret into the <strong>GitHub Enterprise
OAuth2 Secret</strong> field.</p>
</li>
<li>
<p>For details on completing the mapping fields, see <code>ag_org_team_maps</code>.</p>
</li>
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
<li>
<p>To verify that the authentication was configured correctly, logout of
automation controller and the login screen will now display the GitHub
Enterprise logo to allow logging in with those credentials.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-github-ent-logo.png" alt="image"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_github_enterprise_organization_settings"><a class="anchor" href="#_github_enterprise_organization_settings"></a>80.1.4. GitHub Enterprise Organization settings</h4>
<div class="paragraph">
<p>To set up social authentication for a GitHub Enterprise Org, you will
need to obtain a GitHub Enterprise Org URL, an Org API URL, an Org
OAuth2 key and secret for a web application. To obtain the URLs, refer
to the GitHub documentation on
<a href="https://docs.github.com/en/enterprise-server@3.1/rest/reference/enterprise-admin">GitHub
Enterprise administration</a> . To obtain the key and secret, you must
first register your enterprise organization-owned application at
<code><a href="https://github.com/organizations/&lt;yourorg&gt;/settings/applications" class="bare">https://github.com/organizations/&lt;yourorg&gt;/settings/applications</a></code>. In
order to register the application, you must supply it with your
Authorization callback URL, which is the <strong>Callback URL</strong> shown in the
Details page. Because its hosted on site and not github.com, you must
specify which auth adapter it will talk to.</p>
</div>
<div class="paragraph">
<p>Each key and secret must belong to a unique application and cannot be
shared or reused between different authentication backends. The OAuth2
key (Client ID) and secret (Client Secret) will be used to supply the
required fields in the automation controller User Interface.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>GitHub settings</strong> from
the list of Authentication options.</p>
</li>
<li>
<p>Click the <strong>GitHub Enterprise Organization</strong> tab.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>GitHub Enterprise Organization OAuth2 Callback URL</strong> field is
already pre-populated and non-editable. Once the application is
registered, GitHub displays the Client ID and Client Secret.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click <strong>Edit</strong> to configure GitHub Enterprise Organization settings.</p>
</li>
<li>
<p>In the <strong>GitHub Enterprise Organization URL</strong> field, enter the hostname
of the GitHub Enterprise Org instance (e.g.,
<a href="https://github.orgexample.com" class="bare">https://github.orgexample.com</a>).</p>
</li>
<li>
<p>In the <strong>GitHub Enterprise Organization API URL</strong> field, enter the API
URL of the GitHub Enterprise Org instance (e.g.,
<a href="https://github.orgexample.com/api/v3" class="bare">https://github.orgexample.com/api/v3</a>)</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s Client ID into the <strong>GitHub Enterprise
Organization OAuth2 Key</strong> field.</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s Client Secret into the <strong>GitHub Enterprise
Organization OAuth2 Secret</strong> field.</p>
</li>
<li>
<p>Enter the name of your GitHub Enterprise organization, as used in your
organization&#8217;s URL (e.g., <a href="https://github.com/&lt;yourorg&gt;/" class="bare">https://github.com/&lt;yourorg&gt;/</a>) in the <strong>GitHub
Enterprise Organization Name</strong> field.</p>
</li>
<li>
<p>For details on completing the mapping fields, see <code>ag_org_team_maps</code>.</p>
</li>
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
<li>
<p>To verify that the authentication was configured correctly, logout of
automation controller and the login screen will now display the GitHub
Enterprise Organization logo to allow logging in with those credentials.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-github-ent-org-logo.png" alt="image"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_github_enterprise_team_settings"><a class="anchor" href="#_github_enterprise_team_settings"></a>80.1.5. GitHub Enterprise Team settings</h4>
<div class="paragraph">
<p>To set up social authentication for a GitHub Enterprise teams, you will
need to obtain a GitHub Enterprise Org URL, an Org API URL, an Org
OAuth2 key and secret for a web application. To obtain the URLs, refer
to the GitHub documentation on
<a href="https://docs.github.com/en/enterprise-server@3.1/rest/reference/enterprise-admin">GitHub
Enterprise administration</a> . To obtain the key and secret, you must
first register your enterprise team-owned application at
<code><a href="https://github.com/organizations/&lt;yourorg&gt;/settings/applications" class="bare">https://github.com/organizations/&lt;yourorg&gt;/settings/applications</a></code>. In
order to register the application, you must supply it with your
Authorization callback URL, which is the <strong>Callback URL</strong> shown in the
Details page. Because its hosted on site and not github.com, you must
specify which auth adapter it will talk to.</p>
</div>
<div class="paragraph">
<p>Each key and secret must belong to a unique application and cannot be
shared or reused between different authentication backends. The OAuth2
key (Client ID) and secret (Client Secret) will be used to supply the
required fields in the automation controller User Interface.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find the numeric team ID using the GitHub API:
<a href="http://fabian-kostadinov.github.io/2015/01/16/how-to-find-a-github-team-id/" class="bare">http://fabian-kostadinov.github.io/2015/01/16/how-to-find-a-github-team-id/</a>.
The Team ID will be used to supply a required field in the automation
controller User Interface.</p>
</li>
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>GitHub settings</strong> from
the list of Authentication options.</p>
</li>
<li>
<p>Click the <strong>GitHub Enterprise Team</strong> tab.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>GitHub Enterprise Team OAuth2 Callback URL</strong> field is already
pre-populated and non-editable. Once the application is registered,
GitHub displays the Client ID and Client Secret.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Click <strong>Edit</strong> to configure GitHub Enterprise Team settings.</p>
</li>
<li>
<p>In the <strong>GitHub Enterprise Team URL</strong> field, enter the hostname of the
GitHub Enterprise team instance (e.g., <a href="https://github.teamexample.com" class="bare">https://github.teamexample.com</a>).</p>
</li>
<li>
<p>In the <strong>GitHub Enterprise Team API URL</strong> field, enter the API URL of
the GitHub Enterprise team instance (e.g.,
<a href="https://github.teamexample.com/api/v3" class="bare">https://github.teamexample.com/api/v3</a>)</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s Client ID into the <strong>GitHub Enterprise Team
OAuth2 Key</strong> field.</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s Client Secret into the <strong>GitHub Enterprise Team
OAuth2 Secret</strong> field.</p>
</li>
<li>
<p>Copy and paste GitHub&#8217;s team ID in the <strong>GitHub Enterprise Team ID</strong>
field.</p>
</li>
<li>
<p>For details on completing the mapping fields, see <code>ag_org_team_maps</code>.</p>
</li>
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
<li>
<p>To verify that the authentication was configured correctly, logout of
automation controller and the login screen will now display the GitHub
Enterprise Teams logo to allow logging in with those credentials.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-github-ent-teams-logo.png" alt="image"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ag_auth_google_oauth2"><a class="anchor" href="#ag_auth_google_oauth2"></a>80.2. Google OAuth2 settings</h3>
<div class="paragraph">
<p>To set up social authentication for Google, you will need to obtain an
OAuth2 key and secret for a web application. To do this, you must first
create a project and set it up with Google. Refer to
<a href="https://support.google.com/googleapi/answer/6158849" class="bare">https://support.google.com/googleapi/answer/6158849</a> for instructions. If
you already completed the setup process, you can access those
credentials by going to the Credentials section of the
<a href="https://console.developers.google.com/">Google API Manager Console</a>. The
OAuth2 key (Client ID) and secret (Client secret) will be used to supply
the required fields in the automation controller User Interface.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>Google OAuth 2
settings</strong> from the list of Authentication options.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>Google OAuth2 Callback URL</strong> field is already pre-populated and
non-editable.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>The following fields are also pre-populated. If not, use the
credentials Google supplied during the web application setup process,
and look for the values with the same format as the ones shown in the
example below:</p>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Edit</strong> and copy and paste Google&#8217;s Client ID into the <strong>Google
OAuth2 Key</strong> field.</p>
</li>
<li>
<p>Copy and paste Google&#8217;s Client secret into the <strong>Google OAuth2 Secret</strong>
field.</p>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-google.png" alt="image"></span></p>
</div>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>To complete the remaining optional fields, refer to the tooltips in
each of the fields for instructions and required format.</p>
</li>
<li>
<p>For details on completing the mapping fields, see <code>ag_org_team_maps</code>.</p>
</li>
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
<li>
<p>To verify that the authentication was configured correctly, logout of
automation controller and the login screen will now display the Google
logo to indicate it as a alternate method of logging into automation
controller.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-google-logo.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="ag_org_team_maps"><a class="anchor" href="#ag_org_team_maps"></a>80.3. Organization and Team Mapping</h3>
<div class="sect3">
<h4 id="_organization_mapping"><a class="anchor" href="#_organization_mapping"></a>80.3.1. Organization mapping</h4>
<div class="paragraph">
<p>You will need to control which users are placed into which controller
organizations based on their username and email address (mapping out
your organization admins/users from social or enterprise-level
authentication accounts).</p>
</div>
<div class="paragraph">
<p>Dictionary keys are organization names. Organizations will be created,
if not already present and if the license allows for multiple
organizations. Otherwise, the single default organization is used
regardless of the key.</p>
</div>
<div class="paragraph">
<p>Values are dictionaries defining the options for each organization&#8217;s
membership. For each organization, it is possible to specify which users
are automatically users of the organization and also which users can
administer the organization.</p>
</div>
<div class="paragraph">
<p><strong>admins</strong>: None, True/False, string or list/tuple of strings.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p>If <strong>None</strong>, organization admins will not be updated.</p>
</li>
<li>
<p>If <strong>True</strong>, all users using account authentication will automatically
be added as admins of the organization.</p>
</li>
<li>
<p>If <strong>False</strong>, no account authentication users will be automatically
added as admins of the organization.</p>
</li>
<li>
<p>If a string or list of strings, specifies the usernames and emails for
users who will be added to the organization. Strings beginning and
ending with <code>/</code> will be compiled into regular expressions; modifiers <code>i</code>
(case-insensitive) and <code>m</code> (multi-line) may be specified after the
ending <code>/</code>.</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>remove_admins</strong>: True/False. Defaults to <strong>True</strong>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p>When <strong>True</strong>, a user who does not match is removed from the
organization&#8217;s administrative list.</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>users</strong>: None, True/False, string or list/tuple of strings. Same rules
apply as for <strong>admins</strong>.</p>
</div>
<div class="paragraph">
<p><strong>remove_users</strong>: True/False. Defaults to <strong>True</strong>. Same rules apply as for
<strong>remove_admins</strong>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "Default": {
        "users": true
    },
    "Test Org": {
        "admins": ["admin@example.com"],
        "users": true
    },
    "Test Org 2": {
        "admins": ["admin@example.com", "/^controller-[^@]+?@.*$/i"],
        "users": "/^[^@].*?@example\\.com$/"
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Organization mappings may be specified separately for each account
authentication backend. If defined, these configurations will take
precedence over the global configuration above.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SOCIAL_AUTH_GOOGLE_OAUTH2_ORGANIZATION_MAP = {}
SOCIAL_AUTH_GITHUB_ORGANIZATION_MAP = {}
SOCIAL_AUTH_GITHUB_ORG_ORGANIZATION_MAP = {}
SOCIAL_AUTH_GITHUB_TEAM_ORGANIZATION_MAP = {}
SOCIAL_AUTH_SAML_ORGANIZATION_MAP = {}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_team_mapping"><a class="anchor" href="#_team_mapping"></a>80.3.2. Team mapping</h4>
<div class="paragraph">
<p>Team mapping is the mapping of team members (users) from social auth
accounts. Keys are team names (will be created if not present). Values
are dictionaries of options for each team&#8217;s membership, where each can
contain the following parameters:</p>
</div>
<div class="paragraph">
<p><strong>organization</strong>: string. The name of the organization to which the team
belongs. The team will be created if the combination of organization and
team name does not exist. The organization will first be created if it
does not exist. If the license does not allow for multiple
organizations, the team will always be assigned to the single default
organization.</p>
</div>
<div class="paragraph">
<p><strong>users</strong>: None, True/False, string or list/tuple of strings.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p>If <strong>None</strong>, team members will not be updated.</p>
</li>
<li>
<p>If <strong>True</strong>/<strong>False</strong>, all social auth users will be added/removed as team
members.</p>
</li>
<li>
<p>If a string or list of strings, specifies expressions used to match
users. User will be added as a team member if the username or email
matches. Strings beginning and ending with <code>/</code> will be compiled into
regular expressions; modifiers <code>i</code> (case-insensitive) and <code>m</code>
(multi-line) may be specified after the ending <code>/</code>.</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>remove</strong>: True/False. Defaults to <strong>True</strong>. When <strong>True</strong>, a user who does
not match the rules above is removed from the team.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "My Team": {
        "organization": "Test Org",
        "users": ["/^[^@]+?@test\\.example\\.com$/"],
        "remove": true
    },
    "Other Team": {
        "organization": "Test Org 2",
        "users": ["/^[^@]+?@test\\.example\\.com$/"],
        "remove": false
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Team mappings may be specified separately for each account
authentication backend, based on which of these you setup. When defined,
these configurations take precedence over the the global configuration
above.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SOCIAL_AUTH_GOOGLE_OAUTH2_TEAM_MAP = {}
SOCIAL_AUTH_GITHUB_TEAM_MAP = {}
SOCIAL_AUTH_GITHUB_ORG_TEAM_MAP = {}
SOCIAL_AUTH_GITHUB_TEAM_TEAM_MAP = {}
SOCIAL_AUTH_SAML_TEAM_MAP = {}</pre>
</div>
</div>
<div class="paragraph">
<p>Uncomment the line below (i.e. set <code>SOCIAL_AUTH_USER_FIELDS</code> to an empty
list) to prevent new user accounts from being created. Only users who
have previously logged in to the controller using social or
enterprise-level authentication or have a user account with a matching
email address will be able to login.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SOCIAL_AUTH_USER_FIELDS = []</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_ent_auth"><a class="anchor" href="#ag_ent_auth"></a>81. Setting up Enterprise Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes setting up authentication for the following
enterprise systems:</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>For LDAP authentication, see <code>ag_auth_ldap</code>.</p>
</div>
<div class="paragraph">
<p>SAML, RADIUS, and TACACS+ users are categorized as 'Enterprise' users.
The following rules apply to Enterprise users:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enterprise users can only be created via the first successful login
attempt from remote authentication backend.</p>
</li>
<li>
<p>Enterprise users cannot be created/authenticated if non-enterprise
users with the same name has already been created in the controller.</p>
</li>
<li>
<p>The controller passwords of enterprise users should always be empty
and cannot be set by any user if there are enterprise backend-enabled.</p>
</li>
<li>
<p>If enterprise backends are disabled, an enterprise user can be
converted to a normal controller user by setting the password field.
However, this operation is irreversible, as the converted controller
user can no longer be treated as enterprise user.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ag_auth_azure"><a class="anchor" href="#ag_auth_azure"></a>81.1. Azure AD settings</h3>
<div class="paragraph">
<p>To set up enterprise authentication for Microsoft Azure Active Directory
(AD), you will need to obtain an OAuth2 key and secret by registering
your organization-owned application from Azure at
<a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app" class="bare">https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app</a>.
Each key and secret must belong to a unique application and cannot be
shared or reused between different authentication backends. In order to
register the application, you must supply it with your webpage URL,
which is the Callback URL shown in the Settings Authentication screen.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>Azure AD settings</strong>
from the list of Authentication options.</p>
</li>
<li>
<p>The <strong>Azure AD OAuth2 Callback URL</strong> field is already pre-populated and
non-editable. Once the application is registered, Azure displays the
Application ID and Object ID.</p>
</li>
<li>
<p>Click <strong>Edit</strong> and copy and paste Azure&#8217;s Application ID to the <strong>Azure
AD OAuth2 Key</strong> field.</p>
<div class="paragraph">
<p>Following Azure AD&#8217;s documentation for connecting your app to Microsoft
Azure Active Directory, supply the key (shown at one time only) to the
client for authentication.</p>
</div>
</li>
<li>
<p>Copy and paste the actual secret key created for your Azure AD
application to the <strong>Azure AD OAuth2 Secret</strong> field of the Settings -
Authentication screen.</p>
</li>
<li>
<p>For details on completing the mapping fields, see <code>ag_org_team_maps</code>.</p>
</li>
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
<li>
<p>To verify that the authentication was configured correctly, logout of
automation controller and the login screen will now display the
Microsoft Azure logo to allow logging in with those credentials.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-azure-logo.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>For application registering basics in Azure AD, refer to the
<a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview">Azure
AD Identity Platform (v2)</a> overview.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ldap_authentication"><a class="anchor" href="#_ldap_authentication"></a>81.2. LDAP Authentication</h3>
<div class="paragraph">
<p>Refer to the <code>ag_auth_ldap</code> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="ag_auth_radius"><a class="anchor" href="#ag_auth_radius"></a>81.3. RADIUS settings</h3>
<div class="paragraph">
<p>automation controller can be configured to centrally use RADIUS as a
source for authentication information.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>RADIUS settings</strong> from
the list of Authentication options.</p>
</li>
<li>
<p>Click <strong>Edit</strong> and enter the Host or IP of the Radius server in the
<strong>Radius Server</strong> field. If this field is left blank, Radius
authentication is disabled.</p>
</li>
<li>
<p>Enter the port and secret information in the next two fields.</p>
</li>
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ag_auth_saml"><a class="anchor" href="#ag_auth_saml"></a>81.4. SAML settings</h3>
<div class="paragraph">
<p>SAML allows the exchange of authentication and authorization data
between an Identity Provider (IdP - a system of servers that provide the
Single Sign On service) and a Service Provider (in this case, automation
controller). automation controller can be configured to talk with SAML
in order to authenticate (create/login/logout) controller users. User
Team and Organization membership can be embedded in the SAML response to
the controller.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-saml-topology.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The following instructions describe automation controller as the service
provider. To authenticate users through RHSSO (keycloak), refer to the
<a href="https://www.ansible.com/blog/red-hat-single-sign-on-integration-with-ansible-tower">Red
Hat Single Sign On Integration with the Automation Controller</a> blog.</p>
</div>
<div class="paragraph">
<p>To setup SAML authentication:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>SAML settings</strong> from
the list of Authentication options.</p>
</li>
<li>
<p>The <strong>SAML Assertion Consume Service (ACS) URL</strong> and <strong>SAML Service
Provider Metadata URL</strong> fields are pre-populated and are non-editable.
Contact the Identity Provider administrator and provide the information
contained in these fields.</p>
</li>
<li>
<p>Click <strong>Edit</strong> and set the <strong>SAML Service Provider Entity ID</strong> to be the
same as the <strong>Base URL of the controller host</strong> field that can be found in
the Miscellaneous System settings screen by clicking <strong>Settings</strong> from the
left navigation bar. Through the API, it can be viewed in the
<code>/api/v2/settings/system</code>, under the <code>CONTROLLER_BASE_URL</code> variable. The
Entity ID can be set to any one of the individual controller cluster
nodes, but it is good practice to set it to the URL of the Service
Provider. Ensure that the Base URL matches the FQDN of the load balancer
(if used).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The Base URL is different for each node in a cluster. Commonly, a load
balancer will sit in front of many controller cluster nodes to provide a
single entry point, the controller Cluster FQDN. The SAML Service
Provider must be able establish an outbound connection and route to the
controller Cluster Node or the controller Cluster FQDN set in the SAML
Service Provider Entity ID.</p>
</div>
<div class="paragraph">
<p>In this example, the Service Provider is the controller cluster, and
therefore, the ID is set to the controller Cluster FQDN.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-saml-spentityid.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create a server certificate for the Ansible cluster. Typically when an
Ansible cluster is configured, the controller nodes will be configured
to handle HTTP traffic only and the load balancer will be an SSL
Termination Point. In this case, an SSL certificate is required for the
load balancer, and not for the individual controller Cluster Nodes. SSL
can either be enabled or disabled per individual controller node, but
should be disabled when using an SSL terminated load balancer. It is
recommended to use a non-expiring self signed certificate to avoid
periodically updating certificates. This way, authentication will not
fail in case someone forgets to update the certificate.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The <strong>SAML Service Provider Public Certificate</strong> field should contain the
entire certificate, including the "-----BEGIN CERTIFICATE-----" and
"-----END CERTIFICATE-----".</p>
</div>
<div class="paragraph">
<p>If you are using a CA bundle with your certificate, include the entire
bundle in this field.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-saml-cert.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>As an example for public certs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>-----BEGIN CERTIFICATE——
... cert text ...
-----END CERTIFICATE——</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Create an optional private key for the controller to use as a service
provider (SP) and enter it in the <strong>SAML Service Provider Private Key</strong>
field.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As an example for private keys:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>-----BEGIN PRIVATE KEY--
... key text ...
-----END PRIVATE KEY——</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Provide the IdP with some details about the controller cluster during
the SSO process in the <strong>SAML Service Provider Organization Info</strong> field.</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "en-US": {
    "url": "http://www.example.com",
    "displayname": "Example",
    "name": "example"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-saml-org-info.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>These fields are required in order to properly configure SAML within the
controller.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Provide the IdP with the technical contact information in the <strong>SAML
Service Provider Technical Contact</strong> field. Do not remove the contents of
this field.</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>{
"givenName": "Some User",
"emailAddress": "suser@example.com"
}</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-saml-techcontact-info.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Provide the IdP with the support contact information in the <strong>SAML
Service Provider Support Contact</strong> field. Do not remove the contents of
this field.</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>{
"givenName": "Some User",
"emailAddress": "suser@example.com"
}</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-saml-suppcontact-info.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>In the <strong>SAML Enabled Identity Providers</strong> field, provide information on
how to connect to each Identity Provider listed. The controller expects
the following SAML attributes in the example below:</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>Username(urn:oid:0.9.2342.19200300.100.1.1)
Email(urn:oid:0.9.2342.19200300.100.1.3)
FirstName(urn:oid:2.5.4.42)
LastName(urn:oid:2.5.4.4)</pre>
</div>
</div>
<div class="paragraph">
<p>If these attributes are not known, map existing SAML attributes to
lastname, firstname, email and username.</p>
</div>
<div class="paragraph">
<p>Configure the required keys for each IDp:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p><code>attr_user_permanent_id</code> - the unique identifier for the user. It can
be configured to match any of the attribute sent from the IdP. Usually,
it is set to <code>name_id</code> if <code>SAML:nameid</code> attribute is sent to the
controller node or it can be the username attribute, or a custom unique
identifier.</p>
</li>
<li>
<p><code>entity_id</code> - the Entity ID provided by the Identity Provider
administrator. The admin creates a SAML profile for the controller and
it generates a unique URL.</p>
</li>
<li>
<p><code>url</code> - the Single Sign On (SSO) URL the controller redirects the user
to, when SSO is activated.</p>
</li>
<li>
<p><code>x509_cert</code> - the certificate provided by the IdP admin generated from
the SAML profile created on the Identity Provider. Remove the
<code>--BEGIN CERTIFICATE--</code> and <code>--END CERTIFICATE--</code> headers, then enter
the cert as one non-breaking string.</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Multiple SAML IdPs are supported. Some IdPs may provide user data using
attribute names that differ from the default OIDs
(<a href="https://github.com/omab/python-social-auth/blob/master/social/backends/saml.py" class="bare">https://github.com/omab/python-social-auth/blob/master/social/backends/saml.py</a>).
The SAML <code>NameID</code> is a special attribute used by some Identity Providers
to tell the Service Provider (the controller cluster) what the unique
user identifier is. If it is used, set the <code>attr_user_permanent_id</code> to
<code>name_id</code> as shown in the example. Other attribute names may be
overridden for each IdP as shown below.</p>
</div>
</blockquote>
</div>
<div class="literalblock">
<div class="content">
<pre>{
"myidp": {
  "entity_id": "https://idp.example.com",
  "url": "https://myidp.example.com/sso",
  "x509cert": ""
},
"onelogin": {
  "entity_id": "https://app.onelogin.com/saml/metadata/123456",
  "url": "https://example.onelogin.com/trust/saml2/http-post/sso/123456",
  "x509cert": "",
  "attr_user_permanent_id": "name_id",
  "attr_first_name": "User.FirstName",
  "attr_last_name": "User.LastName",
  "attr_username": "User.email",
  "attr_email": "User.email"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-saml-idps.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Warning</p>
</div>
<div class="paragraph">
<p>Do not create a SAML user that shares the same email with another user
(including a non-SAML user). Doing so will result in the accounts being
merged. Be aware that this same behavior exists for System Admin users,
thus a SAML login with the same email address as the System Admin user
will login with System Admin privileges. For future reference, you can
remove (or add) Admin Privileges based on SAML mappings, as described in
subsequent steps.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The IdP provides the email, last name and firstname using the well known
SAML urn. The IdP uses a custom SAML attribute to identify a user, which
is an attribute that the controller is unable to read. Instead, the
controller can understand the unique identifier name, which is the URN.
Use the URN listed in the SAML “Name” attribute for the user attributes
as shown in the example below.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-saml-idps-urn.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>Optionally provide the <strong>SAML Organization Map</strong>. For further detail,
see <code>ag_org_team_maps</code>.</p>
</li>
<li>
<p>The controller can be configured to look for particular attributes
that contain Team and Organization membership to associate with users
when they log into the controller. The attribute names are defined in
the <strong>SAML Organization Attribute Mapping</strong> and the <strong>SAML Team Attribute
Mapping</strong> fields.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example SAML Organization Attribute Mapping</strong></p>
</div>
<div class="paragraph">
<p>Below is an example SAML attribute that embeds user organization
membership in the attribute <em>member-of</em>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;saml2:AttributeStatement&gt;
    &lt;saml2:Attribute FriendlyName="member-of" Name="member-of"
NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"&gt;
        &lt;saml2:AttributeValue&gt;Engineering&lt;/saml2:AttributeValue&gt;
        &lt;saml2:AttributeValue&gt;IT&lt;/saml2:AttributeValue&gt;
        &lt;saml2:AttributeValue&gt;HR&lt;/saml2:AttributeValue&gt;
        &lt;saml2:AttributeValue&gt;Sales&lt;/saml2:AttributeValue&gt;
    &lt;/saml2:Attribute&gt;
    &lt;saml2:Attribute FriendlyName="admin-of" Name="admin-of"
NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"&gt;
        &lt;saml2:AttributeValue&gt;Engineering&lt;/saml2:AttributeValue&gt;
    &lt;/saml2:Attribute&gt;
&lt;/saml2:AttributeStatement&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Below is the corresponding controller configuration.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "saml_attr": "member-of",
  "saml_admin_attr": "admin-of",
  "remove": true,
  "remove_admins": false
}</pre>
</div>
</div>
<div class="paragraph">
<p><code>saml_attr</code>: is the SAML attribute name where the organization array can
be found and <code>remove</code> is set to <strong>True</strong> to remove a user from all
organizations before adding the user to the list of Organizations. To
keep the user in whatever Organization(s) they are in while adding the
user to the Organization(s) in the SAML attribute, set <code>remove</code> to
<strong>False</strong>.</p>
</div>
<div class="paragraph">
<p><code>saml_admin_attr</code>: Similar to the <code>saml_attr</code> attribute, but instead of
conveying organization membership, this attribute conveys admin
organization permissions.</p>
</div>
<div class="paragraph">
<p><strong>Example SAML Team Attribute Mapping</strong></p>
</div>
<div class="paragraph">
<p>Below is another example of a SAML attribute that contains a Team
membership in a list.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;saml:AttributeStatement&gt;
     &lt;saml:Attribute
        xmlns:x500="urn:oasis:names:tc:SAML:2.0:profiles:attribute:X500"
        x500:Encoding="LDAP"
        NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:uri"
        Name="urn:oid:1.3.6.1.4.1.5923.1.1.1.1"
        FriendlyName="eduPersonAffiliation"&gt;
        &lt;saml:AttributeValue
            xsi:type="xs:string"&gt;member&lt;/saml:AttributeValue&gt;
        &lt;saml:AttributeValue
            xsi:type="xs:string"&gt;staff&lt;/saml:AttributeValue&gt;
        &lt;/saml:Attribute&gt;
&lt;/saml:AttributeStatement&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "saml_attr": "eduPersonAffiliation",
    "remove": true,
    "team_org_map": [
    {
        "team": "member",
        "organization": "Default1"
    },
    {
        "team": "staff",
        "organization": "Default2"
    }
  ]
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>saml_attr</code>: The SAML attribute name where the team array can be
found.</p>
</li>
<li>
<p><code>remove</code>: Set <code>remove</code> to <strong>True</strong> to remove user from all Teams before
adding the user to the list of Teams. To keep the user in whatever
Team(s) they are in while adding the user to the Team(s) in the SAML
attribute, set <code>remove</code> to <strong>False</strong>.</p>
</li>
<li>
<p><code>team_org_map</code>: An array of dictionaries of the form
<code>{ "team": "&lt;AWX Team Name&gt;", "organization": "&lt;AWX Org Name&gt;" }</code> that
defines mapping from controller Team &#8594; controller Organization. This is
needed because the same named Team can exist in multiple Organizations
in the controller. The organization to which a team listed in a SAML
attribute belongs to, would be ambiguous without this mapping.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You could create an alias to override both Teams and Orgs in the <strong>SAML
Team Attribute Mapping</strong>. This option becomes very handy in cases when
the SAML backend sends out complex group names, like in the example
below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
 "remove": false,
 "team_org_map": [
  {
   "team": "internal:unix:domain:admins",
   "organization": "Default",
   "team_alias": "Administrators"
  },
  {
   "team": "Domain Users",
   "organization_alias": "OrgAlias",
   "organization": "Default"
  }
 ],
 "saml_attr": "member-of"
}</pre>
</div>
</div>
<div class="paragraph">
<p>Once the user authenticates, the controller creates organization and
team aliases, as expected.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>Optionally provide team membership mapping in the <strong>SAML Team Map</strong>
field. For further detail, see <code>ag_org_team_maps</code>.</p>
</li>
<li>
<p>Optionally provide security settings in the <strong>SAML Security Config</strong>
field. This field is the equivalent to the
<code>SOCIAL_AUTH_SAML_SECURITY_CONFIG</code> field in the API. Refer to the
<a href="https://github.com/onelogin/python-saml#settings">OneLogin&#8217;s SAML Python
Toolkit</a> for further detail.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The controller uses the <code>python-social-auth</code> library when users log in
through SAML. This library relies on the <code>python-saml</code> library to make
available the settings for the next two optional fields, <strong>SAML Service
Provider Extra Configuration Data</strong> and <strong>SAML IDP to EXTRA_DATA Attribute
Mapping</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>The <strong>SAML Service Provider Extra Configuration Data</strong> field is
equivalent to the <code>SOCIAL_AUTH_SAML_SP_EXTRA</code> in the API. Refer to the
<a href="https://github.com/onelogin/python-saml#settings">python-saml library
documentation</a> to learn about the valid service provider extra
(<code>SP_EXTRA</code>) parameters.</p>
</li>
<li>
<p>The <strong>SAML IDP to EXTRA_DATA Attribute Mapping</strong> field is equivalent to
the <code>SOCIAL_AUTH_SAML_EXTRA_DATA</code> in the API. See Python&#8217;s
<a href="http://python-social-auth-docs.readthedocs.io/en/latest/backends/saml.html#advanced-settings">SAML
Advanced Settings</a> documentation for more information.</p>
</li>
</ol>
</div>
<div id="ag_auth_saml_user_flags_attr_map" class="olist arabic">
<ol class="arabic" start="17">
<li>
<p>The <strong>SAML User Flags Attribute Mapping</strong> field allows you to map SAML
roles and attributes to special user flags. The following attributes are
valid in this field:</p>
<div class="ulist">
<ul>
<li>
<p><code>is_superuser_role</code>: Specifies one or more SAML roles which will grant
a user the superuser flag</p>
</li>
<li>
<p><code>is_superuser_attr</code>: Specifies a SAML attribute which will grant a
user the superuser flag</p>
</li>
<li>
<p><code>is_superuser_value</code>: Specifies one or more values required for
<code>is_superuser_attr</code> that is required for the user to be a superuser</p>
</li>
<li>
<p><code>remove_superusers</code>: Boolean indicating if the superuser flag should
be removed for users or not. Defaults to <code>true</code>. (See below for more
details)</p>
</li>
<li>
<p><code>is_system_auditor_role</code>: Specifies one or more SAML roles which will
grant a user the system auditor flag</p>
</li>
<li>
<p><code>is_system_auditor_attr</code>: Specifies a SAML attribute which will grant
a user the system auditor flag</p>
</li>
<li>
<p><code>is_system_auditor_value</code>: Specifies one or more values required for
<code>is_system_auditor_attr</code> that is required for the user to be a system
auditor</p>
</li>
<li>
<p><code>remove_system_auditors</code>: Boolean indicating if the system_auditor
flag should be removed for users or not. Defaults to <code>true</code>. (See below
for more details)</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>role</code> and <code>value</code> fields are lists and are <span class="title-ref">or</span> logic.
So if you specify two roles: <span class="title-ref">[ "Role 1", "Role 2" ]</span> and
the SAML user has either role the logic will consider them to have the
required role for the flag. This is the same with the <code>value</code> field, if
you specify: <span class="title-ref">[ "Value 1", "Value 2"]</span> and the SAML user has
either value for their attribute the logic will consider their attribute
value to have matched.</p>
</div>
<div class="paragraph">
<p>If <code>role</code> and <code>attr</code> are both specified for either <code>superuser</code> or
<code>system_auditor</code>, the settings for <code>attr</code> will take precedence over a
<code>role</code>. System Admin and System Auditor roles are evaluated at login for
a SAML user. If you grant a SAML user one of these roles through the UI
and not through the SAML settings, the roles will be removed on the
user&#8217;s next login unless the <code>remove</code> flag is set to false. The remove
flag, if <code>false</code>, will never allow the SAML adapter to remove the
corresponding flag from a user. The following table describes how the
logic works.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 11%;">
<col style="width: 27%;">
<col style="width: 12%;">
<col style="width: 14%;">
<col style="width: 11%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Has one or more roles</th>
<th class="tableblock halign-left valign-top">Has Attr</th>
<th class="tableblock halign-left valign-top">Has one or more Attr Values</th>
<th class="tableblock halign-left valign-top">Remove
Flag</th>
<th class="tableblock halign-left valign-top">Previous Flag</th>
<th class="tableblock halign-left valign-top">Is Flagged</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each time a SAML user authenticates to automation controller, these
checks will be performed and the user flags will be altered as needed.
If <code>System Administrator</code> or <code>System Auditor</code> is set for a SAML user
within the UI, the SAML adapter will override the UI setting based on
the rules above. If you would prefer that the user flags for SAML users
do not get removed when a SAML user logs in, you can set the <code>remove_</code>
flag to <code>false</code>. With the remove flag set to <code>false</code>, a user flag set to
<code>true</code> through either the UI, API or SAML adapter will not be removed.
However, if a user does not have the flag, and the above rules determine
the flag should be added, it will be added, even if the flag is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "is_superuser_attr": "blueGroups",
    "is_superuser_role": "is_superuser",
    "is_superuser_value": "cn=My-Sys-Admins,ou=memberlist,ou=mygroups,o=myco.com",
    "is_system_auditor_attr": "blueGroups",
    "is_system_auditor_role": "is_system_auditor",
    "is_system_auditor_value": "cn=My-Auditors,ou=memberlist,ou=mygroups,o=myco.com"
}</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="18">
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
<li>
<p>To verify that the authentication was configured correctly, load the
auto-generated URL found in the <strong>SAML Service Provider Metadata URL</strong>
into a browser. It should output XML output, otherwise, it is not
configured correctly.</p>
<div class="paragraph">
<p>Alternatively, logout of automation controller and the login screen will
now display the SAML logo to indicate it as a alternate method of
logging into automation controller.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-saml-logo.png" alt="image"></span></p>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_transparent_saml_logins"><a class="anchor" href="#_transparent_saml_logins"></a>81.4.1. Transparent SAML Logins</h4>
<div class="paragraph">
<p>For transparent logins to work, you must first get IdP-initiated logins
to work. To achieve this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the <code>RelayState</code> on the IdP to the key of the IdP definition in
the <code>SAML Enabled Identity Providers</code> field as previously described. In
the example given above, <code>RelayState</code> would need to be either <code>myidp</code> or
<code>onelogin</code>.</p>
</li>
<li>
<p>Once this is working, specify the redirect URL for non-logged-in users
to somewhere other than the default controller login page by using the
<strong>Login redirect override URL</strong> field in the Miscellaneous Authentication
settings window of the <strong>Settings</strong> menu, accessible from the left
navigation bar. This should be set to
<code>/sso/login/saml/?idp=&lt;name-of-your-idp&gt;</code> for transparent SAML login, as
shown in the example.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-system-login-redirect-url.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The above is a sample of a typical IdP format, but may not be the
correct format for your particular case. You may need to reach out to
your IdP for the correct transparent redirect URL as that URL is not the
same for all IdPs.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>After transparent SAML login is configured, to log in using local
credentials or a different SSO, go directly to
<code><a href="https://&lt;your-tower-server&gt;/login" class="bare">https://&lt;your-tower-server&gt;/login</a></code>. This provides the standard
controller login page, including SSO authentication buttons, and allows
you to log in with any configured method.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_logging_for_saml"><a class="anchor" href="#_enabling_logging_for_saml"></a>81.4.2. Enabling Logging for SAML</h4>
<div class="paragraph">
<p>You can enable logging messages for the SAML adapter the same way you
can enable logging for LDAP. Refer to the <code>ldap_logging</code> section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ag_auth_tacacs"><a class="anchor" href="#ag_auth_tacacs"></a>81.5. TACACS+ settings</h3>
<div class="paragraph">
<p>Terminal Access Controller Access-Control System Plus (TACACS+) is a
protocol that handles remote authentication and related services for
networked access control through a centralized server. In particular,
TACACS+ provides authentication, authorization and accounting (AAA)
services, in which you can configure automation controller to use as a
source for authentication.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>This feature is deprecated and will be removed in a future release.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation bar.</p>
</li>
<li>
<p>On the left side of the Settings window, click <strong>TACACs+ settings</strong> from
the list of Authentication options.</p>
</li>
<li>
<p>Click <strong>Edit</strong> and enter information in the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>TACACS+ Server</strong>: Provide the hostname or IP address of the TACACS+
server with which to authenticate. If this field is left blank, TACACS+
authentication is disabled.</p>
</li>
<li>
<p><strong>TACACS+ Port</strong>: TACACS+ uses port 49 by default, which is already
pre-populated.</p>
</li>
<li>
<p><strong>TACACS+ Secret</strong>: Secret key for TACACS+ authentication server.</p>
</li>
<li>
<p><strong>TACACS+ Auth Session Timeout</strong>: Session timeout value in seconds. The
default is 5 seconds.</p>
</li>
<li>
<p><strong>TACACS+ Authentication Protocol</strong>: The protocol used by TACACS+
client. Options are <strong>ascii</strong> or <strong>pap</strong>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-tacacs.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_auth_ldap"><a class="anchor" href="#ag_auth_ldap"></a>82. Setting up LDAP Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>If the LDAP server you want to connect to has a certificate that is
self-signed or signed by a corporate internal certificate authority
(CA), the CA certificate must be added to the system&#8217;s trusted CAs.
Otherwise, connection to the LDAP server will result in an error that
the certificate issuer is not recognized.</p>
</div>
<div class="paragraph">
<p>Administrators use LDAP as a source for account authentication
information for the controller users. User authentication is provided,
but not the synchronization of user permissions and credentials.
Organization membership (as well as the organization admin) and team
memberships can be synchronized.</p>
</div>
<div class="paragraph">
<p>When so configured, a user who logs in with an LDAP username and
password automatically gets a controller account created for them and
they can be automatically placed into organizations as either regular
users or organization administrators.</p>
</div>
<div class="paragraph">
<p>Users created via an LDAP login cannot change their username, first
name, last name, or set a local password for themselves. This is also
tunable to restrict editing of other field names.</p>
</div>
<div class="paragraph">
<p>To configure LDAP integration for the controller:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>First, create a user in LDAP that has access to read the entire LDAP
structure.</p>
</li>
<li>
<p>Test if you can make successful queries to the LDAP server, use the
<code>ldapsearch</code> command, which is a command line tool that can be installed
on the controller system&#8217;s command line as well as on other Linux and
OSX systems. Use the following command to query the ldap server, where
<em>josie</em> and <em>Josie4Cloud</em> are replaced by attributes that work for your
setup:</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>ldapsearch -x  -H ldap://win -D "CN=josie,CN=Users,DC=website,DC=com" -b "dc=website,dc=com" -w Josie4Cloud</pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>CN=josie,CN=users,DC=website,DC=com</code> is the Distinguished Name of
the connecting user.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The <code>ldapsearch</code> utility is not automatically pre-installed with
automation controller, however, you can install it from the
<code>openldap-clients</code> package.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>In the automation controller User Interface, click <strong>Settings</strong> from the
left navigation and click to select <strong>LDAP settings</strong> from the list of
Authentication options.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>You can configure multiple LDAP servers by specifying the server to
configure (otherwise, leave the server at <strong>Default</strong>):</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-ldap-servers.png" alt="image"></span></p>
</div>
<div class="verseblock">
<pre class="content"></pre>
</div>
<div class="paragraph">
<p>The equivalent API endpoints will show <code>AUTH_LDAP_*</code> repeated:
<code>AUTH_LDAP_1_*</code>, <code>AUTH_LDAP_2_*</code>, &#8230;&#8203;, <code>AUTH_LDAP_5_*</code> to denote server
designations.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click <strong>Edit</strong> and enter the LDAP server address to connect to in the
<strong>LDAP Server URI</strong> field using the same format as the one shown in the
text field. Below is an example:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-ldap-server-uri.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Enter the Distinguished Name in the <strong>LDAP Bind DN</strong> text field to
specify the user that the controller uses to connect (Bind) to the LDAP
server. Below uses the example, <code>CN=josie,CN=users,DC=website,DC=com</code>:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-ldap-bind-dn.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Enter the password to use for the Binding user in the <strong>LDAP Bind
Password</strong> text field. In this example, the password is 'passme':</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-ldap-bind-pwd.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>If that name is stored in key <code>sAMAccountName</code>, the <strong>LDAP User DN
Template</strong> populates with <code>(sAMAccountName=%(user)s)</code>. Active Directory
stores the username to <code>sAMAccountName</code>. Similarly, for OpenLDAP, the
key is <code>uid</code>--hence the line becomes <code>(uid=%(user)s)</code>.</p>
</li>
<li>
<p>Click to select a group type from the <strong>LDAP Group Type</strong> drop-down menu
list.</p>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>LDAP Group Types include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PosixGroupType</code></p>
</li>
<li>
<p><code>GroupOfNamesType</code></p>
</li>
<li>
<p><code>GroupOfUniqueNamesType</code></p>
</li>
<li>
<p><code>ActiveDirectoryGroupType</code></p>
</li>
<li>
<p><code>OrganizationalRoleGroupType</code></p>
</li>
<li>
<p><code>MemberDNGroupType</code></p>
</li>
<li>
<p><code>NISGroupType</code></p>
</li>
<li>
<p><code>NestedGroupOfNamesType</code></p>
</li>
<li>
<p><code>NestedGroupOfUniqueNamesType</code></p>
</li>
<li>
<p><code>NestedActiveDirectoryGroupType</code></p>
</li>
<li>
<p><code>NestedOrganizationalRoleGroupType</code></p>
</li>
<li>
<p><code>NestedMemberDNGroupType</code></p>
</li>
<li>
<p><code>PosixUIDGroupType</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The LDAP Group Types that are supported by the controller leverage the
underlying <a href="">django-auth-ldap library</a>.</p>
</div>
<div class="paragraph">
<p>Each <strong>LDAP Group Type</strong> can potentially take different parameters. The
controller exposes <code>LDAP_GROUP_TYPE_PARAMS</code> to account for this.
<code>LDAP_GROUP_TYPE_PARAMS</code> is a dictionary, which will be converted by the
controller to kwargs and passed to the LDAP Group Type class selected.
There are two common parameters used by any of the LDAP Group Type;
<code>name_attr</code> and <code>member_attr</code>. Where <code>name_attr</code> defaults to <code>cn</code> and
<code>member_attr</code> defaults to <code>member</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{"name_attr": "cn", "member_attr": "member"}</pre>
</div>
</div>
<div class="paragraph">
<p>To determine what parameters a specific LDAP Group Type expects. refer
to the <a href="">django_auth_ldap</a> documentation around the classes <code>init</code>
parameters.</p>
</div>
</blockquote>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Enter the group distinguish name to allow users within that group to
access the controller in the <strong>LDAP Require Group</strong> field, using the same
format as the one shown in the text field. In this example, use:
<code>CN=controller Users,OU=Users,DC=website,DC=com</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-ldap-req-group.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Enter the group distinguish name to prevent users within that group to
access the controller in the <strong>LDAP Deny Group</strong> field, using the same
format as the one shown in the text field. In this example, leave the
field blank.</p>
</li>
<li>
<p>The <strong>LDAP Start TLS</strong> is disabled by default. To enable TLS when the
LDAP connection is not using SSL, click the toggle to <strong>ON</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-ldap-start-tls.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="12">
<li>
<p>Enter where to search for users while authenticating in the <strong>LDAP USER
SEARCH</strong> field using the same format as the one shown in the text field.
In this example, use:</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>[
"OU=Users,DC=website,DC=com",
"SCOPE_SUBTREE",
"(cn=%(user)s)"
]</pre>
</div>
</div>
<div class="paragraph">
<p>The first line specifies where to search for users in the LDAP tree. In
the above example, the users are searched recursively starting from
<code>DC=website,DC=com</code>.</p>
</div>
<div class="paragraph">
<p>The second line specifies the scope where the users should be searched:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p>SCOPE_BASE: This value is used to indicate searching only the entry at
the base DN, resulting in only that entry being returned</p>
</li>
<li>
<p>SCOPE_ONELEVEL: This value is used to indicate searching all entries
one level under the base DN - but not including the base DN and not
including any entries under that one level under the base DN.</p>
</li>
<li>
<p>SCOPE_SUBTREE: This value is used to indicate searching of all entries
at all levels under and including the specified base DN.</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The third line specifies the key name where the user name is stored.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-authen-ldap-user-search.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>For multiple search queries, the proper syntax is: :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
  [
  "OU=Users,DC=northamerica,DC=acme,DC=com",
  "SCOPE_SUBTREE",
  "(sAMAccountName=%(user)s)"
  ],
  [
  "OU=Users,DC=apac,DC=corp,DC=com",
  "SCOPE_SUBTREE",
  "(sAMAccountName=%(user)s)"
  ],
  [
  "OU=Users,DC=emea,DC=corp,DC=com",
  "SCOPE_SUBTREE",
  "(sAMAccountName=%(user)s)"
  ]
]</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="13">
<li>
<p>In the <strong>LDAP Group Search</strong> text field, specify which groups should be
searched and how to search them. In this example, use:</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>[</pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>"dc=example,dc=com", "SCOPE_SUBTREE", "(objectClass=group)" ]</p>
</div>
</blockquote>
</div>
<div class="ulist">
<ul>
<li>
<p>The first line specifies the BASE DN where the groups should be
searched.</p>
</li>
<li>
<p>The second lines specifies the scope and is the same as that for the
user directive.</p>
</li>
<li>
<p>The third line specifies what the <code>objectclass</code> of a group object is
in the LDAP you are using.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-authen-ldap-group-search.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="14">
<li>
<p>Enter the user attributes in the <strong>LDAP User Attribute Map</strong> the text
field. In this example, use:</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>{
"first_name": "givenName",
"last_name": "sn",
"email": "mail"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The above example retrieves users by last name from the key <code>sn</code>. You
can use the same LDAP query for the user to figure out what keys they
are stored under.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-ldap-user-attrb-map.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="15">
<li>
<p>Enter the user profile flags in the <strong>LDAP User Flags by Group</strong> the
text field. In this example, use the following syntax to set LDAP users
as "Superusers" and "Auditors":</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>{
"is_superuser": "cn=superusers,ou=groups,dc=website,dc=com",
"is_system_auditor": "cn=auditors,ou=groups,dc=website,dc=com"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The above example retrieves users who are flagged as superusers or as
auditor in their profile.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-auth-ldap-user-flags.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="16">
<li>
<p>For details on completing the mapping fields, see
<code>ag_ldap_org_team_maps</code>.</p>
</li>
<li>
<p>Click <strong>Save</strong> when done.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With these values entered on this form, you can now make a successful
authentication with LDAP.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The controller does not actively sync users, but they are created during
their initial login. To improve performance associated with LDAP
authentication, see <code>ug_ldap_auth_perf_tips</code> in the Automation
Controller User Guide.</p>
</div>
<div class="sect2">
<h3 id="_referrals"><a class="anchor" href="#_referrals"></a>82.1. Referrals</h3>
<div class="paragraph">
<p>Active Directory uses "referrals" in case the queried object is not
available in its database. It has been noted that this does not work
properly with the django LDAP client and, most of the time, it helps to
disable referrals. Disable LDAP referrals by adding the following lines
to your <code>/etc/tower/conf.d/custom.py</code> file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>AUTH_LDAP_GLOBAL_OPTIONS = {
    ldap.OPT_REFERRALS: False,
}</pre>
</div>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>"Referrals" are disabled by default in automation controller version
2.4.3 and above. If you are running an earlier version of the
controller, you should consider adding this parameter to your
configuration file.</p>
</div>
<div class="paragraph">
<p>For details on completing the mapping fields, see
<code>ag_ldap_org_team_maps</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ldap_logging"><a class="anchor" href="#ldap_logging"></a>82.2. Enabling Logging for LDAP</h3>
<div class="paragraph">
<p>To enable logging for LDAP, you must set the level to <code>DEBUG</code> in the
Settings configuration window:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Settings</strong> from the left navigation pane and click to select
<strong>Logging settings</strong> from the System list of options.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Set the <strong>Logging Aggregator Level Threshold</strong> field to <strong>Debug</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/settings-system-logging-debug.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click <strong>Save</strong> to save your changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ag_ldap_org_team_maps"><a class="anchor" href="#ag_ldap_org_team_maps"></a>82.3. LDAP Organization and Team Mapping</h3>
<div class="paragraph">
<p>Next, you will need to control which users are placed into which
controller organizations based on LDAP attributes (mapping out between
your organization admins/users and LDAP groups).</p>
</div>
<div class="paragraph">
<p>Keys are organization names. Organizations will be created if not
present. Values are dictionaries defining the options for each
organization&#8217;s membership. For each organization, it is possible to
specify what groups are automatically users of the organization and also
what groups can administer the organization.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>admins</strong>: None, True/False, string or list/tuple of strings.</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If <strong>None</strong>, organization admins will not be updated based on LDAP
values.</p>
</li>
<li>
<p>If <strong>True</strong>, all users in LDAP will automatically be added as admins
of the organization.</p>
</li>
<li>
<p>If <strong>False</strong>, no LDAP users will be automatically added as admins of
the organiation.</p>
</li>
<li>
<p>If a string or list of strings, specifies the group DN(s) that will
be added of the organization if they match any of the specified
groups.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>remove_admins</strong>: True/False. Defaults to <strong>False</strong>.</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When <strong>True</strong>, a user who is not an member of the given groups will be
removed from the organization&#8217;s administrative list.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>users</strong>: None, True/False, string or list/tuple of strings. Same rules
apply as for <strong>admins</strong>.</p>
</div>
<div class="paragraph">
<p><strong>remove_users</strong>: True/False. Defaults to <strong>False</strong>. Same rules apply as
<strong>remove_admins</strong>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
"LDAP Organization": {
  "admins": "cn=engineering_admins,ou=groups,dc=example,dc=com",
  "remove_admins": false,
  "users": [
    "cn=engineering,ou=groups,dc=example,dc=com",
    "cn=sales,ou=groups,dc=example,dc=com",
    "cn=it,ou=groups,dc=example,dc=com"
  ],
  "remove_users": false
},
"LDAP Organization 2": {
  "admins": [
    "cn=Administrators,cn=Builtin,dc=example,dc=com"
  ],
  "remove_admins": false,
  "users": true,
  "remove_users": false
}
}</pre>
</div>
</div>
<div class="paragraph">
<p>Mapping between team members (users) and LDAP groups. Keys are team
names (will be created if not present). Values are dictionaries of
options for each team&#8217;s membership, where each can contain the following
parameters:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>organization</strong>: string. The name of the organization to which the team</dt>
<dd>
<p>belongs. The team will be created if the combination of organization
and team name does not exist. The organization will first be created
if it does not exist.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>users</strong>: None, True/False, string or list/tuple of strings.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p>If <strong>None</strong>, team members will not be updated.</p>
</li>
<li>
<p>If <strong>True/False</strong>, all LDAP users will be added/removed as team members.</p>
</li>
<li>
<p>If a string or list of strings, specifies the group DN(s). User will
be added as a team member if the user is a member of ANY of these
groups.</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>remove</strong>: True/False. Defaults to <strong>False</strong>. When <strong>True</strong>, a user who is
not a member of the given groups will be removed from the team.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
"LDAP Engineering": {
  "organization": "LDAP Organization",
  "users": "cn=engineering,ou=groups,dc=example,dc=com",
  "remove": true
},
"LDAP IT": {
  "organization": "LDAP Organization",
  "users": "cn=it,ou=groups,dc=example,dc=com",
  "remove": true
},
"LDAP Sales": {
  "organization": "LDAP Organization",
  "users": "cn=sales,ou=groups,dc=example,dc=com",
  "remove": true
}
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changing_the_default_timeout_for_authentication"><a class="anchor" href="#_changing_the_default_timeout_for_authentication"></a>83. Changing the Default Timeout for Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default length of time, in seconds, that your supplied token is
valid can be changed in the System Settings screen of the controller
user interface:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the Settings
(<span class="image"><img src="images/settings.png" alt="settings"></span>) Menu screen,
click <strong>System</strong>.</p>
</li>
<li>
<p>Select the <strong>Misc. System</strong> tab, if not already the default view.</p>
</li>
<li>
<p>Enter the timeout period in seconds in the <strong>Idle Time Force Log Out</strong>
text field.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-system-timeout.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Click <strong>Save</strong> to apply your changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>If you are accessing the controller directly and are having trouble
getting your authentication to stay, in that you have to keep logging in
over and over, try clearing your web browser&#8217;s cache. In situations like
this, it is often found that the authentication token has been cached in
the browser session and must be cleared.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_authentication_with_kerberos"><a class="anchor" href="#_user_authentication_with_kerberos"></a>84. User Authentication with Kerberos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>User authentication via Active Directory (AD), also referred to as
authentication through Kerberos, is supported through the automation
controller.</p>
</div>
<div class="paragraph">
<p>To get started, first set up the Kerberos packages in the controller
system so that you can successfully generate a Kerberos ticket. To
install the packages, use the following steps:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>yum install krb5-workstation
yum install krb5-devel
yum install krb5-libs</pre>
</div>
</div>
<div class="paragraph">
<p>Once installed, edit the <code>/etc/krb5.conf</code> file, as follows, to provide
the address of the AD, the domain, etc.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[logging]
 default = FILE:/var/log/krb5libs.log
 kdc = FILE:/var/log/krb5kdc.log
 admin_server = FILE:/var/log/kadmind.log

[libdefaults]
 default_realm = WEBSITE.COM
 dns_lookup_realm = false
 dns_lookup_kdc = false
 ticket_lifetime = 24h
 renew_lifetime = 7d
 forwardable = true

[realms]
 WEBSITE.COM = {
  kdc = WIN-SA2TXZOTVMV.website.com
  admin_server = WIN-SA2TXZOTVMV.website.com
 }

[domain_realm]
 .website.com = WEBSITE.COM
 website.com = WEBSITE.COM</pre>
</div>
</div>
<div class="paragraph">
<p>After the configuration file has been updated, you should be able to
successfully authenticate and get a valid token. The following steps
show how to authenticate and get a token:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[root@ip-172-31-26-180 ~]# kinit username
Password for username@WEBSITE.COM:
[root@ip-172-31-26-180 ~]#

Check if we got a valid ticket.

[root@ip-172-31-26-180 ~]# klist
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: username@WEBSITE.COM

Valid starting     Expires            Service principal
01/25/16 11:42:56  01/25/16 21:42:53  krbtgt/WEBSITE.COM@WEBSITE.COM
  renew until 02/01/16 11:42:56
[root@ip-172-31-26-180 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p>Once you have a valid ticket, you can check to ensure that everything is
working as expected from command line. To test this, make sure that your
inventory looks like the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[windows]
win01.WEBSITE.COM

[windows:vars]
ansible_user = username@WEBSITE.COM
ansible_connection = winrm
ansible_port = 5986</pre>
</div>
</div>
<div class="paragraph">
<p>You should also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that the hostname is the proper client hostname matching the
entry in AD and is not the IP address.</p>
</li>
<li>
<p>In the username declaration, ensure that the domain name (the text
after <code>@</code>) is properly entered with regard to upper- and lower-case
letters, as Kerberos is case sensitive. For the controller, you should
also ensure that the inventory looks the same.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>If you encounter a <code>Server not found in Kerberos database</code> error
message, and your inventory is configured using FQDNs (<strong>not IP
addresses</strong>), ensure that the service principal name is not missing or
mis-configured.</p>
</div>
<div class="paragraph">
<p>Now, running a playbook should run as expected. You can test this by
running the playbook as the <code>awx</code> user.</p>
</div>
<div class="paragraph">
<p>Once you have verified that playbooks work properly, integration with
the controller is easy. Generate the Kerberos ticket as the <code>awx</code> user
and the controller should automatically pick up the generated ticket for
authentication.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The python <code>kerberos</code> package must be installed. Ansible is designed to
check if <code>kerberos</code> package is installed and, if so, it uses kerberos
authentication.</p>
</div>
<div class="sect2">
<h3 id="_ad_and_kerberos_credentials"><a class="anchor" href="#_ad_and_kerberos_credentials"></a>84.1. AD and Kerberos Credentials</h3>
<div class="paragraph">
<p>Active Directory only:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are only planning to run playbooks against Windows machines
with AD usernames and passwords as machine credentials, you can use
"user@&lt;domain&gt;" format for the username and an associated password.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With Kerberos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If Kerberos is installed, you can create a machine credential with the
username and password, using the "user@&lt;domain&gt;" format for the
username.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_kerberos_tickets"><a class="anchor" href="#_working_with_kerberos_tickets"></a>84.2. Working with Kerberos Tickets</h3>
<div class="paragraph">
<p>Ansible defaults to automatically managing Kerberos tickets when both
the username and password are specified in the machine credential for a
host that is configured for kerberos. A new ticket is created in a
temporary credential cache for each host, before each task executes (to
minimize the chance of ticket expiration). The temporary credential
caches are deleted after each task, and will not interfere with the
default credential cache.</p>
</div>
<div class="paragraph">
<p>To disable automatic ticket management (e.g., to use an existing SSO
ticket or call <code>kinit</code> manually to populate the default credential
cache), set <code>ansible_winrm_kinit_mode=manual</code> via the inventory.</p>
</div>
<div class="paragraph">
<p>Automatic ticket management requires a standard kinit binary on the
control host system path. To specify a different location or binary
name, set the <code>ansible_winrm_kinit_cmd</code> inventory variable to the
fully-qualified path to an MIT krbv5 kinit-compatible binary.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_session_limits"><a class="anchor" href="#ag_session_limits"></a>85. Working with Session Limits</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Setting a session limit allows administrators to limit the number of
simultaneous sessions per user or per IP address.</p>
</div>
<div class="paragraph">
<p>In automation controller, a session is created for each browser that a
user uses to log in, which forces the user to log out any extra sessions
after they exceed the administrator-defined maximum.</p>
</div>
<div class="paragraph">
<p>Session limits may be important, depending on your particular setup. For
example, perhaps you only want a single user on your system with a
single login per device (where the user could log in on his work laptop,
phone, or home computer). In such a case, you would want to create a
session limit equal to 1 (one). If the user logs in on his laptop, for
example, then logs in using his phone, his laptop session expires (times
out) and only the login on the phone persists.</p>
</div>
<div class="paragraph">
<p>While session counts can be very limited, they can also be expanded to
cover as many session logins as are needed by your organization.</p>
</div>
<div class="paragraph">
<p>When a user logs in and their login results in other users being logged
out, the session limit has been reached and those users who are logged
out are notified as to why the logout occurred.</p>
</div>
<div class="paragraph">
<p>To make changes to your session limits, navigate to the <strong>Miscellaneous
System settings</strong> of the Settings menu and edit the <strong>Maximum Number Of
Simultaneous Logged In Sessions</strong> setting or use the
<code>Browsable API &lt;controllerapi:api_browsable_api&gt;</code> if you are comfortable
with making REST requests.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>To make the best use of session limits, disable <code>AUTH_BASIC_ENABLED</code> by
changing the value to <code>False</code>, as it falls outside of the scope of
session limit enforcement. Alternatively, in the System Settings of the
controller UI, toggle the <strong>Enable HTTP Basic Auth</strong> to off.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-session-limits.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Caution</p>
</div>
<div class="paragraph">
<p>Proactive session limits will kick the user out when the session is
idle. It is strongly recommended that you do not set the session limit
to anything less than 1 minute, as doing so will break your automation
controller instance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_backup_restore"><a class="anchor" href="#ag_backup_restore"></a>86. Backing Up and Restoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ability to backup and restore your system(s) is integrated into the
platform setup playbook. Refer to <code>ag_clustering_backup_restore</code> for
additional considerations.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>When restoring, be sure to restore to the same version from which it was
backed up. However, you should always use the most recent minor version
of a release to backup and/or restore your platform installation
version. For example, if the current platform version you are on is
2.0.x, use only the latest 2.0 installer.</p>
</div>
<div class="paragraph">
<p>Also, backup and restore will <em>only</em> work on PostgreSQL versions
supported by your current platform version. For more information, see
<a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.0-ea/html-single/red_hat_ansible_automation_platform_installation_guide/index?lb_target=production#red_hat_ansible_automation_platform_system_requirements">System
Requirements</a>.</p>
</div>
<div class="paragraph">
<p>The platform setup playbook is invoked as <code>setup.sh</code> from the path where
you unpacked the platform installer tarball. It uses the same inventory
file used by the install playbook. The setup script takes the following
arguments for backing up and restoring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-b</code> Perform a database backup rather than an installation.</p>
</li>
<li>
<p><code>-r</code> Perform a database restore rather than an installation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As the root user, call <code>setup.sh</code> with the appropriate parameters and
the platform backup or restored as configured.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>root@localhost:~# ./setup.sh -b</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>root@localhost:~# ./setup.sh -r</pre>
</div>
</div>
<div class="paragraph">
<p>Backup files will be created on the same path that setup.sh script
exists. It can be changed by specifying the following <code>EXTRA_VARS</code> :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>root@localhost:~# ./setup.sh -e 'backup_dest=/path/to/backup_dir/' -b</pre>
</div>
</div>
<div class="paragraph">
<p>A default restore path is used unless <code>EXTRA_VARS</code> are provided with a
non-default path, as shown in the example below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>root@localhost:~# ./setup.sh -e 'restore_backup_file=/path/to/nondefault/backup.tar.gz' -r</pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, you can override the inventory file used by passing it as an
argument to the setup script:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>setup.sh -i &lt;inventory file&gt;</pre>
</div>
</div>
<div class="sect2">
<h3 id="_backuprestore_playbooks"><a class="anchor" href="#_backuprestore_playbooks"></a>86.1. Backup/Restore Playbooks</h3>
<div class="paragraph">
<p>In addition to the <code>install.yml</code> file included with your <code>setup.sh</code>
setup playbook, there are also <code>backup.yml</code> and <code>restore.yml</code> files for
your backup and restoration needs.</p>
</div>
<div class="paragraph">
<p>These playbooks serve two functions&#8212;&#8203;backup and restore.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The overall backup will backup:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the database</p>
</li>
<li>
<p>the <code>SECRET_KEY</code> file</p>
</li>
</ol>
</div>
</li>
<li>
<p>The per-system backups include:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>custom user config files</p>
</li>
<li>
<p>manual projects</p>
</li>
</ol>
</div>
</li>
<li>
<p>The restore will restore the backed up files and data to a freshly
installed and working second instance of the controller.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When restoring your system, the installer checks to see that the backup
file exists before beginning the restoration. If the backup file is not
available, your restoration will fail.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>Ensure your controller host(s) are properly set up with SSH keys or
user/pass variables in the hosts file, and that the user has sudo
access.</p>
</div>
</div>
<div class="sect2">
<h3 id="_backup_and_restoration_considerations"><a class="anchor" href="#_backup_and_restoration_considerations"></a>86.2. Backup and Restoration Considerations</h3>
<div class="ulist">
<ul>
<li>
<p>Disk Space: Review your disk space requirements to ensure you have
enough room to backup configuration files, keys, and other relevant
files, plus the database of the platform installation.</p>
</li>
<li>
<p>System Credentials: Confirm you have the system credentials you need
when working with a local database or a remote database. On local
systems, you may need root or <code>sudo</code> access, depending on how
credentials were setup. On remote systems, you may need different
credentials to grant you access to the remote system you are trying to
backup or restore.</p>
</li>
<li>
<p>You should always use the most recent minor version of a release to
backup and/or restore your platform installation version. For example,
if the current platform version you are on is 2.0.x, use only the latest
2.0 installer.</p>
</li>
<li>
<p>When using <code>setup.sh</code> to do a restore from the default restore file
path, <code>/var/lib/awx</code>, <code>-r</code> is still required in order to do the restore,
but it no longer accepts an argument. If a non-default restore file path
is needed, the user must provide this as an extra var
(<code>root@localhost:~# ./setup.sh -e 'restore_backup_file=/path/to/nondefault/backup.tar.gz' -r</code>).</p>
</li>
<li>
<p>If the backup file is placed in the same directory as the <code>setup.sh</code>
installer, the restore playbook will automatically locate the restore
files. In this case, you do not need to use the <code>restore_backup_file</code>
extra var to specify the location of the backup file.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ag_clustering_backup_restore"><a class="anchor" href="#ag_clustering_backup_restore"></a>86.3. Backup and Restore for Clustered Environments</h3>
<div class="paragraph">
<p>The procedure for backup and restore for a clustered environment is
similar to a single install, except with some considerations described
in this section.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If restoring to a new cluster, make sure the old cluster is shut down
before proceeding because they could conflict with each other when
accessing the database.</p>
</li>
<li>
<p>Per-node backups will only be restored to nodes bearing the same
hostname as the backup.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When restoring to an existing cluster, the restore contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dump of the PostgreSQL database</p>
</li>
<li>
<p>UI artifacts (included in database dump)</p>
</li>
<li>
<p>Controller configuration (retrieved from <code>/etc/tower</code>)</p>
</li>
<li>
<p>Controller secret key</p>
</li>
<li>
<p>Manual projects</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ag_clustering_backup_restore_diff_cluster"><a class="anchor" href="#ag_clustering_backup_restore_diff_cluster"></a>86.3.1. Restoring to a different cluster</h4>
<div class="paragraph">
<p>When restoring a backup to a separate instance or cluster, manual
projects and custom settings under /etc/tower are retained. Job output
and job events are stored in the database, and therefore, not affected.</p>
</div>
<div class="paragraph">
<p>The restore process will not alter instance groups present before the
restore (neither will it introduce any new instance groups). Restored
controller resources that were associated to instance groups will likely
need to be reassigned to instance groups present on the new controller
cluster.</p>
</div>
<div id="ag_custom_rebranding" class="ulist">
<ul>
<li>
<p>Using Custom Logos in
automation controller<strong><strong></strong><strong></strong></strong><strong><strong></strong><strong></strong></strong><strong><strong></strong><strong></strong></strong><strong><strong></strong><strong></strong></strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unresolved directive in administration/custom_rebranding.adoc - include::logos_branding.adoc[]</p>
</div>
<div id="usability_data_collection" class="paragraph">
<p>Unresolved directive in administration/usability_data_collection.adoc - include::user-data-tracking.adoc[]</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user_data_insights"><a class="anchor" href="#user_data_insights"></a>87. Automation Analytics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you imported your license for the f.adoc[] time, you were given
options related to the collection of data that powers Automation
Analytics, a cloud service that is part of the Ansible Automation
Platform subscription. For opt-in of Automation Analytics to have any
effect, your instance of automation controller <strong>must</strong> be running on Red
Hat Enterprise Linux.</p>
</div>
<div class="paragraph">
<p>Much like Red Hat Insights, Automation Analytics is built to only
collect the minimum amount of data needed. No credential secrets,
personal data, automation variables, or task output is gathered. For
more information, see <a href="#details-of-data-collection">Details of data
collection</a> below.</p>
</div>
<div class="paragraph">
<p>In order to enable this feature, turn on data collection for Automation
Analytics and enter your Red Hat customer credentials in the
<strong>Miscellaneous System settings</strong> of the System configuration list of
options located in the <strong>Settings</strong> menu.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-system-misc-analytics.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Note that the <strong>Automation Analytics Upload URL</strong> field is pre-populated
with the location to which the collection of insights data will be
uploaded.</p>
</div>
<div class="paragraph">
<p>By default, the Automation Analytics data is collected every 4 hours and
upon enabling the feature, data will be collected up to a month back (or
until the previous collection). You may turn off this data collection at
any time in the <strong>Miscellaneous System settings</strong> of the System
configuration window.</p>
</div>
<div class="paragraph">
<p>This setting can also be enabled via the API by specifying
<code>INSIGHTS_TRACKING_STATE = True</code> in either of these endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>api/v2/settings/all</code></p>
</li>
<li>
<p><code>api/v2/settings/system</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Automation Analytics generated from this data collection will be
found on the <a href="">Red Hat Cloud Services</a> portal.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/aa-dashboard.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The <strong>Clusters</strong> data is the default view. This graph represents the
number of job runs across all controller clusters over a period of time.
The example above shows a span of a week in a stacked bar-style chart
that is organized by the number of jobs that ran successfully (in green)
and jobs that failed (in red).</p>
</div>
<div class="paragraph">
<p>Alternatively, you can select a single cluster to view its job status
information.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/aa-job-run-status-over-time-period.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>This multi-line chart represents the number of job runs for a single
controller cluster for a specified period of time. The example here
shows a span of a week, organized by the number of successfully running
jobs (in green) and jobs that failed (in red). You can specify the
number of successful and failed job runs for a selected cluster over a
span of one week, two weeks, and monthly increments.</p>
</div>
<div class="paragraph">
<p>Click <strong>Organization Statistics</strong> from the left navigation pane to view
information for the following:</p>
</div>
<div class="sect2">
<h3 id="_usage_by_organization"><a class="anchor" href="#_usage_by_organization"></a>87.1. Usage by organization</h3>
<div class="paragraph">
<p>This pie chart represents the number of tasks ran inside all jobs by a
particular organization.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/aa-usage-by-org-tasks.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_job_runs_by_organization"><a class="anchor" href="#_job_runs_by_organization"></a>87.2. Job runs by organization</h3>
<div class="paragraph">
<p>This pie chart represents the controller usage across <em>all</em> controller
clusters by organization, which is calculated by the number of jobs run
by that organization.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/aa-usage-by-org.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_organization_status"><a class="anchor" href="#_organization_status"></a>87.3. Organization status</h3>
<div class="paragraph">
<p>This bar chart represents the controller usage by organization and date,
which is calculated by the number of jobs run by that organization on a
particular date. Alternatively, you can specify to show the number of
job runs per organization in one week, two weeks, and monthly
increments.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/aa-usage-by-org-by-date.png" alt="image"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_details_of_data_collection"><a class="anchor" href="#_details_of_data_collection"></a>88. Details of data collection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Automation Analytics collects certain classes of data from automation
controller:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Basic configuration, like which features are enabled, and what
operating system is being used</p>
</li>
<li>
<p>Topology and status of the controller environment and hosts, including
capacity and health</p>
</li>
<li>
<p>Counts of automation resources:</p>
<div class="ulist">
<ul>
<li>
<p>organizations, teams, and users</p>
</li>
<li>
<p>inventories and hosts</p>
</li>
<li>
<p>credentials (indexed by type)</p>
</li>
<li>
<p>projects (indexed by type)</p>
</li>
<li>
<p>templates</p>
</li>
<li>
<p>schedules</p>
</li>
<li>
<p>active sessions</p>
</li>
<li>
<p>running and pending jobs</p>
</li>
</ul>
</div>
</li>
<li>
<p>Job execution details (start time, finish time, launch type, and
success)</p>
</li>
<li>
<p>Automation task details (success, host id, playbook/role, task name,
and module used)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use <code>awx-manage gather_analytics</code> (without <code>--ship</code>) to inspect
the data that the controller sends so you can satisfy your data
collection concerns. This will create a tarball that contains the
analytics data that would be sent to Red Hat.</p>
</div>
<div class="paragraph">
<p>This file contains a number of JSON and CSV files. Each file contains a
different set of analytics data.</p>
</div>
<div class="sect2">
<h3 id="_manifest_json"><a class="anchor" href="#_manifest_json"></a>88.1. manifest.json</h3>
<div class="paragraph">
<p>manifest.json is the manifest of the analytics data. It describes each
file included in the collection, and what version of the schema for that
file is included. An example manifest is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "config.json": "1.1",
  "counts.json": "1.0",
  "cred_type_counts.json": "1.0",
  "events_table.csv": "1.1",
  "instance_info.json": "1.0",
  "inventory_counts.json": "1.2",
  "job_counts.json": "1.0",
  "job_instance_counts.json": "1.0",
  "org_counts.json": "1.0",
  "projects_by_scm_type.json": "1.0",
  "query_info.json": "1.0",
  "unified_job_template_table.csv": "1.0",
  "unified_jobs_table.csv": "1.0",
  "workflow_job_node_table.csv": "1.0",
  "workflow_job_template_node_table.csv": "1.0"
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_config_json"><a class="anchor" href="#_config_json"></a>88.2. config.json</h3>
<div class="paragraph">
<p>The config.json file contains a subset of the configuration endpoint
<code>/api/v2/config</code> from the cluster. An example config.json is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "ansible_version": "2.9.1",
    "authentication_backends": [
        "social_core.backends.azuread.AzureADOAuth2",
        "django.contrib.auth.backends.ModelBackend"
    ],
    "external_logger_enabled": true,
    "external_logger_type": "splunk",
    "free_instances": 1234,
    "install_uuid": "d3d497f7-9d07-43ab-b8de-9d5cc9752b7c",
    "instance_uuid": "bed08c6b-19cc-4a49-bc9e-82c33936e91b",
    "license_expiry": 34937373,
    "license_type": "enterprise",
    "logging_aggregators": [
        "awx",
        "activity_stream",
        "job_events",
        "system_tracking"
    ],
    "pendo_tracking": "detailed",
    "platform": {
        "dist": [
            "redhat",
            "7.4",
            "Maipo"
        ],
        "release": "3.10.0-693.el7.x86_64",
        "system": "Linux",
        "type": "traditional"
    },
    "total_licensed_instances": 2500,
    "controller_url_base": "https://ansible.rhdemo.io",
    "controller_version": "3.6.3"
}</pre>
</div>
</div>
<div class="paragraph">
<p>A reference of fields collected:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ansible_version</dt>
<dd>
<p>The system Ansible version on the host</p>
</dd>
<dt class="hdlist1">authentication_backends</dt>
<dd>
<p>What user authentication backends are available. See <code>ag_social_auth</code>
and <code>ag_auth_ldap</code> for details</p>
</dd>
<dt class="hdlist1">external_logger_enabled</dt>
<dd>
<p>Whether external logging is enaled</p>
</dd>
<dt class="hdlist1">external_logger_type</dt>
<dd>
<p>What logging backend is in use if enabled. See <code>ag_logging</code> for
details</p>
</dd>
<dt class="hdlist1">logging_aggregators</dt>
<dd>
<p>What logging categories are sent to external logging. See <code>ag_logging</code>
for details</p>
</dd>
<dt class="hdlist1">free_instances</dt>
<dd>
<p>How many hosts are available in the license. A value of zero means the
cluster is fully consuming its license.</p>
</dd>
<dt class="hdlist1">install_uuid</dt>
<dd>
<p>A UUID for the installation (identical for all cluster nodes)</p>
</dd>
<dt class="hdlist1">instance_uuid</dt>
<dd>
<p>A UUID for the instance (different for each cluster node)</p>
</dd>
<dt class="hdlist1">license_expiry</dt>
<dd>
<p>Time to expiry of the license, in seconds</p>
</dd>
<dt class="hdlist1">license_type</dt>
<dd>
<p>Type of the license (should be 'enterprise' for most cases)</p>
</dd>
<dt class="hdlist1">pendo_tracking</dt>
<dd>
<p>State of <code>usability_data_collection</code></p>
</dd>
<dt class="hdlist1">platform</dt>
<dd>
<p>The operating system the cluster is running on</p>
</dd>
<dt class="hdlist1">total_licensed_instances</dt>
<dd>
<p>The total number of hosts in the license</p>
</dd>
<dt class="hdlist1">controller_url_base</dt>
<dd>
<p>The base URL for the cluster used by clients (shown in Automation
Analytics)</p>
</dd>
<dt class="hdlist1">controller_version</dt>
<dd>
<p>Version of the software on the cluster</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_instance_info_json"><a class="anchor" href="#_instance_info_json"></a>88.3. instance_info.json</h3>
<div class="paragraph">
<p>The instance_info.json file contains detailed information on the
instances that make up the cluster, organized by instance UUID. An
example instance_info.json is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "bed08c6b-19cc-4a49-bc9e-82c33936e91b": {
        "capacity": 57,
        "cpu": 2,
        "enabled": true,
        "last_isolated_check": "2019-08-15T14:48:58.553005+00:00",
        "managed_by_policy": true,
        "memory": 8201400320,
        "uuid": "bed08c6b-19cc-4a49-bc9e-82c33936e91b",
        "version": "3.6.3"
    }
    "c0a2a215-0e33-419a-92f5-e3a0f59bfaee": {
        "capacity": 57,
        "cpu": 2,
        "enabled": true,
        "last_isolated_check": "2019-08-15T14:48:58.553005+00:00",
        "managed_by_policy": true,
        "memory": 8201400320,
        "uuid": "c0a2a215-0e33-419a-92f5-e3a0f59bfaee",
        "version": "3.6.3"
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>A reference of fields collected:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">capacity</dt>
<dd>
<p>The capacity of the instance for executing tasks. See &lt;link&gt; for
details on how this is calculated.</p>
</dd>
<dt class="hdlist1">cpu</dt>
<dd>
<p>CPU cores for the instance</p>
</dd>
<dt class="hdlist1">memory</dt>
<dd>
<p>Memory for the instance</p>
</dd>
<dt class="hdlist1">enabled</dt>
<dd>
<p>Whether the instance is enabled and accepting tasks</p>
</dd>
<dt class="hdlist1">managed_by_policy</dt>
<dd>
<p>Whether the instance&#8217;s membership in instance groups is managed by
policy, or manually managed</p>
</dd>
<dt class="hdlist1">version</dt>
<dd>
<p>Version of the software on the instance</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_counts_json"><a class="anchor" href="#_counts_json"></a>88.4. counts.json</h3>
<div class="paragraph">
<p>The counts.json file contains the total number of objects for each
relevant category in a cluster. An example counts.json is: :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "active_anonymous_sessions": 1,
    "active_host_count": 682,
    "active_sessions": 2,
    "active_user_sessions": 1,
    "credential": 38,
    "custom_inventory_script": 2,
    "custom_virtualenvs": 4,
    "host": 697,
    "inventories": {
        "normal": 20,
        "smart": 1
    },
    "inventory": 21,
    "job_template": 78,
    "notification_template": 5,
    "organization": 10,
    "pending_jobs": 0,
    "project": 20,
    "running_jobs": 0,
    "schedule": 16,
    "team": 5,
    "unified_job": 7073,
    "user": 28,
    "workflow_job_template": 15
}</pre>
</div>
</div>
<div class="paragraph">
<p>Each entry in this file is for the corresponding API objects in
<code>/api/v2</code>, with the exception of the active session counts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_org_counts_json"><a class="anchor" href="#_org_counts_json"></a>88.5. org_counts.json</h3>
<div class="paragraph">
<p>The org_counts.json file contains information on each organization in
the cluster, and the number of users and teams associated with that
organization. An example org_counts.json is: :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "1": {
        "name": "Operations",
        "teams": 5,
        "users": 17
    },
    "2": {
        "name": "Development",
        "teams": 27,
        "users": 154
    },
    "3": {
        "name": "Networking",
        "teams": 3,
        "users": 28
    }
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cred_type_counts_json"><a class="anchor" href="#_cred_type_counts_json"></a>88.6. cred_type_counts.json</h3>
<div class="paragraph">
<p>The cred_type_counts.json file contains information on the different
credential types in the cluster, and how many credentials exist for each
type. An example cred_type_counts.json is: :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "1": {
        "credential_count": 15,
        "managed_by_controller": true,
        "name": "Machine"
    },
    "2": {
        "credential_count": 2,
        "managed_by_controller": true,
        "name": "Source Control"
    },
    "3": {
        "credential_count": 3,
        "managed_by_controller": true,
        "name": "Vault"
    },
    "4": {
        "credential_count": 0,
        "managed_by_controller": true,
        "name": "Network"
    },
    "5": {
        "credential_count": 6,
        "managed_by_controller": true,
        "name": "Amazon Web Services"
    },
    "6": {
        "credential_count": 0,
        "managed_by_controller": true,
        "name": "OpenStack"
    },
...</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inventory_counts_json"><a class="anchor" href="#_inventory_counts_json"></a>88.7. inventory_counts.json</h3>
<div class="paragraph">
<p>The inventory_counts.json file contains information on the different
inventories in the cluster. An example inventory_counts.json is: :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "1": {
        "hosts": 211,
        "kind": "",
        "name": "AWS Inventory",
        "source_list": [
            {
                "name": "AWS",
                "num_hosts": 211,
                "source": "ec2"
            }
        ],
        "sources": 1
    },
    "2": {
        "hosts": 15,
        "kind": "",
        "name": "Manual inventory",
        "source_list": [],
        "sources": 0
    },
    "3": {
        "hosts": 25,
        "kind": "",
        "name": "SCM inventory - test repo",
        "source_list": [
            {
                "name": "Git source",
                "num_hosts": 25,
                "source": "scm"
            }
        ],
        "sources": 1
    }
    "4": {
        "num_hosts": 5,
        "kind": "smart",
        "name": "Filtered AWS inventory",
        "source_list": [],
        "sources": 0
    }
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_projects_by_scm_type_json"><a class="anchor" href="#_projects_by_scm_type_json"></a>88.8. projects_by_scm_type.json</h3>
<div class="paragraph">
<p>The projects_by_scm_type.json file provides a breakdown of all projects
in the cluster, by source control type. An example
projects_by_scm_type.json is: :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "git": 27,
    "hg": 0,
    "insights": 1,
    "manual": 0,
    "svn": 0
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_query_info_json"><a class="anchor" href="#_query_info_json"></a>88.9. query_info.json</h3>
<div class="paragraph">
<p>The query_info.json file provides details on when and how the data
collection happened. An example query_info.json is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "collection_type": "manual",
    "current_time": "2019-11-22 20:10:27.751267+00:00",
    "last_run": "2019-11-22 20:03:40.361225+00:00"
}</pre>
</div>
</div>
<div class="paragraph">
<p>collection_type is one of "manual" or "automatic".</p>
</div>
</div>
<div class="sect2">
<h3 id="_job_counts_json"><a class="anchor" href="#_job_counts_json"></a>88.10. job_counts.json</h3>
<div class="paragraph">
<p>The job_counts.json file provides details on the job history of the
cluster, describing both how jobs were launched, and what their
finishing status is. An example job_counts.json is: :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "launch_type": {
        "dependency": 3628,
        "manual": 799,
        "relaunch": 6,
        "scheduled": 1286,
        "scm": 6,
        "workflow": 1348
    },
    "status": {
        "canceled": 7,
        "failed": 108,
        "successful": 6958
    },
    "total_jobs": 7073
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_job_instance_counts_json"><a class="anchor" href="#_job_instance_counts_json"></a>88.11. job_instance_counts.json</h3>
<div class="paragraph">
<p>The job_instance_counts.json file provides the same detail as
job_counts.json, broken down by instance. An example
job_instance_counts.json is: :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "localhost": {
        "launch_type": {
            "dependency": 3628,
            "manual": 770,
            "relaunch": 3,
            "scheduled": 1009,
            "scm": 6,
            "workflow": 1336
        },
        "status": {
            "canceled": 2,
            "failed": 60,
            "successful": 6690
        }
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Note that instances in this file are by hostname, not by UUID as they
are in instance_info.</p>
</div>
</div>
<div class="sect2">
<h3 id="_unified_job_template_table_csv"><a class="anchor" href="#_unified_job_template_table_csv"></a>88.12. unified_job_template_table.csv</h3>
<div class="paragraph">
<p>The unified_job_template_table.csv file provides information on job
templates in the system. Each line contains the following fields for the
job template:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">id</dt>
<dd>
<p>Job template id</p>
</dd>
<dt class="hdlist1">name</dt>
<dd>
<p>Job template name</p>
</dd>
<dt class="hdlist1">polymorphic_ctype_id</dt>
<dd>
<p>The id of the type of template it is</p>
</dd>
<dt class="hdlist1">model</dt>
<dd>
<p>The name of the polymorphic_ctype_id for the template. Examples
include 'project', 'systemjobtemplate', 'jobtemplate',
'inventorysource', and 'workflowjobtemplate'</p>
</dd>
<dt class="hdlist1">created</dt>
<dd>
<p>When the template was created</p>
</dd>
<dt class="hdlist1">modified</dt>
<dd>
<p>When the template was last updated</p>
</dd>
<dt class="hdlist1">created_by_id</dt>
<dd>
<p>The userid that created the template. Blank if done by the system.</p>
</dd>
<dt class="hdlist1">modified_by_id</dt>
<dd>
<p>The userid that last modified the template. Blank if done by the
system.</p>
</dd>
<dt class="hdlist1">current_job_id</dt>
<dd>
<p>Currently executing job id for the template, if any</p>
</dd>
<dt class="hdlist1">last_job_id</dt>
<dd>
<p>Last execution of the job</p>
</dd>
<dt class="hdlist1">last_job_run</dt>
<dd>
<p>Time of last execution of the job</p>
</dd>
<dt class="hdlist1">last_job_failed</dt>
<dd>
<p>Whether the last_job_id failed</p>
</dd>
<dt class="hdlist1">status</dt>
<dd>
<p>Status of last_job_id</p>
</dd>
<dt class="hdlist1">next_job_run</dt>
<dd>
<p>Next scheduled execution of the template, if any</p>
</dd>
<dt class="hdlist1">next_schedule_id</dt>
<dd>
<p>Schedule id for next_job_run, if any</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_unified_jobs_table_csv"><a class="anchor" href="#_unified_jobs_table_csv"></a>88.13. unified_jobs_table.csv</h3>
<div class="paragraph">
<p>The unified_jobs_table.csv file provides information on jobs run by the
system. Each line contains the following fields for a job:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">id</dt>
<dd>
<p>Job id</p>
</dd>
<dt class="hdlist1">name</dt>
<dd>
<p>Job name (from the template)</p>
</dd>
<dt class="hdlist1">polymorphic_ctype_id</dt>
<dd>
<p>The id of the type of job it is</p>
</dd>
<dt class="hdlist1">model</dt>
<dd>
<p>The name of the polymorphic_ctype_id for the job. Examples include
'job', 'worfklow', and more.</p>
</dd>
<dt class="hdlist1">organization_id</dt>
<dd>
<p>The organization ID for the job</p>
</dd>
<dt class="hdlist1">organization_name</dt>
<dd>
<p>Name for the organization_id</p>
</dd>
<dt class="hdlist1">created</dt>
<dd>
<p>When the job record was created</p>
</dd>
<dt class="hdlist1">started</dt>
<dd>
<p>When the job started executing</p>
</dd>
<dt class="hdlist1">finished</dt>
<dd>
<p>When the job finished</p>
</dd>
<dt class="hdlist1">elapsed</dt>
<dd>
<p>Elapsed time for the job in seconds</p>
</dd>
<dt class="hdlist1">unified_job_template_id</dt>
<dd>
<p>The template for this job</p>
</dd>
<dt class="hdlist1">launch_type</dt>
<dd>
<p>One of "manual", "scheduled", "relaunched", "scm", "workflow", or
"dependnecy"</p>
</dd>
<dt class="hdlist1">schedule_id</dt>
<dd>
<p>The id of the schedule that launched the job, if any</p>
</dd>
<dt class="hdlist1">instance_group_id</dt>
<dd>
<p>The instance group that executed the job</p>
</dd>
<dt class="hdlist1">execution_node</dt>
<dd>
<p>The node that executed the job (hostname, not UUID)</p>
</dd>
<dt class="hdlist1">controller_node</dt>
<dd>
<p>The controller node for the job, if run as an isolated job, or in a
container group</p>
</dd>
<dt class="hdlist1">cancel_flag</dt>
<dd>
<p>Whether the job was cancelled</p>
</dd>
<dt class="hdlist1">status</dt>
<dd>
<p>Status of the job</p>
</dd>
<dt class="hdlist1">failed</dt>
<dd>
<p>Whether the job failed</p>
</dd>
<dt class="hdlist1">job_explanation</dt>
<dd>
<p>Any additional detail for jobs that failed to execute properly</p>
</dd>
<dt class="hdlist1">forks</dt>
<dd>
<p>Number of forks executed for this job</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_workflow_job_template_node_table_csv"><a class="anchor" href="#_workflow_job_template_node_table_csv"></a>88.14. workflow_job_template_node_table.csv</h3>
<div class="paragraph">
<p>The workflow_job_template_node_table.csv provides information on the
nodes defined in workflow job templates on the system.</p>
</div>
<div class="paragraph">
<p>Each line contains the following fields for a worfklow job template
node:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">id</dt>
<dd>
<p>Node id</p>
</dd>
<dt class="hdlist1">created</dt>
<dd>
<p>When the node was created</p>
</dd>
<dt class="hdlist1">modified</dt>
<dd>
<p>When the node was last updated</p>
</dd>
<dt class="hdlist1">unified_job_template_id</dt>
<dd>
<p>The id of the job template, project, inventory, or other parent
resource for this node</p>
</dd>
<dt class="hdlist1">workflow_job_template_id</dt>
<dd>
<p>The workflow job template that contains this node</p>
</dd>
<dt class="hdlist1">inventory_id</dt>
<dd>
<p>The inventory used by this node</p>
</dd>
<dt class="hdlist1">success_nodes</dt>
<dd>
<p>Nodes that are triggered after this node succeeds</p>
</dd>
<dt class="hdlist1">failure_nodes</dt>
<dd>
<p>Nodes that are triggered after this node fails</p>
</dd>
<dt class="hdlist1">always_nodes</dt>
<dd>
<p>Nodes that always are triggered after this node finishes</p>
</dd>
<dt class="hdlist1">all_parents_must_converge</dt>
<dd>
<p>Whether this node requires all its parent conditions satisfied to
start</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_workflow_job_node_table_csv"><a class="anchor" href="#_workflow_job_node_table_csv"></a>88.15. workflow_job_node_table.csv</h3>
<div class="paragraph">
<p>The workflow_job_node_table.csv provides information on the jobs that
have been executed as part of a workflow on the system.</p>
</div>
<div class="paragraph">
<p>Each line contains the following fields for a job run as part of a
workflow:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">id</dt>
<dd>
<p>Node id</p>
</dd>
<dt class="hdlist1">created</dt>
<dd>
<p>When the node record was created</p>
</dd>
<dt class="hdlist1">modified</dt>
<dd>
<p>When the node record was last updated</p>
</dd>
<dt class="hdlist1">job_id</dt>
<dd>
<p>The job id for the job run for this node</p>
</dd>
<dt class="hdlist1">unified_job_tempalte_id</dt>
<dd>
<p>The id of the job template, project, inventory, or other parent
resource for this job run</p>
</dd>
<dt class="hdlist1">workflow_job_id</dt>
<dd>
<p>The parent workflow job for this job run</p>
</dd>
<dt class="hdlist1">inventory_id</dt>
<dd>
<p>The inventory used by this job</p>
</dd>
<dt class="hdlist1">success_nodes</dt>
<dd>
<p>Nodes that were/would be triggered after this node succeded</p>
</dd>
<dt class="hdlist1">failure_nodes</dt>
<dd>
<p>Nodes that were/would be triggered after this node failed</p>
</dd>
<dt class="hdlist1">always_nodes</dt>
<dd>
<p>Nodes that were/would be triggered after this node finished</p>
</dd>
<dt class="hdlist1">do_not_run</dt>
<dd>
<p>Nodes that were not run in the workflow due to their start conditions
not being triggered</p>
</dd>
<dt class="hdlist1">all_parents_must_converge</dt>
<dd>
<p>Whether this node required all its parent conditions satisfied to
start</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_events_table_csv"><a class="anchor" href="#_events_table_csv"></a>88.16. events_table.csv</h3>
<div class="paragraph">
<p>The events_table.csv file provides information on all job events from
all job runs in the system. Each line contains the following fields for
a job event:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">id</dt>
<dd>
<p>Event id</p>
</dd>
<dt class="hdlist1">uuid</dt>
<dd>
<p>Event UUID</p>
</dd>
<dt class="hdlist1">created</dt>
<dd>
<p>When the event was created</p>
</dd>
<dt class="hdlist1">parent_uuid</dt>
<dd>
<p>The parent UUID for this event, if any</p>
</dd>
<dt class="hdlist1">event</dt>
<dd>
<p>The Ansible event type (such as runner_on_failed</p>
</dd>
<dt class="hdlist1">task_action</dt>
<dd>
<p>The module associated with this event, if any (such as 'command' or
'yum')</p>
</dd>
<dt class="hdlist1">failed</dt>
<dd>
<p>Whether the event returned "failed"</p>
</dd>
<dt class="hdlist1">changed</dt>
<dd>
<p>Whether the event returned "changed"</p>
</dd>
<dt class="hdlist1">playbook</dt>
<dd>
<p>Playbook associated with the event</p>
</dd>
<dt class="hdlist1">play</dt>
<dd>
<p>Play name from playbook</p>
</dd>
<dt class="hdlist1">task</dt>
<dd>
<p>Task name from playbook</p>
</dd>
<dt class="hdlist1">role</dt>
<dd>
<p>Role name from playbook</p>
</dd>
<dt class="hdlist1">job_id</dt>
<dd>
<p>Id of the job this event is from</p>
</dd>
<dt class="hdlist1">host_id</dt>
<dd>
<p>Id of the host this event is associated with, if any</p>
</dd>
<dt class="hdlist1">host_name</dt>
<dd>
<p>Name of the host this event is associated with, if any</p>
</dd>
<dt class="hdlist1">start</dt>
<dd>
<p>Start time of the task</p>
</dd>
<dt class="hdlist1">end</dt>
<dd>
<p>End time of the task</p>
</dd>
<dt class="hdlist1">duration</dt>
<dd>
<p>Duration of the task</p>
</dd>
<dt class="hdlist1">warnings</dt>
<dd>
<p>Any warnings from the task/module</p>
</dd>
<dt class="hdlist1">deprecations</dt>
<dd>
<p>Any deprecation warnings from the task/module</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="admin_troubleshooting"><a class="anchor" href="#admin_troubleshooting"></a>89. Troubleshooting the controller</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_error_logs"><a class="anchor" href="#_error_logs"></a>89.1. Error logs</h3>
<div class="paragraph">
<p>The controller server errors are logged in <code>/var/log/tower</code>. Supervisors
logs can be found in <code>/var/log/supervisor/</code>. Nginx web server errors are
logged in the httpd error log. Configure other controller logging needs
in <code>/etc/tower/conf.d/</code>.</p>
</div>
<div class="paragraph">
<p>Explore client-side issues using the JavaScript console built into most
browsers and report any errors to Ansible via the Red Hat Customer
portal at <a href="https://access.redhat.com/" class="bare">https://access.redhat.com/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="admin_troubleshooting_sosreport"><a class="anchor" href="#admin_troubleshooting_sosreport"></a>89.2. sosreport</h3>
<div class="paragraph">
<p>The <code>sosreport</code> is a utility that collects diagnostic information for
Support to be able to use to analyze and investigate the issues you
report. To properly provide Technical Support this information, refer to
the <a href="https://access.redhat.com/solutions/3592">Knowledgebase article for
sosreport</a> from the Red Hat Customer portal to perform the following
procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://access.redhat.com/solutions/3592#install">Install the
sosreport</a> utility.</p>
</li>
<li>
<p><a href="https://access.redhat.com/solutions/3592#command">Generate an
sosreport</a>.</p>
</li>
<li>
<p>Provide the sosreport to Red Hat Support.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_problems_connecting_to_your_host"><a class="anchor" href="#_problems_connecting_to_your_host"></a>89.3. Problems connecting to your host</h3>
<div class="paragraph">
<p>If you are unable to run the <code>helloworld.yml</code> example playbook from the
Quick Start Guide or other playbooks due to host connection errors, try
the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Can you <code>ssh</code> to your host? Ansible depends on SSH access to the
servers you are managing.</p>
</li>
<li>
<p>Are your hostnames and IPs correctly added in your inventory file?
(Check for typos.)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unable_to_login_to_the_controller_via_http"><a class="anchor" href="#_unable_to_login_to_the_controller_via_http"></a>89.4. Unable to login to the controller via HTTP</h3>
<div class="paragraph">
<p>Access to the controller is intentionally restricted through a secure
protocol (HTTPS). In cases where your configuration is set up to run a
controller node behind a load balancer or proxy as "HTTP only", and you
only want to access it without SSL (for troubleshooting, for example),
you must add the following settings in the <code>custom.py</code> file located at
<code>/etc/tower/conf.d</code> of your controller instance:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SESSION_COOKIE_SECURE = False
CSRF_COOKIE_SECURE = False</pre>
</div>
</div>
<div class="paragraph">
<p>Changing these settings to <code>False</code> will allow the controller to manage
cookies and login sessions when using the HTTP protocol. This must be
done on every node of a cluster installation to properly take effect.</p>
</div>
<div class="paragraph">
<p>To apply the changes, run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>automation-controller-service restart</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_websockets_port_for_live_events_not_working"><a class="anchor" href="#_websockets_port_for_live_events_not_working"></a>89.5. WebSockets port for live events not working</h3>
<div class="paragraph">
<p>automation controller uses port 80/443 on the controller server to
stream live updates of playbook activity and other events to the client
browser. These ports are configured for 80/443 by default, but if they
are blocked by firewalls, close any firewall rules that opened up or
added for the previous websocket ports, this will ensure your firewall
allows traffic through this port.</p>
</div>
</div>
<div class="sect2">
<h3 id="_problems_running_a_playbook"><a class="anchor" href="#_problems_running_a_playbook"></a>89.6. Problems running a playbook</h3>
<div class="paragraph">
<p>If you are unable to run the <code>helloworld.yml</code> example playbook from the
Quick Start Guide or other playbooks due to playbook errors, try the
following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Are you authenticating with the user currently running the commands?
If not, check how the username has been setup or pass the
<code>--user=username</code> or <code>-u username</code> commands to specify a user.</p>
</li>
<li>
<p>Is your YAML file correctly indented? You may need to line up your
whitespace correctly. Indentation level is significant in YAML. You can
use <code>yamlint</code> to check your playbook. For more information, refer to the
YAML primer at: <a href="http://docs.ansible.com/YAMLSyntax.html" class="bare">http://docs.ansible.com/YAMLSyntax.html</a></p>
</li>
<li>
<p>Items beginning with a <code>-</code> are considered list items or plays. Items
with the format of <code>key: value</code> operate as hashes or dictionaries.
Ensure you don&#8217;t have extra or missing <code>-</code> plays.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_problems_when_running_a_job"><a class="anchor" href="#_problems_when_running_a_job"></a>89.7. Problems when running a job</h3>
<div class="paragraph">
<p>If you are having trouble running a job from a playbook, you should
review the playbook YAML file. When importing a playbook, either
manually or via a source control mechanism, keep in mind that the host
definition is controlled by the controller and should be set to
<code>hosts: all</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_playbooks_arent_showing_up_in_the_job_template_drop_down"><a class="anchor" href="#_playbooks_arent_showing_up_in_the_job_template_drop_down"></a>89.8. Playbooks aren&#8217;t showing up in the "Job Template" drop-down</h3>
<div class="paragraph">
<p>If your playbooks are not showing up in the Job Template drop-down list,
here are a few things you can check:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure that the playbook is valid YML and can be parsed by Ansible.</p>
</li>
<li>
<p>Make sure the permissions and ownership of the project path
(/var/lib/awx/projects) is set up so that the "awx" system user can view
the files. You can run this command to change the ownership:</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>chown awx -R /var/lib/awx/projects/</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_playbook_stays_in_pending"><a class="anchor" href="#_playbook_stays_in_pending"></a>89.9. Playbook stays in pending</h3>
<div class="paragraph">
<p>If you are attempting to run a playbook Job and it stays in the
"Pending" state indefinitely, try the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure all supervisor services are running via <code>supervisorctl status</code>.</p>
</li>
<li>
<p>Check to ensure that the <code>/var/</code> partition has more than 1 GB of space
available. Jobs will not complete with insufficient space on the <code>/var/</code>
partition.</p>
</li>
<li>
<p>Run <code>automation-controller-service restart</code> on the controller server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you continue to have problems, run <code>sosreport</code> as root on the
controller server, then file a <a href="http://support.ansible.com/">support
request</a> with the result.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cancel_a_controller_job"><a class="anchor" href="#_cancel_a_controller_job"></a>89.10. Cancel a controller job</h3>
<div class="paragraph">
<p>When issuing a <code>cancel</code> request on a currently running controller job,
the controller issues a <code>SIGINT</code> to the <code>ansible-playbook</code> process.
While this causes Ansible to stop dispatching new tasks and exit, in
many cases, module tasks that were already dispatched to remote hosts
will run to completion. This behavior is similar to pressing <code>Ctrl-C</code>
during a command-line Ansible run.</p>
</div>
<div class="paragraph">
<p>With respect to software dependencies, if a running job is canceled, the
job is essentially removed but the dependencies will remain.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reusing_an_external_database_causes_installations_to_fail"><a class="anchor" href="#_reusing_an_external_database_causes_installations_to_fail"></a>89.11. Reusing an external database causes installations to fail</h3>
<div class="paragraph">
<p>Instances have been reported where reusing the external DB during
subsequent installation of nodes causes installation failures.</p>
</div>
<div class="paragraph">
<p>For example, say that you performed a clustered installation. Next, say
that you needed to do this again and performed a second clustered
installation reusing the same external database, only this subsequent
installation failed.</p>
</div>
<div class="paragraph">
<p>When setting up an external database which has been used in a prior
installation, the database used for the clustered node must be manually
cleared before any additional installations can succeed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>90. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>91. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>92. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>93. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>94. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>95. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>96. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>97. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>98. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>99. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>100. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>101. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>102. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>103. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>104. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>105. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>106. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>107. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>108. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>109. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>110. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>111. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>112. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>113. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>114. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>115. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>116. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>117. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>118. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>119. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>120. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>121. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>122. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>123. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>124. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>125. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>126. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>127. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>128. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>129. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>130. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>131. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>132. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>133. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>134. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>135. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>136. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>137. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>138. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>139. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>140. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>141. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>142. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>143. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>144. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>145. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>146. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>147. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>148. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>149. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>150. Isolation functionality and variables</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="ag_isolation_variables"><a class="anchor" href="#ag_isolation_variables"></a>151. Isolation functionality and variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>include::isolation_variables.adoc[]</p>
</div>
<div class="sect2">
<h3 id="_private_ec2_vpc_instances_in_the_controller_inventory"><a class="anchor" href="#_private_ec2_vpc_instances_in_the_controller_inventory"></a>151.1. Private EC2 VPC Instances in the controller Inventory</h3>
<div class="paragraph">
<p>By default, the controller only shows instances in a VPC that have an
Elastic IP (EIP) associated with them. To see all of your VPC instances,
perform the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the controller interface, select your inventory.</p>
</li>
<li>
<p>Click on the group that has the Source set to AWS, and click on the
Source tab.</p>
</li>
<li>
<p>In the <code>Source Variables</code> box, enter:</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>vpc_destination_variable: private_ip_address</pre>
</div>
</div>
<div class="paragraph">
<p>Next, save and then trigger an update of the group. Once this is done,
you should be able to see all of your VPC instances.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The controller must be running inside the VPC with access to those
instances if you want to configure them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_error_provided_hosts_list_is_empty"><a class="anchor" href="#_troubleshooting_error_provided_hosts_list_is_empty"></a>151.2. Troubleshooting "Error: provided hosts list is empty"</h3>
<div class="paragraph">
<p>If you receive the message "Skipping: No Hosts Matched" when you are
trying to run a playbook through the controller, here are a few things
to check:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure that your hosts declaration line in your playbook matches
the name of your group/host in inventory exactly (these are case
sensitive).</p>
</li>
<li>
<p>If it does match and you are using Ansible Core 2.0 or later, check
your group names for spaces and modify them to use underscores or no
spaces to ensure that the groups can be recognized.</p>
</li>
<li>
<p>Make sure that if you have specified a Limit in the Job Template that
it is a valid limit value and still matches something in your inventory.
The Limit field takes a pattern argument, described here:
<a href="http://docs.ansible.com/intro_patterns.html" class="bare">http://docs.ansible.com/intro_patterns.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please file a support ticket if you still run into issues after checking
these options.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tips_and_tricks"><a class="anchor" href="#tips_and_tricks"></a>152. Controller Tips and Tricks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_using_the_controller_cli_tool"><a class="anchor" href="#_using_the_controller_cli_tool"></a>152.1. Using the Controller CLI Tool</h3>
<div class="paragraph">
<p>Automation controller has a full-featured command line interface. Refer
to <a href="">AWX Command Line Interface</a> documentation for configuration and
usage instructions.</p>
</div>
</div>
<div class="sect2">
<h3 id="tips_change_password"><a class="anchor" href="#tips_change_password"></a>152.2. Changing the Controller Admin Password</h3>
<div class="paragraph">
<p>During the installation process, you are prompted to enter an
administrator password which is used for the <code>admin</code> superuser/first
user created in the controller. If you log into the instance via SSH, it
will tell you the default admin password in the prompt. If you need to
change this password at any point, run the following command as root on
the controller server:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>awx-manage changepassword admin</pre>
</div>
</div>
<div class="paragraph">
<p>Next, enter a new password. After that, the password you have entered
will work as the admin password in the web UI.</p>
</div>
<div class="paragraph">
<p>To set policies at creation time for password validation using Django,
see <code>ag_security_django_password</code> for detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_controller_admin_from_the_commandline"><a class="anchor" href="#_creating_a_controller_admin_from_the_commandline"></a>152.3. Creating a controller Admin from the commandline</h3>
<div class="paragraph">
<p>Once in a while you may find it helpful to create an admin (superuser)
account from the commandline. To create an admin, run the following
command as root on the controller server and enter in the admin
information as prompted:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>awx-manage createsuperuser</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_a_jump_host_to_use_with_the_controller"><a class="anchor" href="#_setting_up_a_jump_host_to_use_with_the_controller"></a>152.4. Setting up a jump host to use with the controller</h3>
<div class="paragraph">
<p>Credentials supplied by the controller will not flow to the jump host
via ProxyCommand. They are only used for the end-node once the tunneled
connection is set up.</p>
</div>
<div class="paragraph">
<p>To make this work, configure a fixed user/keyfile in the AWX user&#8217;s SSH
config in the ProxyCommand definition that sets up the connection
through the jump host. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Host tampa
Hostname 10.100.100.11
IdentityFile [privatekeyfile]

Host 10.100..
Proxycommand ssh -W [jumphostuser]@%h:%p tampa</pre>
</div>
</div>
<div class="paragraph">
<p>You can also add a jump host to your controller instance through
Inventory variables. These variables can be set at either the inventory,
group, or host level. To add this, navigate to your inventory and in the
<code>variables</code> field of whichever level you choose, add the following
variables:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ansible_user: &lt;user_name&gt;
ansible_connection: ssh
ansible_ssh_common_args: '-o ProxyCommand="ssh -W %h:%p -q &lt;user_name&gt;@&lt;jump_server_name&gt;"'</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_view_ansible_outputs_for_json_commands_when_using_the_controller"><a class="anchor" href="#_view_ansible_outputs_for_json_commands_when_using_the_controller"></a>152.5. View Ansible outputs for JSON commands when using the controller</h3>
<div class="paragraph">
<p>When working with automation controller, you can use the API to obtain
the Ansible outputs for commands in JSON format.</p>
</div>
<div class="paragraph">
<p>To view the Ansible outputs, browse to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>https://&lt;controller server name&gt;/api/v2/jobs/&lt;job_id&gt;/job_events/</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_locate_and_configure_the_ansible_configuration_file"><a class="anchor" href="#_locate_and_configure_the_ansible_configuration_file"></a>152.6. Locate and configure the Ansible configuration file</h3>
<div class="paragraph">
<p>While Ansible does not require a configuration file, OS packages often
include a default one in <code>/etc/ansible/ansible.cfg</code> for possible
customization. In order to use a custom <code>ansible.cfg</code> file, place it at
the root of your project. Automation controller runs <code>ansible-playbook</code>
from the root of the project directory, where it will then find the
custom <code>ansible.cfg</code> file. An <code>ansible.cfg</code> anywhere else in the project
will be ignored.</p>
</div>
<div class="paragraph">
<p>To learn which values you can use in this file, refer to the
<a href="https://github.com/ansible/ansible/blob/devel/examples/ansible.cfg">configuration
file on github</a>.</p>
</div>
<div class="paragraph">
<p>Using the defaults are acceptable for starting out, but know that you
can configure the default module path or connection type here, as well
as other things.</p>
</div>
<div class="paragraph">
<p>The controller overrides some ansible.cfg options. For example, the
controller stores the SSH ControlMaster sockets, the SSH agent socket,
and any other per-job run items in a per-job temporary directory that is
passed to the container used for job execution.</p>
</div>
</div>
<div class="sect2">
<h3 id="_view_a_listing_of_all_ansible_variables"><a class="anchor" href="#_view_a_listing_of_all_ansible_variables"></a>152.7. View a listing of all ansible_ variables</h3>
<div class="paragraph">
<p>Ansible by default gathers “facts” about the machines under its
management, accessible in Playbooks and in templates. To view all facts
available about a machine, run the <code>setup</code> module as an ad hoc action:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ansible -m setup hostname</pre>
</div>
</div>
<div class="paragraph">
<p>This prints out a dictionary of all facts available for that particular
host. For more information, refer to:
<a href="https://docs.ansible.com/ansible/playbooks_variables.html#information-discovered-from-systems-facts" class="bare">https://docs.ansible.com/ansible/playbooks_variables.html#information-discovered-from-systems-facts</a></p>
</div>
</div>
<div class="sect2">
<h3 id="ag_tips_jinja_extravars"><a class="anchor" href="#ag_tips_jinja_extravars"></a>152.8. The ALLOW_JINJA_IN_EXTRA_VARS variable</h3>
<div class="paragraph">
<p>Setting <code>ALLOW_JINJA_IN_EXTRA_VARS = template</code> only works for saved job
template extra variables. Prompted variables and survey variables are
excluded from the 'template'. This parameter has three values:
<code>template</code> to allow usage of Jinja saved directly on a job template
definition (the default), <code>never</code> to disable all Jinja usage
(recommended), and <code>always</code> to always allow Jinja (strongly discouraged,
but an option for prior compatibility).</p>
</div>
<div class="paragraph">
<p>This parameter is configurable in the Jobs Settings screen of the
controller UI:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/settings-jobs-jinja.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Using execution environments =============</p>
</div>
<div class="paragraph">
<p>See <code>ug_execution_environments</code> in the Automation Controller User Guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_controllerhost_hostname_for_notifications"><a class="anchor" href="#_configuring_the_controllerhost_hostname_for_notifications"></a>152.9. Configuring the <code>controllerhost</code> hostname for notifications</h3>
<div class="paragraph">
<p>In the <code>System Settings &lt;configure_tower_system&gt;</code>, you can replace
<code><a href="https://controller.example.com" class="bare">https://controller.example.com</a></code> in the <strong>Base URL of The Controller
Host</strong> field with your preferred hostname to change the notification
hostname.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-system-misc-baseurl.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Refreshing your controller license also changes the notification
hostname. New installations of automation controller should not have to
set the hostname for notifications.</p>
</div>
</div>
<div class="sect2">
<h3 id="launch_jobs_curl"><a class="anchor" href="#launch_jobs_curl"></a>152.10. Launching Jobs with curl</h3>
<div class="paragraph">
<p>Launching jobs with the controller API is simple. Here are some easy to
follow examples using the <code>curl</code> tool.</p>
</div>
<div class="paragraph">
<p>Assuming that your Job Template ID is '1', your controller IP is
192.168.42.100, and that <code>admin</code> and <code>awxsecret</code> are valid login
credentials, you can create a new job this way:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -f -k -H 'Content-Type: application/json' -XPOST \
    --user admin:awxsecret \
    http://192.168.42.100/api/v2/job_templates/1/launch/</pre>
</div>
</div>
<div class="paragraph">
<p>This returns a JSON object that you can parse and use to extract the
'id' field, which is the ID of the newly created job.</p>
</div>
<div class="paragraph">
<p>You can also pass extra variables to the Job Template call, such as is
shown in the following example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -f -k -H 'Content-Type: application/json' -XPOST \
    -d '{"extra_vars": "{\"foo\": \"bar\"}"}' \
    --user admin:awxsecret http://192.168.42.100/api/v2/job_templates/1/launch/</pre>
</div>
</div>
<div class="paragraph">
<p>You can view the live API documentation by logging into
<a href="http://192.168.42.100/api/" class="bare">http://192.168.42.100/api/</a> and browsing around to the various objects
available.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The <code>extra_vars</code> parameter needs to be a string which contains JSON, not
just a JSON dictionary, as you might expect. Use caution when escaping
the quotes, etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_inventory_and_private_ip_addresses"><a class="anchor" href="#_dynamic_inventory_and_private_ip_addresses"></a>152.11. Dynamic Inventory and private IP addresses</h3>
<div class="paragraph">
<p>By default, the controller only shows instances in a VPC that have an
Elastic IP (EIP) address associated with them. To view all of your VPC
instances, perform the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the controller interface, select your inventory.</p>
</li>
<li>
<p>Click on the group that has the Source set to AWS, and click on the
Source tab.</p>
</li>
<li>
<p>In the "Source Variables" box, enter:
<code>vpc_destination_variable: private_ip_address</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Save and trigger an update of the group. You should now be able to see
all of your VPC instances.</p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>The controller must be running inside the VPC with access to those
instances in order to usefully configure them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_filtering_instances_returned_by_the_dynamic_inventory_sources_in_the_controller"><a class="anchor" href="#_filtering_instances_returned_by_the_dynamic_inventory_sources_in_the_controller"></a>152.12. Filtering instances returned by the dynamic inventory sources in the controller</h3>
<div class="paragraph">
<p>By default, the dynamic inventory sources in the controller (AWS,
Google, etc) return all instances available to the cloud credentials
being used. They are automatically joined into groups based on various
attributes. For example, AWS instances are grouped by region, by tag
name and value, by security groups, etc. To target specific instances in
your environment, write your playbooks so that they target the generated
group names. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>---
- hosts: tag_Name_webserver
  tasks:
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>Limit</code> field in the Job Template settings to limit
a playbook run to a certain group, groups, hosts, or a combination
thereof. The syntax is the same as the <code>--limit parameter</code> on the
ansible-playbook command line.</p>
</div>
<div class="paragraph">
<p>You may also create your own groups by copying the auto-generated groups
into your custom groups. Make sure that the <code>Overwrite</code> option is
disabled on your dynamic inventory source, otherwise subsequent
synchronization operations will delete and replace your custom groups.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_an_unreleased_module_from_ansible_source_with_the_controller"><a class="anchor" href="#_using_an_unreleased_module_from_ansible_source_with_the_controller"></a>152.13. Using an unreleased module from Ansible source with the controller</h3>
<div class="paragraph">
<p>If there is a feature that is available in the latest Ansible core
branch that you would like to leverage with your controller system,
making use of it in the controller is fairly simple.</p>
</div>
<div class="paragraph">
<p>First, determine which is the updated module you want to use from the
available Ansible Core Modules or Ansible Extra Modules GitHub
repositories.</p>
</div>
<div class="paragraph">
<p>Next, create a new directory, at the same directory level of your
Ansible source playbooks, named <code>/library</code>.</p>
</div>
<div class="paragraph">
<p>Once this is created, copy the module you want to use and drop it into
the <code>/library</code> directory&#8212;&#8203;it will be consumed first over your system
modules and can be removed once you have updated the the stable version
via your normal package manager.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_callback_plugins_with_the_controller"><a class="anchor" href="#_using_callback_plugins_with_the_controller"></a>152.14. Using callback plugins with the controller</h3>
<div class="paragraph">
<p>Ansible has a flexible method of handling actions during playbook runs,
called callback plugins. You can use these plugins with the controller
to do things like notify services upon playbook runs or failures, send
emails after every playbook run, etc. For official documentation on the
callback plugin architecture, refer to:
<a href="http://docs.ansible.com/developing_plugins.html#callbacks" class="bare">http://docs.ansible.com/developing_plugins.html#callbacks</a></p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>automation controller does not support the <code>stdout</code> callback plugin
because Ansible only allows one, and it is already being used by
automation controller for streaming event data.</p>
</div>
<div class="paragraph">
<p>You may also want to review some example plugins, which should be
modified for site-specific purposes, such as those available at:
<a href="https://github.com/ansible/ansible/tree/devel/lib/ansible/plugins/callback" class="bare">https://github.com/ansible/ansible/tree/devel/lib/ansible/plugins/callback</a></p>
</div>
<div class="paragraph">
<p>To use these plugins, put the callback plugin <code>.py</code> file into a
directory called <code>/callback_plugins</code> alongside your playbook in your
controller Project. Then, specify their paths (one path per line) in the
<strong>Ansible Callback Plugins</strong> field of the Job settings, located towards
the bottom of the screen:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/configure-tower-jobs-callback.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Note</p>
</div>
<div class="paragraph">
<p>To have most callbacks shipped with Ansible applied globally, you must
add them to the <code>callback_whitelist</code> section of your <code>ansible.cfg</code>. If
you have a custom callbacks, refer to the Ansible documentation for
<a href="https://docs.ansible.com/ansible/latest/plugins/callback.html#enabling-callback-plugins">Enabling
callback plugins</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_to_windows_with_winrm"><a class="anchor" href="#_connecting_to_windows_with_winrm"></a>152.15. Connecting to Windows with winrm</h3>
<div class="paragraph">
<p>By default controller attempts to <code>ssh</code> to hosts. You must add the
<code>winrm</code> connection info to the group variables to which the Windows
hosts belong. To get started, edit the Windows group in which the hosts
reside and place the variables in the source/edit screen for the group.</p>
</div>
<div class="paragraph">
<p>To add <code>winrm</code> connection info:</p>
</div>
<div class="paragraph">
<p>Edit the properties for the selected group by clicking on the
<span class="image"><img src="images/edit-button.png" alt="edit"></span> button to the
right of the group name that contains the Windows servers. In the
"variables" section, add your connection information as such:
<code>ansible_connection: winrm</code></p>
</div>
<div class="paragraph">
<p>Once done, save your edits. If Ansible was previously attempting an SSH
connection and failed, you should re-run the job template.</p>
</div>
</div>
<div class="sect2">
<h3 id="_importing_existing_inventory_files_and_hostgroup_vars_into_the_controller"><a class="anchor" href="#_importing_existing_inventory_files_and_hostgroup_vars_into_the_controller"></a>152.16. Importing existing inventory files and host/group vars into the controller</h3>
<div class="paragraph">
<p>To import an existing static inventory and the accompanying host and
group vars into the controller, your inventory should be in a structure
that looks similar to the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>inventory/
|-- group_vars
|   `-- mygroup
|-- host_vars
|   `-- myhost
`-- hosts</pre>
</div>
</div>
<div class="paragraph">
<p>To import these hosts and vars, run the <code>awx-manage</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>awx-manage inventory_import --source=inventory/ \
  --inventory-name="My Controller Inventory"</pre>
</div>
</div>
<div class="paragraph">
<p>If you only have a single flat file of inventory, a file called
ansible-hosts, for example, import it like the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>awx-manage inventory_import --source=./ansible-hosts \
  --inventory-name="My Controller Inventory"</pre>
</div>
</div>
<div class="paragraph">
<p>In case of conflicts or to overwrite an inventory named "My Controller
Inventory", run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>awx-manage inventory_import --source=inventory/ \
  --inventory-name="My Controller Inventory" \
  --overwrite --overwrite-vars</pre>
</div>
</div>
<div class="paragraph">
<p>If you receive an error, such as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ValueError: need more than 1 value to unpack</pre>
</div>
</div>
<div class="paragraph">
<p>Create a directory to hold the hosts file, as well as the group_vars:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mkdir -p inventory-directory/group_vars</pre>
</div>
</div>
<div class="paragraph">
<p>Then, for each of the groups that have :vars listed, create a file
called <code>inventory-directory/group_vars/&lt;groupname&gt;</code> and format the
variables in YAML format.</p>
</div>
<div class="paragraph">
<p>Once broken out, the importer will handle the conversion correctly.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-09-22 14:37:30 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>