[id="ref-gcp-run-restore-command"]

= Running the restore command

When `restore.yml` is populated, you can use the command generator to create the restore command.

.Procedure
. Run the command generator.
+
[NOTE]
====
As `/tmp` is used, the `<local_data_file_directory>` must be set to `/tmp` unless you chose a different location for `restore.yml`.
====
+
[literal, options="nowrap" subs="+quotes,attributes"]
----
$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_restore_deployment --data-file /data/restore.yml
----
+
This generates a new command containing all needed volumes, environment variables and parameters.
+
The generated command resembles the following:
+
[literal, options="nowrap" subs="+quotes,attributes"]
----
docker run --rm --env PLATFORM=GCP -v <local_credential_file>:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=<deployment_name> --env GENERATE_INVENTORY=true -\
-env CHECK_GENERATED_INVENTORY=false  $IMAGE redhat.ansible_on_clouds.gcp_restore_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=<deployment_name> gcp_compute_region=<region> gcp_compute_zone=u<zone> \
gcp_bucket_backup_name=<bucket> backup_name=<backup_name>'
----
. Run the generated command.
+
[literal, options="nowrap" subs="+quotes,attributes"]
----
$ docker run --rm --env PLATFORM=GCP -v <local_credential_file>:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE redhat.ansible_on_clouds.gcp_restore_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=<former_deployment_name> gcp_restored_deployment_name=<new_deployment_name> \
gcp_compute_region=<region> gcp_compute_zone=<zone> gcp_bucket_backup_name=<bucket> gcp_existing_vpc=False'
----
. When the playbook has completed, the output resembles the following:
+
[literal, options="nowrap" subs="+quotes,attributes"]
----
TASK [redhat.ansible_on_clouds.standalone_gcp_restore : Display internal IP addresses] ***
ok: [localhost] =>
  msg:
  - 'Hub        internal IP: 192.168.240.21'
  - 'Controller internal IP: 192.168.240.20'

PLAY RECAP *********************************************************************
localhost                  : ok=33   changed=8    unreachable=0    failed=0    skipped=6    rescued=0    ignored=2
----
+

= Troubleshooting

== Failed to restore

If a message similar to this one appears during the restore, please contact the support as the restore must be done manually.

[literal, options="nowrap" subs="+quotes,attributes"]
----
TASK [redhat.ansible_on_clouds.standalone_gcp_restore : [restore_deployment] Restore awx db] ***
fatal: [localhost -> dvernier-restore1-aap-cntrlr-x2c6]: FAILED!
----

