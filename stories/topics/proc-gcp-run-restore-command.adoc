[id="ref-gcp-run-restore-command"]

= Running the restore command

With restore.yml populated, you can usse the command generator to create the restore command.

.Procedure
. Run the command generator. 
+
[NOTE]
====
As `/tmp` is used, the `<local_data_file_directory>` must be set to `/tmp` unless you chose a different location for `restore.yml`.
====
+
[source,bash]
----
$ docker run --rm -v /tmp:/data $IMAGE command_generator gcp_restore_deployment --data-file /data/restore.yml
----
+
This generates a new command containing all needed volumes, environment variables and parameters.
+
The generated command resembles the following:
+
[source,bash]
----
docker run --rm --env PLATFORM=GCP -v <local_credential_file>:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE redhat.ansible_on_clouds.gcp_restore_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=<former_deployment_name> gcp_restored_deployment_name=<new_deployment_name> \
gcp_compute_region=<region> gcp_compute_zone=<zone> gcp_bucket_backup_name=<bucket> gcp_existing_vpc=True'
----
. Run the generated command.
+
[source,bash]
----
$ docker run --rm --env PLATFORM=GCP -v <local_credential_file>:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE redhat.ansible_on_clouds.gcp_restore_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=<former_deployment_name> gcp_restored_deployment_name=<new_deployment_name> \
gcp_compute_region=<region> gcp_compute_zone=<zone> gcp_bucket_backup_name=<bucket> gcp_existing_vpc=True'
----
. When the playbook has completed the output resembles the following:
+
[source,bash]
----
TASK [redhat.ansible_on_clouds.standalone_gcp_restore : Display internal IP addresses] ***
ok: [localhost] => 
  msg:
  - 'Hub        internal IP: 192.168.240.21'
  - 'Controller internal IP: 192.168.240.20'

PLAY RECAP *********************************************************************
localhost                  : ok=33   changed=8    unreachable=0    failed=0    skipped=6    rescued=0    ignored=2  
----

You cannot delete the backed up environment before a restore because on GCP the database backups are stored in the deployment. 
Deleting your deployment therefore deletes the database backups.

Versioned or point-in-time backups are not supported by the `ansible-on-clouds-op` container. 
Only the most recent backup of a deployment is used to restore the deployment.